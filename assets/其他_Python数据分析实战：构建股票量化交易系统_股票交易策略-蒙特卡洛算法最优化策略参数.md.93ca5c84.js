import{_ as s,c as n,o as a,d as l}from"./app.c4f45da1.js";const _=JSON.parse('{"title":"\u80A1\u7968\u4EA4\u6613\u7B56\u7565-\u8499\u7279\u5361\u6D1B\u7B97\u6CD5\u6700\u4F18\u5316\u7B56\u7565\u53C2\u6570","description":"","frontmatter":{},"headers":[{"level":2,"title":"\u524D\u8A00","slug":"\u524D\u8A00","link":"#\u524D\u8A00","children":[]},{"level":2,"title":"\u679A\u4E3E\u6CD5\u7684\u601D\u60F3","slug":"\u679A\u4E3E\u6CD5\u7684\u601D\u60F3","link":"#\u679A\u4E3E\u6CD5\u7684\u601D\u60F3","children":[]},{"level":2,"title":"\u8499\u7279\u5361\u6D1B\u7684\u601D\u60F3","slug":"\u8499\u7279\u5361\u6D1B\u7684\u601D\u60F3","link":"#\u8499\u7279\u5361\u6D1B\u7684\u601D\u60F3","children":[]},{"level":2,"title":"\u8499\u7279\u5361\u6D1B\u53C2\u6570\u6700\u4F18\u5316","slug":"\u8499\u7279\u5361\u6D1B\u53C2\u6570\u6700\u4F18\u5316","link":"#\u8499\u7279\u5361\u6D1B\u53C2\u6570\u6700\u4F18\u5316","children":[]},{"level":2,"title":"\u603B\u7ED3","slug":"\u603B\u7ED3","link":"#\u603B\u7ED3","children":[]}],"relativePath":"\u5176\u4ED6/Python\u6570\u636E\u5206\u6790\u5B9E\u6218\uFF1A\u6784\u5EFA\u80A1\u7968\u91CF\u5316\u4EA4\u6613\u7CFB\u7EDF/\u80A1\u7968\u4EA4\u6613\u7B56\u7565-\u8499\u7279\u5361\u6D1B\u7B97\u6CD5\u6700\u4F18\u5316\u7B56\u7565\u53C2\u6570.md"}'),p={name:"\u5176\u4ED6/Python\u6570\u636E\u5206\u6790\u5B9E\u6218\uFF1A\u6784\u5EFA\u80A1\u7968\u91CF\u5316\u4EA4\u6613\u7CFB\u7EDF/\u80A1\u7968\u4EA4\u6613\u7B56\u7565-\u8499\u7279\u5361\u6D1B\u7B97\u6CD5\u6700\u4F18\u5316\u7B56\u7565\u53C2\u6570.md"},e=l(`<h1 id="\u80A1\u7968\u4EA4\u6613\u7B56\u7565-\u8499\u7279\u5361\u6D1B\u7B97\u6CD5\u6700\u4F18\u5316\u7B56\u7565\u53C2\u6570" tabindex="-1">\u80A1\u7968\u4EA4\u6613\u7B56\u7565-\u8499\u7279\u5361\u6D1B\u7B97\u6CD5\u6700\u4F18\u5316\u7B56\u7565\u53C2\u6570 <a class="header-anchor" href="#\u80A1\u7968\u4EA4\u6613\u7B56\u7565-\u8499\u7279\u5361\u6D1B\u7B97\u6CD5\u6700\u4F18\u5316\u7B56\u7565\u53C2\u6570" aria-hidden="true">#</a></h1><hr><h1 id="\u80A1\u7968\u4EA4\u6613\u7B56\u7565\uFF1A\u8499\u7279\u5361\u6D1B\u7B97\u6CD5\u6700\u4F18\u5316\u7B56\u7565\u53C2\u6570" tabindex="-1">\u80A1\u7968\u4EA4\u6613\u7B56\u7565\uFF1A\u8499\u7279\u5361\u6D1B\u7B97\u6CD5\u6700\u4F18\u5316\u7B56\u7565\u53C2\u6570 <a class="header-anchor" href="#\u80A1\u7968\u4EA4\u6613\u7B56\u7565\uFF1A\u8499\u7279\u5361\u6D1B\u7B97\u6CD5\u6700\u4F18\u5316\u7B56\u7565\u53C2\u6570" aria-hidden="true">#</a></h1><h2 id="\u524D\u8A00" tabindex="-1">\u524D\u8A00 <a class="header-anchor" href="#\u524D\u8A00" aria-hidden="true">#</a></h2><p>\u5728\u80A1\u7968\u6280\u672F\u9762\u5206\u6790\u8FC7\u7A0B\u4E2D\uFF0C\u4EA4\u6613\u8005\u503E\u5411\u4E8E\u56F4\u7ED5\u5404\u79CD\u6280\u672F\u6307\u6807\u7684\u52A8\u6001\u6765\u5236\u5B9A\u4EA4\u6613\u7B56\u7565\uFF0C\u6BD4\u5982MACD\u3001\u79FB\u52A8\u5E73\u5747\u7EBF\u6307\u6807\u7B49\u7B49\u3002\u5176\u5B9E\u6240\u6709\u7684\u6280\u672F\u6307\u6807\u90FD\u662F\u4F9D\u636E\u80A1\u7968\u6536\u76D8\u4EF7\u3001\u5F00\u76D8\u4EF7\u3001\u6700\u9AD8\u4EF7\u3001\u6700\u4F4E\u4EF7\u3001\u6210\u4EA4\u91CF\u7B49\u539F\u59CB\u7684\u4EA4\u6613\u6570\u636E\u901A\u8FC7\u67D0\u79CD\u7B97\u6CD5\u8BA1\u7B97\u800C\u6765\u7684\u3002</p><p>\u5927\u5BB6\u662F\u5426\u6CE8\u610F\u5230\uFF0C\u5728\u591A\u6570\u7684\u80A1\u7968\u884C\u60C5\u8F6F\u4EF6\u4E2D\u9ED8\u8BA4\u7684\u5747\u7EBF\u53C2\u6570\u666E\u904D\u662F5\u65E5\u300110\u65E5\u300120\u65E5\u300130\u65E5\u300160\u65E5\u3001120\u65E5\u2026\u2026\u800C\u975E6\u65E5\u300111\u65E5\u300121\u65E5\u4E4B\u7C7B\uFF0C\u5E76\u4E14\u5728\u5404\u79CD\u4ECB\u7ECD\u80A1\u7968\u4EA4\u6613\u7684\u201C\u79D8\u7C4D\u201D\u4E2D\u4E5F\u6E05\u4E00\u8272\u7684\u53C2\u7167\u8FD9\u4E9B\u9ED8\u8BA4\u7684\u53C2\u6570\u5236\u5B9A\u4EA4\u6613\u7B56\u7565\u3002\u4F46\u662F\u8FD9\u4E9B\u9ED8\u8BA4\u503C\u771F\u7684\u5C31\u662F\u6700\u4F18\u5316\u7684\u53C2\u6570\u503C\u4E86\u5417\uFF1F\u672C\u5C0F\u8282\u5C31\u8BA9\u6211\u4EEC\u6765\u8BA4\u8BC6\u4E0B\u8499\u7279\u5361\u6D1B\u7B97\u6CD5\uFF0C\u4EE5\u53CA\u5982\u4F55\u4F7F\u7528\u8BE5\u65B9\u6CD5\u6765\u5BFB\u627E\u6280\u672F\u6307\u6807\u7684\u6700\u4F18\u5316\u7684\u53C2\u6570\u3002</p><h2 id="\u679A\u4E3E\u6CD5\u7684\u601D\u60F3" tabindex="-1">\u679A\u4E3E\u6CD5\u7684\u601D\u60F3 <a class="header-anchor" href="#\u679A\u4E3E\u6CD5\u7684\u601D\u60F3" aria-hidden="true">#</a></h2><p>\u5728\u4ECB\u7ECD\u8499\u7279\u5361\u6D1B\u6CD5\u4E4B\u524D\uFF0C\u6211\u4EEC\u5148\u56DE\u987E\u4E0B\u5C0F\u5B66\u8BFE\u7A0B\u4E2D\u63A5\u89E6\u5230\u7684\u679A\u4E3E\u6CD5\u3002\u679A\u4E3E\u6CD5\u4E5F\u79F0\u4E3A\u5217\u4E3E\u6CD5\u3001\u7A77\u4E3E\u6CD5\uFF0C\u5C5E\u4E8E\u66B4\u529B\u7B56\u7565\u7684\u5177\u4F53\u4F53\u73B0\uFF0C\u5B83\u7684\u57FA\u672C\u601D\u60F3\u987E\u540D\u601D\u4E49\u5C31\u662F\u9010\u4E00\u5217\u4E3E\u6240\u6709\u53EF\u80FD\u7684\u60C5\u51B5\uFF0C\u5E76\u4E14\u4E00\u4E2A\u4E0D\u6F0F\u5730\u8FDB\u884C\u68C0\u9A8C\uFF0C\u4ECE\u4E2D\u627E\u51FA\u6700\u4F73\u7B54\u6848\u3002</p><p>\u63A5\u4E0B\u6765\u6211\u4EEC\u4EE5\u524D\u9762\u5C0F\u8282\u6240\u63D0\u5230\u7684\u5355\u5747\u7EBF\u7A81\u7834\u7B56\u7565\u4E3A\u4F8B\uFF0C\u6F14\u793A\u4E0B\u679A\u4E3E\u6CD5\u7684\u5E94\u7528\u3002\u5355\u5747\u7EBF\u7A81\u7834\u7B56\u7565\u6307\u7684\u662F\uFF1A\u5F53\u6628\u65E5\u6536\u76D8\u4EF7\u9AD8\u51FA\u8FC7\u53BBN\u65E5\u5E73\u5747\u4EF7\u5219\u4ECA\u5929\u5F00\u76D8\u5373\u4E70\u5165\u80A1\u7968\uFF1B\u82E5\u6628\u65E5\u6536\u76D8\u4EF7\u4F4E\u4E8E\u8FC7\u53BBN\u65E5\u5E73\u5747\u4EF7\uFF0C\u90A3\u4E48\u4ECA\u5929\u5F00\u76D8\u5356\u51FA\u80A1\u7968\u3002\u56E0\u6B64N\u662F\u6211\u4EEC\u9700\u8981\u9009\u53D6\u7684\u53C2\u6570\uFF0C\u6B64\u5904\u4EE5\u679A\u4E3E\u6CD5\u5BFB\u627E\u51FA20\u81F360\u65E5\u4E4B\u95F4\u7684\u6700\u4F18\u5747\u7EBF\u53C2\u6570N\u3002</p><p>\u521B\u5EFA<code>QuantAverBreak</code>\u7C7B\u5B9E\u73B0\u5355\u5747\u7EBF\u7A81\u7834\u7B56\u7565\uFF0C\u8BE5\u7C7B\u5305\u542B<code>init()</code>\u548C<code>run_factor_plot()</code>\u65B9\u6CD5\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">class QuantAverBreak:</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    def __init__(self):</span></span>
<span class="line"><span style="color:#A6ACCD;">    	pass</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;">    def run_factor_plot(self):</span></span>
<span class="line"><span style="color:#A6ACCD;">        pass</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u5728<code>init()</code>\u65B9\u6CD5\u4E2D\u521D\u59CB\u5316\u4EE5\u4E0B\u56DB\u4E2A\u53D8\u91CF\uFF0C\u6B64\u5904\u8BBE\u7F6E\u521D\u59CB\u8D44\u91D1\u4E3A10\u4E07\u5143\uFF0C\u4E00\u65E6\u4FE1\u53F7\u89E6\u53D1\u5219\u5168\u4ED3\u4E70\u5165\u80A1\u7968\uFF0C\u4E70\u5165\u540E\u8D44\u91D1\u8F6C\u4E3A\u5E02\u503C\uFF0C\u5168\u4ED3\u5356\u51FA\u80A1\u7968\u540E\u5E02\u503C\u8F6C\u4E3A\u8D44\u91D1\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">def __init__(self):</span></span>
<span class="line"><span style="color:#A6ACCD;">    self.skip_days = 0 #\u6301\u80A1/\u6301\u5E01\u72B6\u6001</span></span>
<span class="line"><span style="color:#A6ACCD;">    self.cash_hold = 100000  # \u521D\u59CB\u8D44\u91D1</span></span>
<span class="line"><span style="color:#A6ACCD;">    self.posit_num = 0  # \u6301\u80A1\u6570\u76EE</span></span>
<span class="line"><span style="color:#A6ACCD;">    self.market_total = 0  # \u6301\u80A1\u5E02\u503C</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u5728<code>run_factor_plot()</code>\u65B9\u6CD5\u4E2D\u5B9E\u73B0\u5355\u5747\u7EBF\u7A81\u7834\u4FE1\u53F7\u7684\u5224\u65AD\uFF0C\u4EE5\u53CA\u56DE\u6D4B\u83B7\u5F97\u8BE5\u7B56\u7565\u7684\u6700\u7EC8\u8D44\u91D1\u83B7\u5229\u60C5\u51B5\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">def run_factor_plot(self, stock_df, N):</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    stock_df[&#39;Ma_n&#39;] = stock_df.Close.rolling(window=N).mean()  # \u589E\u52A0N\u79FB\u52A8\u5E73\u5747\u7EBF</span></span>
<span class="line"><span style="color:#A6ACCD;">    list_diff = np.sign(stock_df.Close - stock_df.Ma_n)</span></span>
<span class="line"><span style="color:#A6ACCD;">    stock_df[&#39;signal&#39;] = np.sign(list_diff - list_diff.shift(1))</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    for kl_index, today in stock_df.iterrows():</span></span>
<span class="line"><span style="color:#A6ACCD;">        # \u4E70\u5165/\u5356\u51FA\u6267\u884C\u4EE3\u7801</span></span>
<span class="line"><span style="color:#A6ACCD;">        if today.signal &gt; 0 and self.skip_days == 0:  # \u4E70\u5165</span></span>
<span class="line"><span style="color:#A6ACCD;">            start = stock_df.index.get_loc(kl_index)</span></span>
<span class="line"><span style="color:#A6ACCD;">            self.skip_days = -1</span></span>
<span class="line"><span style="color:#A6ACCD;">            self.posit_num = int(self.cash_hold / today.Close)</span></span>
<span class="line"><span style="color:#A6ACCD;">            self.cash_hold = 0</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">        elif today.signal &lt; 0 and self.skip_days == -1:  # \u5356\u51FA \u907F\u514D\u672A\u4E70\u5148\u5356</span></span>
<span class="line"><span style="color:#A6ACCD;">            end = stock_df.index.get_loc(kl_index)</span></span>
<span class="line"><span style="color:#A6ACCD;">            self.skip_days = 0</span></span>
<span class="line"><span style="color:#A6ACCD;">            self.cash_hold = int(self.posit_num * today.Close)</span></span>
<span class="line"><span style="color:#A6ACCD;">            self.market_total = 0</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">        if self.skip_days == -1:# \u6301\u80A1</span></span>
<span class="line"><span style="color:#A6ACCD;">            self.market_total = int(self.posit_num * today.Close)</span></span>
<span class="line"><span style="color:#A6ACCD;">            stock_df.loc[kl_index, &#39;total&#39;] = self.market_total</span></span>
<span class="line"><span style="color:#A6ACCD;">        else:# \u7A7A\u4ED3</span></span>
<span class="line"><span style="color:#A6ACCD;">            stock_df.loc[kl_index, &#39;total&#39;] = self.cash_hold</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    return stock_df[&#39;total&#39;][-1]</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p><code>run_factor_plot()</code>\u65B9\u6CD5\u4E2D\u5927\u90E8\u5206\u4EE3\u7801\u5DF2\u5728\u300A\u6536\u76CA\u4E0E\u98CE\u9669\u7EF4\u5EA6\u5EA6\u91CF\u7B56\u7565\u6548\u679C\u300B\u4E00\u8282\u4E2D\u8FDB\u884C\u8BB2\u89E3\uFF0C\u6B64\u5904\u9700\u8981\u989D\u5916\u4ECB\u7ECD\u4E0B\u5355\u5747\u7EBF\u7A81\u7834\u4FE1\u53F7\u7684\u5224\u65AD\u3002</p><p>\u5C06\u6536\u76D8\u4EF7\u503C\u51CF\u53BB\u5355\u5747\u7EBF\u503C\uFF0C\u5E76\u4F7F\u7528<code>np.sign()</code>\u53D6\u5DEE\u503C\u7B26\u53F7\uFF0C\u5F53\u6536\u76D8\u4EF7\u5728Ma_n\u4E0A\u65B9\u65F6\u5DEE\u503C\u4E3A\u6B63\uFF0C\u6536\u76D8\u4EF7\u5728Ma_n\u4E0B\u65B9\u65F6\u5DEE\u503C\u4E3A\u8D1F\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">list_diff = np.sign(stock_df.Close - stock_df.Ma_n)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u6BD4\u5982\u76F8\u51CF\u540E\u5F97\u5230\u7684\u5E8F\u5217\u4E3A[+1\uFF0C+1\uFF0C+1\uFF0C+1\uFF0C+1\uFF0C-1\uFF0C-1\uFF0C-1\uFF0C-1\uFF0C-1]\uFF0C\u4F7F\u7528shift()\u51FD\u6570\u53F3\u79FB1\u5217\u540E\u4E3A[NA\uFF0C+1\uFF0C+1\uFF0C+1\uFF0C+1\uFF0C+1\uFF0C-1\uFF0C-1\uFF0C-1\uFF0C-1]\uFF08\u7F3A\u5C11\u7684\u503C\u4F1A\u586B\u5145NaN\uFF09\uFF0C\u5C06\u4E24\u4E2A\u5E8F\u5217\u518D\u6B21\u76F8\u51CF\u540E\u5F97\u5230[NA\uFF0C0\uFF0C0\uFF0C0\uFF0C0\uFF0C-2\uFF0C0\uFF0C0\uFF0C0\uFF0C0]\uFF0C\u518D\u5BF9\u76F8\u51CF\u540E\u5E8F\u5217\u53D6\u7B26\u53F7\uFF0C\u901A\u8FC7\u904D\u5386\u7B26\u5408\u503C\u5224\u65AD\uFF0C\u5F53\u7B26\u53F7\u4E3A\u8D1F\u65F6\u4E3A\u6536\u76D8\u4EF7\u5411\u4E0B\u8DCC\u7834Ma_n\uFF0C\u5F53\u7B26\u53F7\u4E3A\u6B63\u65F6\u6536\u76D8\u4EF7\u5411\u4E0A\u7A81\u7834Ma_n\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">list_signal = np.sign(list_diff-list_diff.shift(1))</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u904D\u5386\u79FB\u52A8\u5E73\u5747\u7EBF\u53C2\u657020\u81F360\uFF0C\u5C06\u53C2\u6570\u4F5C\u4E3A\u79FB\u52A8\u5E73\u5747\u7EBF\u7684\u7A97\u53E3\u503C\u4F20\u5165\u7B56\u7565\u4E2D\uFF0C\u6700\u7EC8\u8FD4\u56DE\u56DE\u6D4B\u540E\u7684\u6700\u4F73\u6536\u76CA\u53CA\u5BF9\u5E94\u7684\u5747\u7EBF\u53C2\u6570N\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">stock = web.DataReader(&quot;600410.SS&quot;, &quot;yahoo&quot;, datetime.datetime(2018, 1, 1), datetime.datetime(2019, 1, 1))</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">ma_list = []</span></span>
<span class="line"><span style="color:#A6ACCD;">profit_list = []</span></span>
<span class="line"><span style="color:#A6ACCD;">for ma in range(20, 60):</span></span>
<span class="line"><span style="color:#A6ACCD;">    examp_trade = QuantAverBreak()</span></span>
<span class="line"><span style="color:#A6ACCD;">    ma_list.append(ma)</span></span>
<span class="line"><span style="color:#A6ACCD;">    profit_list.append(examp_trade.run_factor_plot(stock, ma))</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">profit_max=max(profit_list)</span></span>
<span class="line"><span style="color:#A6ACCD;">print(profit_list.index(max(profit_list)))</span></span>
<span class="line"><span style="color:#A6ACCD;">ma_max=ma_list[profit_list.index(max(profit_list))]</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u5269\u4E0B\u7684\u5DE5\u4F5C\u5C31\u662F\u53EF\u89C6\u5316\u5448\u73B0\u901A\u8FC7\u679A\u4E3E\u6CD5\u5BFB\u627E\u5230\u7684\u6700\u4F73\u5747\u7EBF\u53C2\u6570\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">plt.bar(ma_list, profit_list)</span></span>
<span class="line"><span style="color:#A6ACCD;">plt.annotate(&#39;ma=&#39;+str(ma_max)+&#39;\\n&#39;+str(profit_max),\\</span></span>
<span class="line"><span style="color:#A6ACCD;">             xy=(ma_max,profit_max),xytext=(ma_max-5, profit_max-10),arrowprops=dict(facecolor=&#39;yellow&#39;,shrink=0.1),\\</span></span>
<span class="line"><span style="color:#A6ACCD;">             horizontalalignment=&#39;left&#39;,verticalalignment=&#39;top&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"># \u8BBE\u7F6E\u5750\u6807\u6807\u7B7E\u5B57\u4F53\u5927\u5C0F</span></span>
<span class="line"><span style="color:#A6ACCD;">plt.xlabel(&#39;\u5747\u7EBF\u53C2\u6570&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">plt.ylabel(&#39;\u8D44\u91D1\u6536\u76CA&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;"># \u8BBE\u7F6E\u5750\u6807\u8F74\u7684\u53D6\u503C\u8303\u56F4</span></span>
<span class="line"><span style="color:#A6ACCD;">plt.xlim(min(ma_list)-1, max(ma_list)+1)</span></span>
<span class="line"><span style="color:#A6ACCD;">plt.ylim(min(profit_list)*0.99, max(profit_list)*1.01)</span></span>
<span class="line"><span style="color:#A6ACCD;"># \u8BBE\u7F6Ex\u5750\u6807\u8F74\u523B\u5EA6</span></span>
<span class="line"><span style="color:#A6ACCD;">plt.xticks(np.arange(min(ma_list), max(ma_list)+1, 1))</span></span>
<span class="line"><span style="color:#A6ACCD;"># \u8BBE\u7F6E\u56FE\u4F8B\u5B57\u4F53\u5927\u5C0F</span></span>
<span class="line"><span style="color:#A6ACCD;">plt.legend([&#39;profit_list&#39;], loc=&#39;best&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">plt.title(&quot;\u5747\u7EBF\u6700\u4F18\u53C2\u6570&quot;)</span></span>
<span class="line"><span style="color:#A6ACCD;">plt.show()</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u7531\u4E0B\u56FE\u7684\u53EF\u89C6\u5316\u7ED3\u679C\u4E2D\u53EF\u77E5\uFF0C\u8D44\u91D1\u6536\u76CA\u6700\u9AD8\u65F6\u4E3A108641\u5143\uFF0C\u6240\u5BF9\u5E94\u7684\u79FB\u52A8\u5E73\u5747\u7EBF\u7684\u6700\u4F18\u53C2\u6570\u662F27\u65E5\uFF0C\u6211\u4EEC\u53EF\u5C06\u8D44\u91D1\u6536\u76CA\u6700\u9AD8\u7684\u53C2\u6570\u4F5C\u4E3A\u6700\u4F18\u5316\u7684\u53C2\u6570\u3002</p><p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/4/21/16a3fd2da85b4e75~tplv-t2oaga2asx-image.image" alt=""></p><h2 id="\u8499\u7279\u5361\u6D1B\u7684\u601D\u60F3" tabindex="-1">\u8499\u7279\u5361\u6D1B\u7684\u601D\u60F3 <a class="header-anchor" href="#\u8499\u7279\u5361\u6D1B\u7684\u601D\u60F3" aria-hidden="true">#</a></h2><p>\u8499\u7279\u5361\u6D1B\uFF08Monte Carlo\uFF09\u6CD5\u786E\u5207\u5730\u8BF4\u662F\u4E00\u7C7B\u968F\u673A\u6A21\u62DF\u7B97\u6CD5\u7684\u7EDF\u79F0\uFF0C\u63D0\u51FA\u8005\u662F\u5927\u540D\u9F0E\u9F0E\u7684\u8BA1\u7B97\u673A\u4E4B\u7236\u51AF\xB7\u8BFA\u4F0A\u66FC\uFF0C\u56E0\u4E3A\u5728\u8D4C\u535A\u4E2D\u4F53\u73B0\u4E86\u8BB8\u591A\u968F\u673A\u6A21\u62DF\u7684\u7B97\u6CD5\uFF0C\u6240\u4EE5\u4ED6\u501F\u7528\u9A70\u540D\u4E16\u754C\u7684\u8D4C\u57CE\u2014\u6469\u7EB3\u54E5\u7684\u8499\u7279\u5361\u6D1B\u6765\u547D\u540D\u8FD9\u79CD\u65B9\u6CD5\u3002</p><p>\u679A\u4E3E\u6CD5\u628A\u6240\u6709\u53EF\u80FD\u7684\u60C5\u51B5\u4E00\u4E2A\u4E0D\u6F0F\u5730\u8FDB\u884C\u68C0\u9A8C\uFF0C\u5F97\u5230\u7684\u7ED3\u679C\u80AF\u5B9A\u662F\u6B63\u786E\u7684\uFF0C\u4F46\u662F\u4E3A\u4E86\u6362\u53D6\u7B54\u6848\u7684\u5168\u9762\u6027\u5374\u727A\u7272\u4E86\u5F88\u591A\u65E0\u7528\u7684\u65F6\u95F4\uFF0C\u53EA\u80FD\u9002\u7528\u4E8E\u89E3\u51B3\u5BF9\u6548\u7387\u8981\u6C42\u4E0D\u9AD8\uFF0C\u6837\u672C\u89C4\u6A21\u5C0F\u7684\u95EE\u9898\u3002\u6BD4\u5982\u4EC5\u4EC5\u9700\u8981\u5BFB\u627E\u51FA\u5728M20\u81F3M60\u4E4B\u95F4\u7684\u6700\u4F18\u5747\u7EBF\u53C2\u6570\u3002</p><p>\u8499\u7279\u5361\u6D1B\u6CD5\u53EF\u89C6\u4E3A\u679A\u4E3E\u6CD5\u7684\u4E00\u79CD\u53D8\u5F02\uFF0C\u5B83\u7684\u7279\u70B9\u662F\u5728\u968F\u673A\u91C7\u6837\u4E0A\u8BA1\u7B97\u5F97\u5230\u8FD1\u4F3C\u7ED3\u679C\uFF0C\u968F\u7740\u91C7\u6837\u7684\u589E\u591A\uFF0C\u5F97\u5230\u7684\u7ED3\u679C\u662F\u6B63\u786E\u7ED3\u679C\u7684\u6982\u7387\u9010\u6E10\u52A0\u5927\uFF0C\u4F46\u5728\u904D\u5386\u5168\u90E8\u6837\u672C\u4E4B\u524D\uFF0C\u65E0\u6CD5\u77E5\u9053\u76EE\u524D\u5F97\u5230\u7684\u7ED3\u679C\u662F\u4E0D\u662F\u771F\u6B63\u7684\u7ED3\u679C\u3002\u4E0D\u540C\u4E8E\u679A\u4E3E\u6CD5\u7684\u5E94\u7528\uFF0C\u8499\u7279\u5361\u6D1B\u6CD5\u4E3A\u4E86\u63D0\u9AD8\u641C\u7D22\u7684\u6548\u7387\u5374\u727A\u7272\u4E86\u7B54\u6848\u7684\u5168\u9762\u6027\uFF0C\u56E0\u6B64\u5B83\u5F97\u5230\u7684\u7ED3\u679C\u5E76\u4E0D\u4E00\u5B9A\u662F\u6700\u4F18\u7684\uFF0C\u4F46\u662F\u5728\u5927\u89C4\u6A21\u6837\u54C1\u7684\u573A\u5408\u4E0B\u53EF\u4EE5\u66F4\u5FEB\u5730\u627E\u5230\u8FD1\u4F3C\u6700\u4F18\u7ED3\u679C\u3002\u6BD4\u5982\u8BA1\u7B97\u51FD\u6570f(x)\u4ECEa\u5230b\u7684\u5B9A\u79EF\u5206\u503C\uFF0C\u66F4\u5408\u7406\u7684\u662F\u7528\u8499\u7279\u5361\u7F57\u6CD5\u5728\u6709\u9650\u91C7\u6837\u5185\uFF0C\u7ED9\u51FA\u4E00\u4E2A\u8FD1\u4F3C\u7684\u6700\u4F18\u89E3\u3002\u63A5\u4E0B\u6765\u5C31\u901A\u8FC7\u8BE5\u5B9E\u9A8C\u4E86\u89E3\u4E0B\u8499\u7279\u5361\u6D1B\u6CD5\u7684\u5E94\u7528\u3002</p><p>\u5047\u8BBE<img src="https://juejin.cn/equation?tex=f(x)%3Dx%5E%7B2%7D" alt="f(x)=x^{2}">\uFF0C\u6C42\u51FD\u6570f(x)\u4ECEa\u5230b\u7684\u5B9A\u79EF\u5206\u5373\u4E3A\u6C42<img src="https://juejin.cn/equation?tex=%5Cint_%7Ba%7D%5E%7Bb%7Dx%5E%7B2%7D%20dx" alt="nt_{a}^{b}x^{2} dx">\uFF0C\u6B64\u5904\u5C06a\u548Cb\u8BBE\u4E3A1\u548C2\u3002\u53EF\u4EE5\u7528\u4E00\u4E2A\u77E9\u578B\u5305\u56F4\u5728\u51FD\u6570\u7684\u79EF\u5206\u533A\u95F4\u4E0A\uFF0C\u5B9A\u79EF\u5206\u503C\u5176\u5B9E\u5C31\u662F\u6C42\u66F2\u7EBF\u4E0B\u65B9\u7684\u9762\u79EF\uFF0C\u5982\u4E0B\u56FE\u6240\u793A\uFF1A</p><p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/4/21/16a3fd375cb08790~tplv-t2oaga2asx-image.image" alt=""></p><p>\u8BE5\u56FE\u91C7\u7528matplotlib\u5E93\u7ED8\u5236\uFF0C\u6240\u5BF9\u5E94\u7684\u4EE3\u7801\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">def draw_fx_square():</span></span>
<span class="line"><span style="color:#A6ACCD;">    plt.figure()</span></span>
<span class="line"><span style="color:#A6ACCD;">    x_array = np.linspace(0, 3, 50)  # \u7B49\u5DEE\u6570</span></span>
<span class="line"><span style="color:#A6ACCD;">    plt.plot(x_array, np.square(x_array), lw=2, label=&#39;$y=x^2$&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    plt.plot([1, 1], [0, np.square(2)], color=&quot;r&quot;)</span></span>
<span class="line"><span style="color:#A6ACCD;">    plt.plot([2, 2], [0, np.square(2)], color=&quot;r&quot;)</span></span>
<span class="line"><span style="color:#A6ACCD;">    plt.plot([1, 2], [np.square(2), np.square(2)], color=&quot;r&quot;)</span></span>
<span class="line"><span style="color:#A6ACCD;">    plt.plot([1, 2], [0, 0], color=&quot;r&quot;)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    plt.xlabel(&quot;x axis&quot;)</span></span>
<span class="line"><span style="color:#A6ACCD;">    plt.ylabel(&quot;y axis&quot;)</span></span>
<span class="line"><span style="color:#A6ACCD;">    plt.legend(loc=&#39;best&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">    plt.show()</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u968F\u673A\u5730\u5411\u8FD9\u4E2A\u77E9\u5F62\u6846\u91CC\u9762\u6295\u70B9\uFF0C\u7EDF\u8BA1\u843D\u5728\u51FD\u6570f(x)\u4E0B\u65B9\u7684\u70B9\u6570\u91CF\u5360\u6240\u6709\u70B9\u6570\u91CF\u7684\u6BD4\u4F8B\u4E3AP\uFF0C\u90A3\u4E48\u5C31\u53EF\u4EE5\u636E\u6B64\u4F30\u7B97\u51FA\u51FD\u6570f(x)\u4ECEa\u5230b\u7684\u5B9A\u79EF\u5206\u4E3A\u77E9\u5F62\u9762\u79EF\xD7P\uFF0C\u5B9E\u9A8C\u6B65\u9AA4\u5982\u4E0B\uFF1A</p><ul><li>\u8BBE\u539F\u70B9\u4E3A\uFF081\uFF0C0\uFF09\uFF0C\u77E9\u5F62\u7684\u957F\u4E3A1\uFF0C\u5BBD\u4E3A4\uFF0C\u9762\u79EF\u4E3A4</li><li>\u968F\u5373\u53D6\u70B9\uFF08X\uFF0CY\uFF09\uFF0C\u4F7F\u5F971 &lt;=X&lt;=2\u5E76\u4E140 &lt;=Y&lt;=4\uFF0C\u5373\u70B9\u5728\u77E9\u5F62\u5185</li><li>\u901A\u8FC7\u516C\u5F0F X*X&gt;Y\u5224\u65AD\u70B9\u662F\u5426\u5728f(x)\u4E0B\u65B9</li><li>\u8BBE\u6240\u6709\u70B9\u7684\u4E2A\u6570\u4E3AN\uFF0C\u843D\u5728f(x)\u5185\u7684\u70B9\u7684\u4E2A\u6570\u4E3AM\uFF0C\u5219P=M/N</li></ul><p>\u5F53\u8BE5\u5B9E\u9A8C\u7684\u6B21\u6570\u4E3A100\u6B21\u65F6\uFF0C\u8BA1\u7B97\u7ED3\u679C\u4E3A2.4\uFF0C\u4EE3\u7801\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">def cal_integral_mc(n = 100):</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    x_min, x_max = 1.0, 2.0</span></span>
<span class="line"><span style="color:#A6ACCD;">    y_min, y_max = 0.0, 4.0</span></span>
<span class="line"><span style="color:#A6ACCD;">    Area = 4</span></span>
<span class="line"><span style="color:#A6ACCD;">    m = 0</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    for i in range(0, n+1):</span></span>
<span class="line"><span style="color:#A6ACCD;">        x = random.uniform(x_min, x_max)</span></span>
<span class="line"><span style="color:#A6ACCD;">        y = random.uniform(y_min, y_max)</span></span>
<span class="line"><span style="color:#A6ACCD;">        # x*x &gt; y \u8868\u793A\u8BE5\u70B9\u4F4D\u4E8E\u66F2\u7EBF\u7684\u4E0B\u9762\u3002</span></span>
<span class="line"><span style="color:#A6ACCD;">        if x*x &gt; y:</span></span>
<span class="line"><span style="color:#A6ACCD;">            m += 1</span></span>
<span class="line"><span style="color:#A6ACCD;">    #\u6240\u6C42\u7684\u79EF\u5206\u503C\u5373\u4E3A\u66F2\u7EBF\u4E0B\u65B9\u7684\u9762\u79EF</span></span>
<span class="line"><span style="color:#A6ACCD;">    return Area * m / float(n)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u5B9E\u9A8C\u6B21\u6570\u4E3A100\u6B21\u65F6\u6240\u7ED8\u5236\u70B9\u7684\u5206\u5E03\uFF0C\u5982\u4E0B\u56FE\u6240\u793A\uFF1A</p><p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/4/21/16a3fd43788d2715~tplv-t2oaga2asx-image.image" alt=""></p><p>\u5F53\u8BE5\u5B9E\u9A8C\u7684\u6B21\u6570\u4E3A100000\u6B21\u65F6\uFF0C\u8BA1\u7B97\u7ED3\u679C\u4E3A2.319\u3002\u8BE5\u5B9E\u9A8C\u4E5F\u79F0\u4E3A\u57FA\u4E8E\u8499\u7279\u5361\u6D1B\u7684\u6295\u70B9\u6CD5\uFF0C\u7531\u6B64\u5F97\u51FA\u7684\u503C\u5E76\u4E0D\u662F\u4E00\u4E2A\u7CBE\u786E\u503C\uFF0C\u800C\u662F\u4E00\u4E2A\u8FD1\u4F3C\u503C\uFF0C\u5F53\u6295\u70B9\u7684\u6570\u91CF\u8D8A\u6765\u8D8A\u5927\u65F6\uFF0C\u8FD9\u4E2A\u8FD1\u4F3C\u503C\u4E5F\u8D8A\u63A5\u8FD1\u771F\u5B9E\u503C\u3002</p><h2 id="\u8499\u7279\u5361\u6D1B\u53C2\u6570\u6700\u4F18\u5316" tabindex="-1">\u8499\u7279\u5361\u6D1B\u53C2\u6570\u6700\u4F18\u5316 <a class="header-anchor" href="#\u8499\u7279\u5361\u6D1B\u53C2\u6570\u6700\u4F18\u5316" aria-hidden="true">#</a></h2><p>\u679A\u4E3E\u6CD5\u53EA\u80FD\u9002\u5E94\u4E8E\u4E0A\u8FF0\u5C0F\u89C4\u6A21\u904D\u538620\u81F360\u65E5\u5747\u7EBF\u4E4B\u95F4\u7684\u53C2\u6570\uFF0C\u800C\u5BF9\u4E8E\u7A0D\u590D\u6742\u4E00\u4E9B\u7684\u7B56\u7565\u6A21\u578B\uFF0C\u6BD4\u5982\u300A\u7ECF\u5178\u62E9\u65F6\u7B56\u7565\u878D\u5165\u98CE\u9669\u7BA1\u7406\u300B\u4E00\u8282\u4E2D\u540C\u65F6\u6D89\u53CA\u5230N\u65E5\u7A81\u7834\u7B56\u7565\u53C2\u6570<code>N1</code>\u3001<code>N2</code>\uFF0C\u4EE5\u53CA\u98CE\u9669\u7BA1\u7406\u7684\u6700\u5927\u6B62\u76C8\u7CFB\u6570<code>n_win</code>\u3001\u6700\u5927\u6B62\u635F\u7CFB\u6570<code>n_loss</code>\uFF0C\u53D6N1\u53C2\u6570\u6837\u672C\u8303\u56F4\u4E3A[10,30]\uFF0CN2\u53C2\u6570\u4E3A[5,15]\uFF0C n_loss\u53C2\u6570\u4E3A[0.5,1.5]\uFF0Cn_win\u53C2\u6570\u4E3A[1.5,2.5]\uFF0C\u90A3\u4E48\u9700\u8981\u904D\u5386\u7684\u53C2\u6570\u7EC4\u5408\u7684\u6837\u54C1\u7A7A\u95F4\u4F1A\u53D8\u5F97\u975E\u5E38\u5927\u3002</p><p>\u53E6\u4E00\u65B9\u9762\u7528\u5386\u53F2\u6570\u636E\u4F5C\u91CF\u5316\u7B56\u7565\u7684\u56DE\u6D4B\u68C0\u9A8C\u662F\u628A\u8FC7\u53BB\u7684\u7ECF\u9A8C\u4F5C\u4E3A\u4E00\u79CD\u53C2\u8003\u6307\u5357\uFF0C\u901A\u8FC7\u5BF9\u8FC7\u53BB\u7684\u89E3\u8BFB\u53D1\u6398\u51FA\u8574\u85CF\u76C8\u5229\u673A\u4F1A\u7684\u91CD\u590D\u6027\u6A21\u5F0F\uFF0C\u6211\u4EEC\u5E76\u4E0D\u9700\u8981\u4E00\u6210\u4E0D\u53D8\u7684\u56FA\u5B9A\u53C2\u6570\u503C\uFF0C\u800C\u662F\u6301\u7EED\u4E0D\u65AD\u7684\u66F4\u65B0\u63A5\u8FD1\u4E8E\u6700\u4F18\u7684\u7B56\u7565\u53C2\u6570\u503C\u3002\u56E0\u6B64\u8499\u7279\u5361\u6D1B\u6CD5\u6210\u4E3A\u4E86\u53C2\u6570\u6700\u4F18\u5316\u7684\u9996\u9009\u65B9\u6848\u3002</p><p>\u6211\u4EEC\u5206\u522B\u4ECEN1\u3001N2\u3001n_win\u3001n_loss\u53C2\u6570\u7684\u6837\u672C\u7A7A\u95F4\u4E2D\u968F\u673A\u91C7\u6837\uFF0C\u800C\u540E\u5C06\u91C7\u6837\u7684\u7EC4\u5408\u53C2\u6570\u4EE3\u5165\u7B56\u7565\u4E2D\u8FDB\u884C\u56DE\u6D4B\u5206\u6790\uFF0C\u7A0B\u5E8F\u6846\u67B6\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">def cal_ndayavg_mc(n = 500):</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    n1_min, n1_max = 10, 30</span></span>
<span class="line"><span style="color:#A6ACCD;">    n2_min, n2_max = 5, 15</span></span>
<span class="line"><span style="color:#A6ACCD;">    win_min, win_max = 1.5, 2.5</span></span>
<span class="line"><span style="color:#A6ACCD;">    loss_min, loss_max = 0.5, 1.5</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    ma_list = []</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    for i in range(0, n+1):</span></span>
<span class="line"><span style="color:#A6ACCD;">        n1 = int(random.uniform(n1_min, n1_max))</span></span>
<span class="line"><span style="color:#A6ACCD;">        n2 = int(random.uniform(n2_min, n2_max))</span></span>
<span class="line"><span style="color:#A6ACCD;">        win = round(random.uniform(win_min, win_max),1)</span></span>
<span class="line"><span style="color:#A6ACCD;">        loss = round(random.uniform(loss_min, loss_max),1)</span></span>
<span class="line"><span style="color:#A6ACCD;">        ma_list.append([n1,n2,win,loss])</span></span>
<span class="line"><span style="color:#A6ACCD;">    	#\u6B64\u5904\u6DFB\u52A0\u7B56\u7565\u4EE3\u7801</span></span>
<span class="line"><span style="color:#A6ACCD;">    return ma_list</span></span>
<span class="line"><span style="color:#A6ACCD;">print(cal_ndayavg_mc())</span></span>
<span class="line"><span style="color:#A6ACCD;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">[[22, 13, 1.9, 1.1], [27, 9, 1.8, 1.0], [29, 6, 1.7, 0.6], [13, 9, 2.1, 0.7], [15, 9, 2.4, 0.9], [22, 7, 2.0, 1.4], ....... [26, 12, 2.1, 1.0], [10, 8, 1.8, 0.9]]</span></span>
<span class="line"><span style="color:#A6ACCD;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u521B\u5EFA<code>QuantNdayBreak</code>\u7C7B\u5B9E\u73B0\u5E26\u6709\u98CE\u9669\u7BA1\u7406\u7684N\u65E5\u7A81\u7834\u7B56\u7565\uFF0C\u8BE5\u7C7B\u5305\u542B<code>init()</code>\u548C<code>run_factor_plot()</code>\u65B9\u6CD5\uFF0C\u5176\u4E2D<code>init()</code>\u90E8\u5206\u4E0A\u6587\u5DF2\u7ECF\u6709\u76F8\u5173\u4ECB\u7ECD\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">class QuantNdayBreak:</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    def __init__(self):</span></span>
<span class="line"><span style="color:#A6ACCD;">        # \u521D\u59CB\u5316\u53D8\u91CF</span></span>
<span class="line"><span style="color:#A6ACCD;">        self.skip_days = 0 #\u6301\u80A1/\u6301\u5E01\u72B6\u6001</span></span>
<span class="line"><span style="color:#A6ACCD;">        self.cash_hold = 100000  # \u521D\u59CB\u8D44\u91D1</span></span>
<span class="line"><span style="color:#A6ACCD;">        self.posit_num = 0  # \u6301\u80A1\u6570\u76EE</span></span>
<span class="line"><span style="color:#A6ACCD;">        self.market_total = 0  # \u6301\u80A1\u5E02\u503C</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    def run_factor_plot(self, stock_df, N):</span></span>
<span class="line"><span style="color:#A6ACCD;">        pass</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u5728<code>run_factor_plot()</code>\u65B9\u6CD5\u4E2D\u5B9E\u73B0N\u65E5\u7A81\u7834\u4EE5\u53CA\u6B62\u76C8\u6B62\u635F\u4FE1\u53F7\u7684\u5224\u65AD\uFF0C\u4EE5\u53CA\u56DE\u6D4B\u83B7\u5F97\u8BE5\u7B56\u7565\u7684\u6700\u7EC8\u8D44\u91D1\u83B7\u5229\u60C5\u51B5\u3002<code>run_factor_plot()</code>\u65B9\u6CD5\u4E2D\u5177\u4F53\u5B9E\u73B0\u4EE3\u7801\u4E0E\u524D\u9762\u7684\u5C0F\u8282\u4E2D\u6240\u4ECB\u7ECD\u7684\u76F8\u8FD1\uFF0C\u6B64\u5904\u5728\u4EE3\u7801\u7ED3\u6784\u4E0A\u7565\u5FAE\u8C03\u6574\u5373\u53EF\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">def run_factor_plot(self, stock_obj, N1=15, N2=5, n_loss=0.8, n_win=2):</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">	self.stockdata = stock_obj</span></span>
<span class="line"><span style="color:#A6ACCD;">    self.stockdata[&#39;N1_High&#39;] = self.stockdata.High.rolling(window=N1).max()  # \u8BA1\u7B97\u6700\u8FD1N1\u4E2A\u4EA4\u6613\u65E5\u6700\u9AD8\u4EF7</span></span>
<span class="line"><span style="color:#A6ACCD;">    self.stockdata[&#39;N1_High&#39;] = self.stockdata.N1_High.shift(1)</span></span>
<span class="line"><span style="color:#A6ACCD;">    expan_max = self.stockdata.Close.expanding().max()</span></span>
<span class="line"><span style="color:#A6ACCD;">    self.stockdata[&#39;N1_High&#39;].fillna(value=expan_max, inplace=True)  # \u76EE\u524D\u51FA\u73B0\u8FC7\u7684\u6700\u5927\u503C\u586B\u5145\u524DN1\u4E2Anan</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    self.stockdata[&#39;N2_Low&#39;] = self.stockdata.Low.rolling(window=N2).min()  # \u8BA1\u7B97\u6700\u8FD1N2\u4E2A\u4EA4\u6613\u65E5\u6700\u4F4E\u4EF7</span></span>
<span class="line"><span style="color:#A6ACCD;">    self.stockdata[&#39;N2_Low&#39;] = self.stockdata.N2_Low.shift(1)</span></span>
<span class="line"><span style="color:#A6ACCD;">    expan_min = self.stockdata.Close.expanding().min()</span></span>
<span class="line"><span style="color:#A6ACCD;">    self.stockdata[&#39;N2_Low&#39;].fillna(value=expan_min, inplace=True)  # \u76EE\u524D\u51FA\u73B0\u8FC7\u7684\u6700\u5C0F\u503C\u586B\u5145\u524DN2\u4E2Anan</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    self.stockdata[&#39;atr14&#39;] = talib.ATR(self.stockdata.High.values, self.stockdata.Low.values, self.stockdata.Close.values,</span></span>
<span class="line"><span style="color:#A6ACCD;">                                   timeperiod=14)  # \u8BA1\u7B97ATR14</span></span>
<span class="line"><span style="color:#A6ACCD;">    buy_price = 0</span></span>
<span class="line"><span style="color:#A6ACCD;">    for kl_index, today in self.stockdata.iterrows():</span></span>
<span class="line"><span style="color:#A6ACCD;">        if today.Close &gt; today.N1_High:</span></span>
<span class="line"><span style="color:#A6ACCD;">            buy_price = today.Close</span></span>
<span class="line"><span style="color:#A6ACCD;">            self.stockdata.loc[kl_index, &#39;signal&#39;] = 1</span></span>
<span class="line"><span style="color:#A6ACCD;">        # \u5230\u8FBE\u6536\u76D8\u4EF7\u5C11\u4E8E\u4E70\u5165\u4EF7\u540E\u89E6\u53D1\u5356\u51FA</span></span>
<span class="line"><span style="color:#A6ACCD;">        elif (buy_price != 0) and (buy_price &gt; today.Close) and ((buy_price - today.Close) &gt; n_loss * today.atr14):</span></span>
<span class="line"><span style="color:#A6ACCD;">            self.stockdata.loc[kl_index, &#39;signal&#39;] = 0</span></span>
<span class="line"><span style="color:#A6ACCD;">            buy_price = 0</span></span>
<span class="line"><span style="color:#A6ACCD;">        # \u5230\u8FBE\u6536\u76D8\u4EF7\u591A\u4E8E\u4E70\u5165\u4EF7\u540E\u89E6\u53D1\u5356\u51FA</span></span>
<span class="line"><span style="color:#A6ACCD;">        elif (buy_price != 0) and (buy_price &lt; today.Close) and ((today.Close - buy_price) &gt; n_win * today.atr14):</span></span>
<span class="line"><span style="color:#A6ACCD;">            self.stockdata.loc[kl_index, &#39;signal&#39;] = 0</span></span>
<span class="line"><span style="color:#A6ACCD;">            buy_price = 0</span></span>
<span class="line"><span style="color:#A6ACCD;">        elif today.Close &lt; today.N2_Low:</span></span>
<span class="line"><span style="color:#A6ACCD;">            self.stockdata.loc[kl_index, &#39;signal&#39;] = 0</span></span>
<span class="line"><span style="color:#A6ACCD;">            buy_price = 0</span></span>
<span class="line"><span style="color:#A6ACCD;">        else:</span></span>
<span class="line"><span style="color:#A6ACCD;">            pass</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    self.stockdata[&#39;signal&#39;].fillna(method=&#39;ffill&#39;, inplace=True)</span></span>
<span class="line"><span style="color:#A6ACCD;">    self.stockdata[&#39;signal&#39;] = self.stockdata.signal.shift(1)</span></span>
<span class="line"><span style="color:#A6ACCD;">    self.stockdata[&#39;signal&#39;].fillna(method=&#39;bfill&#39;, inplace=True)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    for kl_index, today in self.stockdata.iterrows():</span></span>
<span class="line"><span style="color:#A6ACCD;">        # \u4E70\u5165/\u5356\u51FA\u6267\u884C\u4EE3\u7801</span></span>
<span class="line"><span style="color:#A6ACCD;">        if today.signal == 1 and self.skip_days == 0:  # \u4E70\u5165</span></span>
<span class="line"><span style="color:#A6ACCD;">            self.skip_days = -1</span></span>
<span class="line"><span style="color:#A6ACCD;">            self.posit_num = int(self.cash_hold / today.Close)  # \u8D44\u91D1\u8F6C\u5316\u4E3A\u80A1\u7968</span></span>
<span class="line"><span style="color:#A6ACCD;">            self.cash_hold = 0</span></span>
<span class="line"><span style="color:#A6ACCD;">        elif today.signal == 0 and self.skip_days == -1:  # \u5356\u51FA \u907F\u514D\u672A\u4E70\u5148\u5356</span></span>
<span class="line"><span style="color:#A6ACCD;">            self.skip_days = 0</span></span>
<span class="line"><span style="color:#A6ACCD;">            self.cash_hold = int(self.posit_num * today.Close)  # \u80A1\u7968\u8F6C\u5316\u4E3A\u8D44\u91D1</span></span>
<span class="line"><span style="color:#A6ACCD;">            self.market_total = 0</span></span>
<span class="line"><span style="color:#A6ACCD;">        if self.skip_days == -1:  # \u6301\u80A1</span></span>
<span class="line"><span style="color:#A6ACCD;">            self.market_total = int(self.posit_num * today.Close)</span></span>
<span class="line"><span style="color:#A6ACCD;">            self.stockdata.loc[kl_index, &#39;total&#39;] = self.market_total</span></span>
<span class="line"><span style="color:#A6ACCD;">        else:  # \u7A7A\u4ED3</span></span>
<span class="line"><span style="color:#A6ACCD;">            self.stockdata.loc[kl_index, &#39;total&#39;] = self.cash_hold</span></span>
<span class="line"><span style="color:#A6ACCD;">    return self.stockdata[&#39;total&#39;][-1]</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u5C06<code>run_factor_plot()</code>\u65B9\u6CD5\u4E0E\u8499\u7279\u5361\u6D1B\u91C7\u6837\u90E8\u5206\u7A0B\u5E8F\u6846\u67B6<code>cal_ndayavg_mc()</code>\u76F8\u7ED3\u5408\uFF0C\u6700\u7EC8<code>ma_list</code>\u548C<code>profit_list</code>\u5217\u8868\u5206\u522B\u5B58\u50A8\u76F8\u5BF9\u5E94\u7684\u53C2\u6570\u548C\u8D44\u91D1\u6536\u76CA\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">def cal_ndayavg_mc(n = 200):</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    n1_min, n1_max = 10, 30</span></span>
<span class="line"><span style="color:#A6ACCD;">    n2_min, n2_max = 5, 15</span></span>
<span class="line"><span style="color:#A6ACCD;">    win_min, win_max = 1.5, 2.5</span></span>
<span class="line"><span style="color:#A6ACCD;">    loss_min, loss_max = 0.5, 1.5</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    ma_list = []</span></span>
<span class="line"><span style="color:#A6ACCD;">    profit_list = []</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    df_stockload = web.DataReader(&quot;600410.SS&quot;, &quot;yahoo&quot;, datetime.datetime(2018, 1, 1),</span></span>
<span class="line"><span style="color:#A6ACCD;">                                  datetime.datetime(2019, 1, 1))  # \u534E\u80DC\u5929\u6210</span></span>
<span class="line"><span style="color:#A6ACCD;">    for i in range(0, n+1):</span></span>
<span class="line"><span style="color:#A6ACCD;">        n1 = int(random.uniform(n1_min, n1_max))</span></span>
<span class="line"><span style="color:#A6ACCD;">        n2 = int(random.uniform(n2_min, n2_max))</span></span>
<span class="line"><span style="color:#A6ACCD;">        win = round(random.uniform(win_min, win_max),1)</span></span>
<span class="line"><span style="color:#A6ACCD;">        loss = round(random.uniform(loss_min, loss_max),1)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">        ma_list.append([n1, n2, win, loss])</span></span>
<span class="line"><span style="color:#A6ACCD;">        examp_trade = QuantNdayBreak()</span></span>
<span class="line"><span style="color:#A6ACCD;">        profit_list.append(examp_trade.run_factor_plot(df_stockload, n1, n2, loss, win))</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    profit_max = max(profit_list)#maximize the profit</span></span>
<span class="line"><span style="color:#A6ACCD;">    ma_max = ma_list[profit_list.index(max(profit_list))]#correspond parametes</span></span>
<span class="line"><span style="color:#A6ACCD;">    print(&quot;maximize the profit is %s and correspond parametes are %s &quot;%(profit_max, ma_max))</span></span>
<span class="line"><span style="color:#A6ACCD;">    #maximize the profit is 132576.0 and correspond parametes are [16, 10, 2.3, 1.1] </span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u6211\u4EEC\u8BBE\u5B9A\u968F\u673A\u91C7\u6837200\u6B21\uFF0C\u4F7F\u7528matplotlib\u5E93\u53EF\u89C6\u5316\u56DE\u6D4B\u7684\u6548\u679C\uFF0C\u4ECE\u4E2D\u53EF\u77E5\u8D44\u91D1\u6536\u76CA\u6700\u4F73\u7684\u53C2\u6570\u4E3A[16, 10, 2.3, 1.1]\uFF0C\u5BF9\u5E94\u7684\u8D44\u91D1\u4E3A132576\uFF0C\u53EF\u89C6\u5316\u6548\u679C\u56FE\u5982\u4E0B\u6240\u793A\uFF1A</p><p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/4/21/16a3fd6c274d3f27~tplv-t2oaga2asx-image.image" alt=""></p><p>\u53EF\u89C6\u5316\u90E8\u5206\u7684\u4EE3\u7801\u4E0E\u4E0A\u6587\u679A\u4E3E\u6CD5\u4E2D\u4ECB\u7ECD\u7684\u5927\u4F53\u76F8\u540C\uFF0C\u9700\u8981\u6CE8\u610F\u7684\u662F\u6B64\u5904\u7684\u53C2\u6570\u4E3A\u5217\u8868\u683C\u5F0F\uFF0C\u56E0\u6B64x\u8F74\u7684\u5750\u6807\u9700\u8981\u8F6C\u6362\u4E3A\u7D22\u5F15\uFF0C\u53EF\u89C6\u5316\u6700\u4F73\u5747\u7EBF\u53C2\u6570\u7684\u4EE3\u7801\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">plt.bar(np.arange(0,len(ma_list), 1), profit_list)</span></span>
<span class="line"><span style="color:#A6ACCD;">plt.annotate(str(ma_max)+&#39;\\n&#39;+str(profit_max),\\</span></span>
<span class="line"><span style="color:#A6ACCD;">             xy=(ma_list.index(ma_max),profit_max),xytext=(ma_list.index(ma_max)-10, profit_max-10),arrowprops=dict(facecolor=&#39;yellow&#39;,shrink=0.1),\\</span></span>
<span class="line"><span style="color:#A6ACCD;">             horizontalalignment=&#39;left&#39;,verticalalignment=&#39;top&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"># \u8BBE\u7F6E\u5750\u6807\u6807\u7B7E\u5B57\u4F53\u5927\u5C0F</span></span>
<span class="line"><span style="color:#A6ACCD;">plt.xlabel(&#39;\u5747\u7EBF\u53C2\u6570&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">plt.ylabel(&#39;\u8D44\u91D1\u6536\u76CA&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;"># \u8BBE\u7F6E\u5750\u6807\u8F74\u7684\u53D6\u503C\u8303\u56F4</span></span>
<span class="line"><span style="color:#A6ACCD;">plt.ylim(min(profit_list)*0.99, max(profit_list)*1.01)</span></span>
<span class="line"><span style="color:#A6ACCD;"># \u8BBE\u7F6E\u56FE\u4F8B\u5B57\u4F53\u5927\u5C0F</span></span>
<span class="line"><span style="color:#A6ACCD;">plt.legend([&#39;profit_list&#39;], loc=&#39;best&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">plt.title(&quot;\u5747\u7EBF\u6700\u4F18\u53C2\u6570&quot;)</span></span>
<span class="line"><span style="color:#A6ACCD;">plt.show()</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><h2 id="\u603B\u7ED3" tabindex="-1">\u603B\u7ED3 <a class="header-anchor" href="#\u603B\u7ED3" aria-hidden="true">#</a></h2><p>\u672C\u5C0F\u8282\u5BF9\u6BD4\u4ECB\u7ECD\u4E86\u679A\u4E3E\u6CD5\u548C\u8499\u7279\u5361\u6D1B\u6CD5\u5404\u81EA\u7684\u7279\u70B9\u4EE5\u53CA\u5728\u53C2\u6570\u6700\u4F18\u5316\u4E2D\u7684\u5E94\u7528\u3002\u5C06\u8499\u7279\u5361\u6D1B\u6CD5\u5E94\u7528\u4E8E\u91CF\u5316\u4EA4\u6613\u7B56\u7565\u7684\u53C2\u6570\u6700\u4F18\u5316\u8FC7\u7A0B\u4E2D\uFF0C\u80FD\u591F\u5728\u53C2\u6570\u6837\u672C\u7A7A\u95F4\u5DE8\u5927\u7684\u60C5\u51B5\u4E0B\u62E9\u4F18\u9009\u51FA\u7B56\u7565\u53C2\u6570\uFF0C\u53EF\u4EE5\u5728\u56DE\u6D4B\u9636\u6BB5\u5E2E\u52A9\u6211\u4EEC\u66F4\u597D\u5730\u4E86\u89E3\u4E0D\u540C\u53C2\u6570\u5BF9\u7B56\u7565\u6548\u679C\u7684\u5F71\u54CD\u3002</p><p>\u6700\u540E\uFF0C\u7ED9\u5927\u5BB6\u7559\u4E00\u9053\u601D\u8003\u9898\uFF1A</p><p>\u91CF\u5316\u4EA4\u6613\u7684\u672C\u8D28\u662F\u7BA1\u7406\u80DC\u7B97\u7684\u6982\u7387\uFF0C\u800C\u8499\u7279\u5361\u6D1B\u6CD5\u7684\u968F\u673A\u8FC7\u7A0B\u540C\u6837\u662F\u4EE5\u6982\u7387\u7684\u5F62\u5F0F\u6C42\u53D6\u8FD1\u4F3C\u7684\u89E3\uFF0C\u90A3\u4E48\u8499\u7279\u5361\u6D1B\u57FA\u4E8E\u7684\u6982\u7387\u7406\u8BBA\u662F\u4EC0\u4E48\u5462\uFF1F</p><p>\u6B22\u8FCE\u5927\u5BB6\u5728\u7559\u8A00\u533A\u7559\u8A00\uFF0C\u6211\u4EEC\u4E00\u8D77\u8BA8\u8BBA\u3002</p>`,61),o=[e];function t(c,i,r,C,A,d){return a(),n("div",null,o)}const D=s(p,[["render",t]]);export{_ as __pageData,D as default};
