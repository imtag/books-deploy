import{_ as s,c as a,o as n,d as l}from"./app.e0e4ea3a.js";const _=JSON.parse('{"title":"\u80A1\u7968\u4EA4\u6613\u7B56\u7565-\u62E9\u65F6\u7B56\u7565\u878D\u5165ATR\u52A8\u6001\u4ED3\u4F4D\u7BA1\u7406\u3010\u52A0\u63A8\u7BC7\u3011","description":"","frontmatter":{},"headers":[{"level":2,"title":"\u524D\u8A00","slug":"\u524D\u8A00","link":"#\u524D\u8A00","children":[]},{"level":2,"title":"ATR\u8D44\u91D1\u7BA1\u7406\u7684\u539F\u7406","slug":"atr\u8D44\u91D1\u7BA1\u7406\u7684\u539F\u7406","link":"#atr\u8D44\u91D1\u7BA1\u7406\u7684\u539F\u7406","children":[]},{"level":2,"title":"ATR\u5934\u5BF8\u7BA1\u7406\u7684\u5B9E\u73B0","slug":"atr\u5934\u5BF8\u7BA1\u7406\u7684\u5B9E\u73B0","link":"#atr\u5934\u5BF8\u7BA1\u7406\u7684\u5B9E\u73B0","children":[]},{"level":2,"title":"ATR\u52A8\u6001\u4ED3\u4F4D\u8C03\u6574","slug":"atr\u52A8\u6001\u4ED3\u4F4D\u8C03\u6574","link":"#atr\u52A8\u6001\u4ED3\u4F4D\u8C03\u6574","children":[]},{"level":2,"title":"ATR\u52A8\u6001\u6B62\u635F\u4EF7\u4F4D","slug":"atr\u52A8\u6001\u6B62\u635F\u4EF7\u4F4D","link":"#atr\u52A8\u6001\u6B62\u635F\u4EF7\u4F4D","children":[]}],"relativePath":"\u5176\u4ED6/Python\u6570\u636E\u5206\u6790\u5B9E\u6218\uFF1A\u6784\u5EFA\u80A1\u7968\u91CF\u5316\u4EA4\u6613\u7CFB\u7EDF/\u80A1\u7968\u4EA4\u6613\u7B56\u7565-\u62E9\u65F6\u7B56\u7565\u878D\u5165ATR\u52A8\u6001\u4ED3\u4F4D\u7BA1\u7406\u3010\u52A0\u63A8\u7BC7\u3011.md"}'),p={name:"\u5176\u4ED6/Python\u6570\u636E\u5206\u6790\u5B9E\u6218\uFF1A\u6784\u5EFA\u80A1\u7968\u91CF\u5316\u4EA4\u6613\u7CFB\u7EDF/\u80A1\u7968\u4EA4\u6613\u7B56\u7565-\u62E9\u65F6\u7B56\u7565\u878D\u5165ATR\u52A8\u6001\u4ED3\u4F4D\u7BA1\u7406\u3010\u52A0\u63A8\u7BC7\u3011.md"},e=l(`<h1 id="\u80A1\u7968\u4EA4\u6613\u7B56\u7565-\u62E9\u65F6\u7B56\u7565\u878D\u5165atr\u52A8\u6001\u4ED3\u4F4D\u7BA1\u7406\u3010\u52A0\u63A8\u7BC7\u3011" tabindex="-1">\u80A1\u7968\u4EA4\u6613\u7B56\u7565-\u62E9\u65F6\u7B56\u7565\u878D\u5165ATR\u52A8\u6001\u4ED3\u4F4D\u7BA1\u7406\u3010\u52A0\u63A8\u7BC7\u3011 <a class="header-anchor" href="#\u80A1\u7968\u4EA4\u6613\u7B56\u7565-\u62E9\u65F6\u7B56\u7565\u878D\u5165atr\u52A8\u6001\u4ED3\u4F4D\u7BA1\u7406\u3010\u52A0\u63A8\u7BC7\u3011" aria-hidden="true">#</a></h1><hr><h1 id="\u52A0\u63A8\u7BC7\uFF01\u62E9\u65F6\u7B56\u7565\u878D\u5165atr\u52A8\u6001\u4ED3\u4F4D\u7BA1\u7406" tabindex="-1">\u52A0\u63A8\u7BC7\uFF01\u62E9\u65F6\u7B56\u7565\u878D\u5165ATR\u52A8\u6001\u4ED3\u4F4D\u7BA1\u7406 <a class="header-anchor" href="#\u52A0\u63A8\u7BC7\uFF01\u62E9\u65F6\u7B56\u7565\u878D\u5165atr\u52A8\u6001\u4ED3\u4F4D\u7BA1\u7406" aria-hidden="true">#</a></h1><h2 id="\u524D\u8A00" tabindex="-1">\u524D\u8A00 <a class="header-anchor" href="#\u524D\u8A00" aria-hidden="true">#</a></h2><p>\u5728\u300A\u80A1\u7968\u4EA4\u6613\u7B56\u7565\uFF1A\u62E9\u65F6\u7B56\u7565\u878D\u5165ATR\u98CE\u9669\u7BA1\u7406\u300B\u8282\u4E2D\u6211\u4EEC\u5728\u6D77\u9F9F\u4EA4\u6613\u6CD5\u5219\u7684N\u65E5\u7A81\u7834\u62E9\u65F6\u7B56\u7565\u57FA\u7840\u4E0A\u5F15\u5165\u98CE\u9669\u7BA1\u7406\u56E0\u5B50\u2014\u2014ATR\u6307\u6807\u3002</p><p>ATR\u6307\u6807\u4E3B\u8981\u662F\u7528\u6765\u8861\u91CF\u5E02\u573A\u6CE2\u52A8\u7684\u5F3A\u70C8\u5EA6\uFF0C\u5373\u4E3A\u4E86\u663E\u793A\u5E02\u573A\u53D8\u5316\u7387\u7684\u6307\u6807\uFF0C\u5F53\u5E02\u573A\u6CE2\u52A8\u5267\u70C8\u90A3\u4E48ATR\u7684\u503C\u5C31\u4F1A\u53D8\u5927\uFF0C\u5F53\u5E02\u573A\u8D8B\u4E8E\u5E73\u7A33\u6216\u6CE2\u52A8\u8F83\u5C0F\u90A3\u4E48ATR\u503C\u5C31\u4F1A\u53D8\u5C0F\u3002\u56E0\u6B64\u5728\u8D44\u91D1\u7BA1\u7406\u4E2D\uFF0C\u6839\u636EATR\u503C\u5B9E\u73B0\u52A8\u6001\u4ED3\u4F4D\u7684\u8BA1\u7B97\uFF0C\u53EF\u4EE5\u4E0E\u5F53\u524D\u5E02\u573A\u7684\u6CE2\u52A8\u7387\u76F8\u5173\u8054\u3002</p><p>\u5B9E\u9645\u4E0A\uFF0C\u5728\u6D77\u9F9F\u4EA4\u6613\u6CD5\u5219\u4E2D\uFF0CATR\u6307\u6807\u662F\u8D44\u91D1\u7BA1\u7406\u7684\u6838\u5FC3\uFF0C\u98CE\u9669\u7BA1\u7406\u7B56\u7565\u7684\u5224\u65AD\u67D0\u79CD\u7A0B\u5EA6\u4E0A\u4E5F\u662F\u5BF9\u4E8E\u8D44\u91D1\u7684\u4FDD\u62A4\u3002</p><p>\u672C\u8282\u6211\u4EEC\u591A\u4E2A\u89D2\u5EA6\u6765\u4ECB\u7ECD\u4E0B\u57FA\u4E8EATR\u6307\u6807\u7684\u52A8\u6001\u4ED3\u4F4D\u7BA1\u7406\u7684\u539F\u7406\u548C\u5B9E\u73B0\u65B9\u6CD5\u3002</p><h2 id="atr\u8D44\u91D1\u7BA1\u7406\u7684\u539F\u7406" tabindex="-1">ATR\u8D44\u91D1\u7BA1\u7406\u7684\u539F\u7406 <a class="header-anchor" href="#atr\u8D44\u91D1\u7BA1\u7406\u7684\u539F\u7406" aria-hidden="true">#</a></h2><p>\u771F\u6B63\u7684\u8D44\u91D1\u7BA1\u7406\u662F\u5728\u4E70\u5165\u67D0\u4E2A\u80A1\u7968\u65F6\uFF0C\u51B3\u5B9A\u5982\u4F55\u5206\u6279\u5165\u573A\uFF0C\u53C8\u5982\u4F55\u6B62\u635F/\u6B62\u8D62\u79BB\u573A\u7684\u7B56\u7565\u3002\u8D44\u91D1\u7BA1\u7406\u6A21\u5757\u7531\u4EE5\u4E0B\u56DB\u90E8\u5206\u7EC4\u6210\uFF1A</p><ul><li>\u8D44\u91D1\u5206\u914D</li><li>\u5934\u5BF8\u89C4\u6A21</li><li>\u6B62\u76C8\u6B62\u635F\u4EF7\u4F4D</li><li>\u52A0\u51CF\u4ED3\u89C4\u6A21</li></ul><p>\u65E0\u8BBA\u662F\u8D44\u91D1\u5206\u914D\u3001\u5934\u5BF8\u89C4\u6A21\u3001\u6B62\u76C8\u6B62\u635F\u4EF7\u4F4D\u8FD8\u662F\u52A0\u51CF\u4ED3\u89C4\u6A21\uFF0C\u90FD\u662F\u5C06ATR\u6307\u6807\u4F5C\u4E3A\u57FA\u51C6\u503C\u3002</p><p>\u63A5\u4E0B\u6765\u6211\u4EEC\u4EE5\u5408\u7406\u5206\u914D\u8D44\u91D1\u4E3A\u4F8B\uFF0C\u4ECB\u7ECD\u4E0BATR\u5728\u8D44\u91D1\u7BA1\u7406\u4E2D\u7684\u539F\u7406\u3002</p><p>\u901A\u5E38\u4EA4\u6613\u8005\u90FD\u4F1A\u540C\u65F6\u6301\u6709\u591A\u53EA\u80A1\u7968\uFF0C\u90A3\u4E48\u5982\u4F55\u5728\u591A\u4E2A\u80A1\u7968\u4E4B\u95F4\u5206\u914D\u8D44\u91D1\u5462\uFF1F</p><p>\u6BD4\u65B9\u624B\u5934\u670910\u4E07\u5143\u8D44\u91D1\uFF0C\u51C6\u5907\u540C\u65F6\u4E70\u80A1\u7968A\u548C\u80A1\u7968B\uFF0C\u5982\u4F55\u5206\u914D\u8D44\u91D1\u5462\uFF1F\u6700\u7B80\u5355\u7684\uFF0C\u4E5F\u662F\u5927\u591A\u6570\u4EBA\u9009\u62E9\u7684\u65B9\u6CD5\u662F\u5747\u5206\u6CD5\uFF0C\u4E5F\u5C31\u662F\u4E24\u8005\u5404\u4E705\u4E07\u5143\u3002\u8FD9\u79CD\u65B9\u6CD5\u867D\u7136\u7B80\u5355\uFF0C\u4F46\u5374\u5FFD\u7565\u4E86\u4E00\u4E2A\u95EE\u9898\uFF0C\u4E5F\u5C31\u662F\u4E0D\u540C\u7684\u80A1\u7968\u80A1\u6027\u5E76\u4E0D\u76F8\u540C\uFF0C\u4E5F\u5C31\u662F\u8BF4\u6709\u7684\u6CE2\u52A8\u5F88\u5927\uFF0C\u6709\u7684\u6CE2\u52A8\u5F88\u5C0F\u3002</p><p>\u5982\u679C\u8FD9\u4E24\u7C7B\u80A1\u7968\u7528\u540C\u6837\u7684\u8D44\u91D1\u8D2D\u4E70\uFF0C\u90A3\u4E48\u80A1\u6027\u6D3B\u8DC3\u7684\u80A1\u7968\u5E26\u6765\u7684\u4E8F\u635F\u548C\u76C8\u5229\u90FD\u4F1A\u8D85\u8FC7\u80A1\u6027\u76F8\u5BF9\u4E0D\u6D3B\u8DC3\u7684\u3002\u5018\u82E5\u80A1\u6027\u76F8\u5BF9\u4E0D\u6D3B\u8DC3\u7684\u80A1\u7968\u6DA8\u5F97\u5C11\uFF0C\u80A1\u6027\u6D3B\u8DC3\u7684\u80A1\u7968\u8DCC\u7684\u591A\uFF0C\u90A3\u4E48\u603B\u8D44\u91D1\u4F9D\u65E7\u4F1A\u4E8F\u635F\u3002</p><p>\u56E0\u6B64\u53EF\u4EE5\u5229\u7528ATR\u6765\u5206\u914D\u8D44\u91D1\u89E3\u51B3\u8FD9\u4E2A\u95EE\u9898\uFF0C\u5373\u8BA9\u6240\u6709\u8D44\u91D1\u7684\u56FA\u5B9A\u767E\u5206\u6BD4\u4E0E\u67D0\u4E2A\u80A1\u79681\u4E2AATR\u7684\u6CE2\u52A8\u5BF9\u5E94\u3002</p><p>1\u67081\u65E5\u80A1\u7968A\u7684\u6536\u76D8\u4EF7\u4E3A4.12\u5143\uFF0C14\u65E5ATR\u4E3A0.15\u5143\uFF0C\u76F8\u5F53\u4E8E\u6536\u76D8\u4EF7\u76843.64%\uFF1B1\u67081\u65E5\u80A1\u7968B\u7684\u6536\u76D8\u4EF7\u4E3A30.85\u5143\uFF0C14\u65E5ATR\u4E3A2.74\u5143\uFF0C\u76F8\u5F53\u4E8E\u6536\u76D8\u4EF7\u76848.88%\uFF1B\u663E\u7136\u540E\u8005\u80A1\u6027\u6BD4\u524D\u8005\u66F4\u6D3B\u8DC3\u3002</p><p>\u5047\u8BBE\u624B\u5934\u670910\u4E07\u5143\u8D44\u91D1\uFF0C\u6211\u4EEC\u5C31\u53EF\u4EE5\u8BBE\u5B9A\u8BA9\u4E0A\u8FF0\u4E24\u4E2A\u80A1\u79681\u4E2AATR\u7684\u6CE2\u52A8\u7B49\u4EF7\u4E8E\u603B\u8D44\u91D11%\u7684\u6CE2\u52A8\uFF0C\u90A3\u4E4810\u4E07\u5143\u76841%\u4E3A1000\u5143\u3002</p><p>\u80A1\u7968A\uFF1A1000\xF70.15=6666\uFF0C\u5373\u6211\u4EEC\u5E94\u5F53\u4E70\u51656666\u80A1\uFF0C\u6309\u7167\u5F53\u65E54.12\u5143\u6536\u76D8\u4EF7\u8BA1\u7B97\uFF0C\u6D89\u53CA\u8D44\u91D12. 74\u4E07\u5143\uFF1B</p><p>\u4E0E\u6B64\u540C\u65F6\uFF0C1000\xF72.74=364\uFF0C\u5373\u6211\u4EEC\u5E94\u5F53\u4E70\u5165364\u80A1\u80A1\u7968B\uFF0C\u6309\u7167\u5F53\u65E530.85\u5143\u6536\u76D8\u4EF7\u8BA1\u7B97\uFF0C\u6D89\u53CA\u8D44\u91D11. 125\u4E07\u5143\u3002</p><p>\u901A\u8FC7\u8D44\u91D1\u5206\u914D\u7684\u4E0D\u540C\uFF0C\u6211\u4EEC\u5927\u4F53\u53EF\u4EE5\u4F7F\u8FD9\u4E24\u4E2A\u80A1\u7968\u7684\u6B63\u5E38\u6CE2\u52A8\u5BF9\u6295\u8D44\u7EC4\u5408\u7684\u5F71\u54CD\u5927\u81F4\u76F8\u7B49\uFF0C\u4E0D\u4F1A\u8FC7\u5206\u53D7\u5230\u80A1\u7968B\u7684\u5F71\u54CD\u3002</p><h2 id="atr\u5934\u5BF8\u7BA1\u7406\u7684\u5B9E\u73B0" tabindex="-1">ATR\u5934\u5BF8\u7BA1\u7406\u7684\u5B9E\u73B0 <a class="header-anchor" href="#atr\u5934\u5BF8\u7BA1\u7406\u7684\u5B9E\u73B0" aria-hidden="true">#</a></h2><p>\u5173\u4E8E\u5934\u5BF8\u7BA1\u7406\u7684\u539F\u7406\u4E0E\u8D44\u91D1\u5206\u914D\u5927\u4F53\u76F8\u540C\u3002\u300A\u6D77\u9F9F\u4EA4\u6613\u6CD5\u5219\u300B\u5EFA\u8BAE\u7B2C\u4E00\u7B14\u4ED3\u4F4D\u7684\u4E00\u4E2AATR\u6CE2\u52A8\u4E0E\u603B\u8D44\u91D11%\u6CE2\u52A8\u76F8\u5BF9\u5E94\u3002\u5373\uFF1A\u4E70\u5165\u80A1\u7968\u6570\u91CF * ATR = \u8D44\u91D1 * 1% \u5047\u59821\u67081\u65E5\u80A1\u7968A\u5411\u4E0A\u7A81\u78344.12\u5143\u51FA\u73B0\u4E70\u5165\u70B9\uFF0C\u624B\u4E0A\u670910\u4E07\u5143\u8D44\u91D1\uFF0C\u90A3\u4E4810\u4E07\u8D44\u91D1\u76841%\u6CE2\u52A8\u5C31\u662F1000\u5143\u3002\u622A\u6B621\u67081\u65E5\uFF0C\u80A1\u7968A\u768414\u65E5ATR\u4E3A0.15\u5143\uFF0C1000\u5143\xF70.15\u5143=6666\u80A1\u3002\u4E5F\u5C31\u662F\u8BF4\uFF0C\u5934\u5BF8\u89C4\u6A21\u5E94\u8BE5\u662F\u4E70\u51656666\u80A1\uFF0C\u8017\u8D442. 74\u4E07\u5143\u3002</p><p>\u9996\u5148\u521B\u5EFA\u8D26\u6237\u7C7BST_Account\uFF0C\u8BE5\u7C7B\u4E2D\u63D0\u4F9B\u4E86\u5F53\u524D\u8D26\u6237\u7684\u5269\u4F59\u8D44\u91D1\u3001\u6301\u4ED3\u80A1\u6570\u3001\u603B\u8D44\u4EA7\u3001\u4EA4\u6613\u64CD\u4F5C\u7B49\u63A5\u53E3\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">class ST_Account:</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    def __init__(</span></span>
<span class="line"><span style="color:#A6ACCD;">            self,</span></span>
<span class="line"><span style="color:#A6ACCD;">            init_hold={},</span></span>
<span class="line"><span style="color:#A6ACCD;">            init_cash=1000000,</span></span>
<span class="line"><span style="color:#A6ACCD;">            commission_coeff=0,</span></span>
<span class="line"><span style="color:#A6ACCD;">            tax_coeff= 0):</span></span>
<span class="line"><span style="color:#A6ACCD;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        :param [dict] init_hold         \u521D\u59CB\u5316\u65F6\u7684\u80A1\u7968\u8D44\u4EA7</span></span>
<span class="line"><span style="color:#A6ACCD;">        :param [float] init_cash:         \u521D\u59CB\u5316\u8D44\u91D1</span></span>
<span class="line"><span style="color:#A6ACCD;">        :param [float] commission_coeff:  \u4EA4\u6613\u4F63\u91D1 :\u9ED8\u8BA4 \u4E072.5(float\u7C7B\u578B 0.00025) \u6B64\u5904\u4F8B\u7A0B\u8BBE\u5B9A\u4E3A0</span></span>
<span class="line"><span style="color:#A6ACCD;">        :param [float] tax_coeff:         \u5370\u82B1\u7A0E   :\u9ED8\u8BA4 \u53431.5(float\u7C7B\u578B 0.001) \u6B64\u5904\u4F8B\u7A0B\u8BBE\u5B9A\u4E3A0</span></span>
<span class="line"><span style="color:#A6ACCD;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        self.hold = init_hold</span></span>
<span class="line"><span style="color:#A6ACCD;">        self.cash = init_cash</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    def hold_available(self, code=None):</span></span>
<span class="line"><span style="color:#A6ACCD;">        &quot;&quot;&quot;\u53EF\u7528\u6301\u4ED3&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        if code in self.hold:</span></span>
<span class="line"><span style="color:#A6ACCD;">            return self.hold[code]</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    def cash_available(self):</span></span>
<span class="line"><span style="color:#A6ACCD;">        &quot;&quot;&quot;\u53EF\u7528\u8D44\u91D1&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        return self.cash</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    def latest_assets(self, price):</span></span>
<span class="line"><span style="color:#A6ACCD;">        # return the lastest hold \u603B\u8D44\u4EA7</span></span>
<span class="line"><span style="color:#A6ACCD;">        assets_val = 0</span></span>
<span class="line"><span style="color:#A6ACCD;">        for code_hold in self.hold.values():</span></span>
<span class="line"><span style="color:#A6ACCD;">            assets_val += code_hold * price</span></span>
<span class="line"><span style="color:#A6ACCD;">        assets_val += self.cash</span></span>
<span class="line"><span style="color:#A6ACCD;">        return assets_val</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    def send_order(self, code=None, amount=None, price=None, order_type=None):</span></span>
<span class="line"><span style="color:#A6ACCD;">        if order_type == &#39;buy&#39;:</span></span>
<span class="line"><span style="color:#A6ACCD;">            self.cash = self.cash - amount * price</span></span>
<span class="line"><span style="color:#A6ACCD;">            self.hold[code] = amount</span></span>
<span class="line"><span style="color:#A6ACCD;">        else:</span></span>
<span class="line"><span style="color:#A6ACCD;">            self.cash = self.cash + amount * price</span></span>
<span class="line"><span style="color:#A6ACCD;">            self.hold[code] -= amount</span></span>
<span class="line"><span style="color:#A6ACCD;">            if self.hold[code] == 0:</span></span>
<span class="line"><span style="color:#A6ACCD;">                del self.hold[code]  # \u5220\u9664\u8BE5\u80A1\u7968</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u6B64\u5904\u4E3A\u4E86\u4FA7\u91CD\u4ECB\u7ECD\u8D44\u91D1\u7BA1\u7406\uFF0C\u7B80\u5316\u4E86\u8D26\u6237\u4E2D\u7684\u4E00\u4E9B\u7EC6\u8282\uFF0C\u6682\u65F6\u4E0D\u8003\u8651\u4F63\u91D1\u548C\u5370\u82B1\u7A0E\u3002 \u6211\u4EEC\u5206\u522B\u8BBE\u7ACB\u4E24\u4E2A\u8D26\u6237\uFF0C\u4EE5\u6D77\u9F9F\u4EA4\u6613\u6CD5\u5219\u4E2DN\u65E5\u901A\u9053\u7A81\u7834\u7B56\u7565\u4E3A\u4F8B\uFF0C\u5BF9\u6BD4\u4E0B\u5168\u4ED3\u4E70\u5165\u548CATR\u5934\u5BF8\u89C4\u6A21\u4E70\u5165\u7684\u8D44\u91D1\u6536\u76CA\u3002</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">self.account_a = ST_Account(dict(), 100000) # \u8D26\u6237A \u6301\u80A1\u6570\u76EE\u548C\u521D\u59CB\u8D44\u91D1</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">self.account_b = ST_Account(dict(), 100000) # \u8D26\u6237B \u6301\u80A1\u6570\u76EE\u548C\u521D\u59CB\u8D44\u91D1</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u4E70\u5165\u90E8\u5206\u4EE3\u7801\u66F4\u6539\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">self.account_a.send_order(code = &quot;600410.SS&quot;,</span></span>
<span class="line"><span style="color:#A6ACCD;">                          amount = int(self.account_a.cash_available() / today.Close),</span></span>
<span class="line"><span style="color:#A6ACCD;">                          price = today.Close, order_type=&#39;buy&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">self.account_b.send_order(code = &quot;600410.SS&quot;,</span></span>
<span class="line"><span style="color:#A6ACCD;">                          amount = int(self.account_b.cash_available() * 0.01 / today.atr14),</span></span>
<span class="line"><span style="color:#A6ACCD;">                          price = today.Close, order_type=&#39;buy&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u5356\u51FA\u90E8\u5206\u4EE3\u7801\u66F4\u6539\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">self.account_a.send_order(code = &quot;600410.SS&quot;,</span></span>
<span class="line"><span style="color:#A6ACCD;">                          amount= self.account_a.hold_available(code = &quot;600410.SS&quot;),</span></span>
<span class="line"><span style="color:#A6ACCD;">                          price = today.Close, order_type=&#39;sell&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">self.account_b.send_order(code=&quot;600410.SS&quot;,</span></span>
<span class="line"><span style="color:#A6ACCD;">                          amount = self.account_b.hold_available(code = &quot;600410.SS&quot;),</span></span>
<span class="line"><span style="color:#A6ACCD;">                          price = today.Close, order_type=&#39;sell&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u5BF9\u6BD4\u56DE\u6D4B\u6548\u679C\u5982\u4E0B\u56FE\u6240\u793A\uFF0C\u4ECE\u6536\u76CA\u66F2\u7EBF\u53EF\u4EE5\u770B\u51FA\u589E\u52A0\u5934\u5BF8\u7BA1\u7406\u4E4B\u540E\u66F2\u7EBF\u6CE2\u52A8\u5E45\u5EA6\u8D8B\u7F13\uFF1A</p><p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2020/1/11/16f930e6a0ecb86c~tplv-t2oaga2asx-image.image" alt=""></p><p>\u5B8C\u6574\u4EE3\u7801\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">class draw_graph:</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    def __init__(self, draw_obj, stock_obj):</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">        self.fig = draw_obj</span></span>
<span class="line"><span style="color:#A6ACCD;">        self.stockdat = stock_obj</span></span>
<span class="line"><span style="color:#A6ACCD;">        # \u521B\u5EFA\u5B50\u56FE\u8868</span></span>
<span class="line"><span style="color:#A6ACCD;">        gs = gridspec.GridSpec(3, 1, left=0.05, bottom=0.1, right=0.96, top=0.96, wspace=None, hspace=0.05,</span></span>
<span class="line"><span style="color:#A6ACCD;">                               height_ratios=[4, 2, 2])</span></span>
<span class="line"><span style="color:#A6ACCD;">        self.gtrade = self.fig.add_subplot(gs[0, :])</span></span>
<span class="line"><span style="color:#A6ACCD;">        self.gtotal = self.fig.add_subplot(gs[1, :])</span></span>
<span class="line"><span style="color:#A6ACCD;">        self.gprofit = self.fig.add_subplot(gs[2, :])</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">        # \u521D\u59CB\u5316\u53D8\u91CF</span></span>
<span class="line"><span style="color:#A6ACCD;">        self.skip_days = 0</span></span>
<span class="line"><span style="color:#A6ACCD;">        self.account_a = ST_Account(dict(), 100000) # \u8D26\u6237A \u6301\u80A1\u6570\u76EE\u548C\u521D\u59CB\u8D44\u91D1</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">        self.account_b = ST_Account(dict(), 100000) # \u8D26\u6237B \u6301\u80A1\u6570\u76EE\u548C\u521D\u59CB\u8D44\u91D1</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    def draw_trade(self):</span></span>
<span class="line"><span style="color:#A6ACCD;">        self.stockdat[&#39;max_close&#39;] = df_stockload[&#39;Close&#39;].expanding().max()</span></span>
<span class="line"><span style="color:#A6ACCD;">        self.stockdat[[&#39;max_close&#39;, &#39;Close&#39;]].plot(grid=True, ax=self.gtrade)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">        for kl_index, today in self.stockdat.iterrows():</span></span>
<span class="line"><span style="color:#A6ACCD;">            # \u4E70\u5165/\u5356\u51FA\u6267\u884C\u4EE3\u7801</span></span>
<span class="line"><span style="color:#A6ACCD;">            if today.signal == 1 and self.skip_days == 0:  # \u4E70\u5165</span></span>
<span class="line"><span style="color:#A6ACCD;">                start = self.stockdat.index.get_loc(kl_index)</span></span>
<span class="line"><span style="color:#A6ACCD;">                print(&quot;buy&quot;,kl_index)</span></span>
<span class="line"><span style="color:#A6ACCD;">                self.skip_days = -1</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">                self.account_a.send_order(code = &quot;600410.SS&quot;,</span></span>
<span class="line"><span style="color:#A6ACCD;">                                          amount = int(self.account_a.cash_available() / today.Close),</span></span>
<span class="line"><span style="color:#A6ACCD;">                                          price = today.Close, order_type=&#39;buy&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">                self.account_b.send_order(code = &quot;600410.SS&quot;,</span></span>
<span class="line"><span style="color:#A6ACCD;">                                          amount = int(self.account_b.cash_available() * 0.01 / today.atr14),</span></span>
<span class="line"><span style="color:#A6ACCD;">                                          price = today.Close, order_type=&#39;buy&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">                self.gtrade.annotate(&#39;\u4E70\u5165&#39;, xy=(kl_index, self.stockdat.Close.asof(kl_index)),</span></span>
<span class="line"><span style="color:#A6ACCD;">                                     xytext=(kl_index, self.stockdat.Close.asof(kl_index) + 2),</span></span>
<span class="line"><span style="color:#A6ACCD;">                                     arrowprops=dict(facecolor=&#39;r&#39;, shrink=0.1), horizontalalignment=&#39;left&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">                                     verticalalignment=&#39;top&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">            elif today.signal == 0 and self.skip_days == -1:  # \u5356\u51FA \u907F\u514D\u672A\u4E70\u5148\u5356</span></span>
<span class="line"><span style="color:#A6ACCD;">                end = self.stockdat.index.get_loc(kl_index)</span></span>
<span class="line"><span style="color:#A6ACCD;">                print(&quot;sell&quot;, kl_index)</span></span>
<span class="line"><span style="color:#A6ACCD;">                self.skip_days = 0</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">                self.account_a.send_order(code = &quot;600410.SS&quot;,</span></span>
<span class="line"><span style="color:#A6ACCD;">                                          amount= self.account_a.hold_available(code = &quot;600410.SS&quot;),</span></span>
<span class="line"><span style="color:#A6ACCD;">                                          price = today.Close, order_type=&#39;sell&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">                self.account_b.send_order(code=&quot;600410.SS&quot;,</span></span>
<span class="line"><span style="color:#A6ACCD;">                                          amount = self.account_b.hold_available(code = &quot;600410.SS&quot;),</span></span>
<span class="line"><span style="color:#A6ACCD;">                                          price = today.Close, order_type=&#39;sell&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">                if self.stockdat.Close[end] &lt; self.stockdat.Close[start]:  # \u8D54\u94B1\u663E\u793A\u7EFF\u8272</span></span>
<span class="line"><span style="color:#A6ACCD;">                    self.gtrade.fill_between(self.stockdat.index[start:end], 0, self.stockdat.Close[start:end], color=&#39;green&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">                                             alpha=0.38)</span></span>
<span class="line"><span style="color:#A6ACCD;">                else:  # \u8D5A\u94B1\u663E\u793A\u7EA2\u8272</span></span>
<span class="line"><span style="color:#A6ACCD;">                    self.gtrade.fill_between(self.stockdat.index[start:end], 0, self.stockdat.Close[start:end], color=&#39;red&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">                                             alpha=0.38)</span></span>
<span class="line"><span style="color:#A6ACCD;">                self.gtrade.annotate(&#39;\u5356\u51FA&#39;, xy=(kl_index, self.stockdat.Close.asof(kl_index)),</span></span>
<span class="line"><span style="color:#A6ACCD;">                                     xytext=(kl_index + datetime.timedelta(days=5), self.stockdat.Close.asof(kl_index) + 2),</span></span>
<span class="line"><span style="color:#A6ACCD;">                                     arrowprops=dict(facecolor=&#39;g&#39;, shrink=0.1), horizontalalignment=&#39;left&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">                                     verticalalignment=&#39;top&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">            # \u8D26\u6237A \u8D44\u4EA7\u66F2\u7EBF</span></span>
<span class="line"><span style="color:#A6ACCD;">            # \u8D26\u6237B \u8D44\u4EA7\u66F2\u7EBF </span></span>
<span class="line"><span style="color:#A6ACCD;">            self.stockdat.loc[kl_index, &#39;total_a&#39;] = self.account_a.latest_assets(today.Close)</span></span>
<span class="line"><span style="color:#A6ACCD;">            self.stockdat.loc[kl_index, &#39;total_b&#39;] = self.account_b.latest_assets(today.Close)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    def draw_total(self):</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">        # \u8BA1\u7B97\u8D44\u91D1\u66F2\u7EBF\u5F53\u524D\u7684\u6EDA\u52A8\u6700\u9AD8\u503C</span></span>
<span class="line"><span style="color:#A6ACCD;">        self.stockdat[[&#39;total_a&#39;, &#39;total_b&#39;]].plot(grid=True, ax=self.gtotal)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    def draw_profit(self):</span></span>
<span class="line"><span style="color:#A6ACCD;">        # \u8BA1\u7B97\u57FA\u51C6\u6536\u76CA/\u8D8B\u52BF\u7A81\u7834\u7B56\u7565\u6536\u76CA</span></span>
<span class="line"><span style="color:#A6ACCD;">        self.stockdat[&#39;benchmark_profit&#39;] = np.log(self.stockdat.Close / self.stockdat.Close.shift(1))</span></span>
<span class="line"><span style="color:#A6ACCD;">        self.stockdat[&#39;trend_profit&#39;] = self.stockdat.signal * self.stockdat.benchmark_profit</span></span>
<span class="line"><span style="color:#A6ACCD;">        self.stockdat[[&#39;benchmark_profit&#39;, &#39;trend_profit&#39;]].cumsum().plot(grid=True, ax=self.gprofit)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    def draw_config(self):</span></span>
<span class="line"><span style="color:#A6ACCD;">        self.draw_trade()</span></span>
<span class="line"><span style="color:#A6ACCD;">        self.draw_total()</span></span>
<span class="line"><span style="color:#A6ACCD;">        self.draw_profit()</span></span>
<span class="line"><span style="color:#A6ACCD;">        # \u56FE\u8868\u663E\u793A\u53C2\u6570\u914D\u7F6E</span></span>
<span class="line"><span style="color:#A6ACCD;">        for label in self.gtrade.xaxis.get_ticklabels():</span></span>
<span class="line"><span style="color:#A6ACCD;">            label.set_visible(False)</span></span>
<span class="line"><span style="color:#A6ACCD;">        for label in self.gtotal.xaxis.get_ticklabels():</span></span>
<span class="line"><span style="color:#A6ACCD;">            label.set_visible(False)</span></span>
<span class="line"><span style="color:#A6ACCD;">        for label in self.gprofit.xaxis.get_ticklabels():</span></span>
<span class="line"><span style="color:#A6ACCD;">            label.set_rotation(45)</span></span>
<span class="line"><span style="color:#A6ACCD;">            label.set_fontsize(10)  # \u8BBE\u7F6E\u6807\u7B7E\u5B57\u4F53</span></span>
<span class="line"><span style="color:#A6ACCD;">        self.gtrade.set_xlabel(&quot;&quot;)</span></span>
<span class="line"><span style="color:#A6ACCD;">        self.gtrade.set_title(u&#39;\u534E\u80DC\u5929\u6210 \u6536\u76CA\u4E0E\u98CE\u9669\u5EA6\u91CF&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">        self.gtotal.set_xlabel(&quot;&quot;)</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span></span>
<span class="line"><span style="color:#A6ACCD;">df_stockload = GetStockDatApi(&quot;600410.SS&quot;,datetime.datetime(2018, 1, 1), datetime.datetime(2019, 4, 1))#\u534E\u80DC\u5929\u6210</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">fig = plt.figure(figsize=(16, 8), dpi=100, facecolor=&quot;white&quot;) # \u521B\u5EFAfig\u5BF9\u8C61</span></span>
<span class="line"><span style="color:#A6ACCD;">app_graph_a = draw_graph(fig, df_stockload)</span></span>
<span class="line"><span style="color:#A6ACCD;">app_graph_a.draw_config()</span></span>
<span class="line"><span style="color:#A6ACCD;">plt.show()</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><h2 id="atr\u52A8\u6001\u4ED3\u4F4D\u8C03\u6574" tabindex="-1">ATR\u52A8\u6001\u4ED3\u4F4D\u8C03\u6574 <a class="header-anchor" href="#atr\u52A8\u6001\u4ED3\u4F4D\u8C03\u6574" aria-hidden="true">#</a></h2><p>\u5F53\u6211\u4EEC\u4EE5\u4E00\u4E2AATR\u6CE2\u52A8\u4E0E\u603B\u8D44\u91D11%\u6CE2\u52A8\u76F8\u5BF9\u5E94\u7684\u7B56\u7565\u4E70\u5165\u4E866666\u80A1\u3002\u5047\u5982\u4E70\u5B8C\u4E4B\u540E\u80A1\u7968\u957F\u671F\u76D8\u6574\uFF0C\u65E2\u65E0\u5927\u6DA8\u4E5F\u65E0\u5927\u8DCC\uFF0C\u6B64\u65F6ATR\u4F1A\u8FDB\u4E00\u6B65\u4E0B\u8DCC\uFF0C\u6BD4\u5982\u75310.15\u5143\u4E0B\u964D\u81F30.12\u5143\u65F6\uFF0C\u6295\u8D44\u8005\u4FBF\u53EF\u91CD\u65B0\u8BA1\u7B97\u4ED3\u4F4D\u3002\u4F9D\u65E7\u6309\u71671%\u8D44\u91D1=1ATR\u6CE2\u52A8\u8BA1\u7B97\uFF0C\u5219\u53EF\u6301\u67098333\u80A1\uFF0C\u6B64\u524D\u5DF2\u7ECF\u4E70\u51656666\u80A1\uFF0C\u5219\u6295\u8D44\u8005\u8FD8\u53EF\u52A0\u4ED31667\u80A1\u3002</p><p>\u5B9E\u73B0\u4EE3\u7801\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">if((posit_num_wave - self.account_b.hold_available(code = &quot;600410.SS&quot;)) &gt;= self.adjust_hold): # \u6CE2\u52A8\u540E\u52A0\u4ED3</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    print(&quot;adjust buy&quot;, kl_index)</span></span>
<span class="line"><span style="color:#A6ACCD;">    self.account_b.send_order(code=&quot;600410.SS&quot;,</span></span>
<span class="line"><span style="color:#A6ACCD;">                              amount=int(posit_num_wave - self.account_b.hold_available(code = &quot;600410.SS&quot;)),</span></span>
<span class="line"><span style="color:#A6ACCD;">                              price=today.Close, order_type=&#39;buy&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">elif (self.account_b.hold_available(code = &quot;600410.SS&quot;) - posit_num_wave) &gt; self.adjust_hold:</span></span>
<span class="line"><span style="color:#A6ACCD;">    print(&quot;adjust sell&quot;, kl_index)</span></span>
<span class="line"><span style="color:#A6ACCD;">    self.account_b.send_order(code=&quot;600410.SS&quot;,</span></span>
<span class="line"><span style="color:#A6ACCD;">                              amount=int(self.account_b.hold_available(code=&quot;600410.SS&quot;)- posit_num_wave),</span></span>
<span class="line"><span style="color:#A6ACCD;">                              price=today.Close, order_type=&#39;sell&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u5B8C\u6574\u4EE3\u7801\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">class draw_add_postion(draw_graph):</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    def __init__(self, draw_obj, stock_obj):</span></span>
<span class="line"><span style="color:#A6ACCD;">        draw_graph.__init__(self, draw_obj, stock_obj)</span></span>
<span class="line"><span style="color:#A6ACCD;">        self.stand_cash = 100000</span></span>
<span class="line"><span style="color:#A6ACCD;">        self.adjust_hold = 500</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    def draw_trade(self):</span></span>
<span class="line"><span style="color:#A6ACCD;">        self.stockdat[&#39;max_close&#39;] = df_stockload[&#39;Close&#39;].expanding().max()</span></span>
<span class="line"><span style="color:#A6ACCD;">        self.stockdat[[&#39;max_close&#39;, &#39;Close&#39;]].plot(grid=True, ax=self.gtrade)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">        for kl_index, today in self.stockdat.iterrows():</span></span>
<span class="line"><span style="color:#A6ACCD;">            # \u4E70\u5165/\u5356\u51FA\u6267\u884C\u4EE3\u7801</span></span>
<span class="line"><span style="color:#A6ACCD;">            if today.signal == 1 and self.skip_days == 0:  # \u4E70\u5165</span></span>
<span class="line"><span style="color:#A6ACCD;">                start = self.stockdat.index.get_loc(kl_index)</span></span>
<span class="line"><span style="color:#A6ACCD;">                print(&quot;buy&quot;,kl_index)</span></span>
<span class="line"><span style="color:#A6ACCD;">                self.skip_days = -1</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">                self.account_a.send_order(code = &quot;600410.SS&quot;,</span></span>
<span class="line"><span style="color:#A6ACCD;">                                          amount = int(self.account_a.cash_available() / today.Close),</span></span>
<span class="line"><span style="color:#A6ACCD;">                                          price = today.Close, order_type=&#39;buy&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">                self.account_b.send_order(code = &quot;600410.SS&quot;,</span></span>
<span class="line"><span style="color:#A6ACCD;">                                          amount = int(self.account_b.cash_available() * 0.01 / today.atr14),</span></span>
<span class="line"><span style="color:#A6ACCD;">                                          price = today.Close, order_type=&#39;buy&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">                self.gtrade.annotate(&#39;\u4E70\u5165&#39;, xy=(kl_index, self.stockdat.Close.asof(kl_index)),</span></span>
<span class="line"><span style="color:#A6ACCD;">                                     xytext=(kl_index, self.stockdat.Close.asof(kl_index) + 2),</span></span>
<span class="line"><span style="color:#A6ACCD;">                                     arrowprops=dict(facecolor=&#39;r&#39;, shrink=0.1), horizontalalignment=&#39;left&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">                                     verticalalignment=&#39;top&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">            elif today.signal == 0 and self.skip_days == -1:  # \u5356\u51FA \u907F\u514D\u672A\u4E70\u5148\u5356</span></span>
<span class="line"><span style="color:#A6ACCD;">                end = self.stockdat.index.get_loc(kl_index)</span></span>
<span class="line"><span style="color:#A6ACCD;">                print(&quot;sell&quot;, kl_index)</span></span>
<span class="line"><span style="color:#A6ACCD;">                self.skip_days = 0</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">                self.account_a.send_order(code = &quot;600410.SS&quot;,</span></span>
<span class="line"><span style="color:#A6ACCD;">                                          amount= self.account_a.hold_available(code = &quot;600410.SS&quot;),</span></span>
<span class="line"><span style="color:#A6ACCD;">                                          price = today.Close, order_type=&#39;sell&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">                self.account_b.send_order(code=&quot;600410.SS&quot;,</span></span>
<span class="line"><span style="color:#A6ACCD;">                                          amount = self.account_b.hold_available(code = &quot;600410.SS&quot;),</span></span>
<span class="line"><span style="color:#A6ACCD;">                                          price = today.Close, order_type=&#39;sell&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">                if self.stockdat.Close[end] &lt; self.stockdat.Close[start]:  # \u8D54\u94B1\u663E\u793A\u7EFF\u8272</span></span>
<span class="line"><span style="color:#A6ACCD;">                    self.gtrade.fill_between(self.stockdat.index[start:end], 0, self.stockdat.Close[start:end], color=&#39;green&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">                                             alpha=0.38)</span></span>
<span class="line"><span style="color:#A6ACCD;">                else:  # \u8D5A\u94B1\u663E\u793A\u7EA2\u8272</span></span>
<span class="line"><span style="color:#A6ACCD;">                    self.gtrade.fill_between(self.stockdat.index[start:end], 0, self.stockdat.Close[start:end], color=&#39;red&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">                                             alpha=0.38)</span></span>
<span class="line"><span style="color:#A6ACCD;">                self.gtrade.annotate(&#39;\u5356\u51FA&#39;, xy=(kl_index, self.stockdat.Close.asof(kl_index)),</span></span>
<span class="line"><span style="color:#A6ACCD;">                                     xytext=(kl_index + datetime.timedelta(days=5), self.stockdat.Close.asof(kl_index) + 2),</span></span>
<span class="line"><span style="color:#A6ACCD;">                                     arrowprops=dict(facecolor=&#39;g&#39;, shrink=0.1), horizontalalignment=&#39;left&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">                                     verticalalignment=&#39;top&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">            if self.skip_days == -1:</span></span>
<span class="line"><span style="color:#A6ACCD;">                posit_num_wave = int(self.account_b.latest_assets(today.Close) * 0.01 / today.atr14) # \u52A8\u6001\u8BA1\u7B97\u6301\u4ED3\u7684\u80A1\u7968\u6570\u91CF</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">                if((posit_num_wave - self.account_b.hold_available(code = &quot;600410.SS&quot;)) &gt;= self.adjust_hold): # \u6CE2\u52A8\u540E\u52A0\u4ED3</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">                    print(&quot;adjust buy&quot;, kl_index)</span></span>
<span class="line"><span style="color:#A6ACCD;">                    self.account_b.send_order(code=&quot;600410.SS&quot;,</span></span>
<span class="line"><span style="color:#A6ACCD;">                                              amount=int(posit_num_wave - self.account_b.hold_available(code = &quot;600410.SS&quot;)),</span></span>
<span class="line"><span style="color:#A6ACCD;">                                              price=today.Close, order_type=&#39;buy&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">                elif (self.account_b.hold_available(code = &quot;600410.SS&quot;) - posit_num_wave) &gt; self.adjust_hold:</span></span>
<span class="line"><span style="color:#A6ACCD;">                    print(&quot;adjust sell&quot;, kl_index)</span></span>
<span class="line"><span style="color:#A6ACCD;">                    self.account_b.send_order(code=&quot;600410.SS&quot;,</span></span>
<span class="line"><span style="color:#A6ACCD;">                                              amount=int(self.account_b.hold_available(code=&quot;600410.SS&quot;)- posit_num_wave),</span></span>
<span class="line"><span style="color:#A6ACCD;">                                              price=today.Close, order_type=&#39;sell&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">            # \u8D26\u6237A \u8D44\u4EA7\u66F2\u7EBF</span></span>
<span class="line"><span style="color:#A6ACCD;">            # \u8D26\u6237B \u8D44\u4EA7\u66F2\u7EBF</span></span>
<span class="line"><span style="color:#A6ACCD;">            self.stockdat.loc[kl_index, &#39;total_a&#39;] = self.account_a.latest_assets(today.Close)</span></span>
<span class="line"><span style="color:#A6ACCD;">            self.stockdat.loc[kl_index, &#39;total_b&#39;] = self.account_b.latest_assets(today.Close)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">df_stockload = GetStockDatApi(&quot;600410.SS&quot;,datetime.datetime(2018, 1, 1), datetime.datetime(2019, 4, 1))#\u534E\u80DC\u5929\u6210</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">fig = plt.figure(figsize=(16, 8), dpi=100, facecolor=&quot;white&quot;) # \u521B\u5EFAfig\u5BF9\u8C61</span></span>
<span class="line"><span style="color:#A6ACCD;">app_graph_b = draw_add_postion(fig, df_stockload)</span></span>
<span class="line"><span style="color:#A6ACCD;">app_graph_b.draw_config()</span></span>
<span class="line"><span style="color:#A6ACCD;">plt.show()</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><h2 id="atr\u52A8\u6001\u6B62\u635F\u4EF7\u4F4D" tabindex="-1">ATR\u52A8\u6001\u6B62\u635F\u4EF7\u4F4D <a class="header-anchor" href="#atr\u52A8\u6001\u6B62\u635F\u4EF7\u4F4D" aria-hidden="true">#</a></h2><p>\u5728\u4EA4\u6613\u7CFB\u7EDF\u4E2D\u6B62\u635F\u6280\u672F\u662F\u98CE\u9669\u63A7\u5236\u7684\u4E00\u79CD\u624B\u6BB5\uFF0C\u540C\u65F6\u4E5F\u662F\u4EA4\u6613\u7CFB\u7EDF\u4E2D\u6700\u540E\u7684\u9632\u7EBF\u3002\u9664\u975E\u662F\u5DF4\u83F2\u7279\u8FD9\u6837\u7684\u7EDD\u5BF9\u4EF7\u503C\u6295\u8D44\u8005\uFF0C\u5426\u5219\u6295\u8D44\u8005\u5728\u4E70\u5165\u7684\u540C\u65F6\u8BBE\u5B9A\u6B62\u635F\u662F\u6781\u5176\u91CD\u8981\u7684\u4E8B\u60C5\u3002</p><p>\u4E0D\u540C\u7684\u4EA4\u6613\u8005\uFF0C\u5F80\u5F80\u4F1A\u4F7F\u7528\u4E0D\u540C\u7684\u6B62\u635F\u65B9\u6CD5\uFF0C\u6BD4\u5982\u9009\u80A1\u5927\u5E08\u6B27\u5948\u5C14\u4FBF\u63A8\u8350\u6295\u8D44\u8005\u4F7F\u75288%\u4F5C\u4E3A\u6B62\u635F\u7EBF\uFF0C\u4E00\u65E6\u4E8F\u635F\u8D85\u8FC7\u6B64\u6570\u76EE\uFF0C\u4FBF\u5272\u8089\u79BB\u573A\u3002\u5229\u7528\u56FA\u5B9A\u6BD4\u4F8B\u4F5C\u4E3A\u6B62\u635F\uFF0C\u56FA\u7136\u7B80\u5355\u6613\u7B97\uFF0C\u4F46\u95EE\u9898\u8FD8\u662F\u5728\u4E8E\u524D\u9762\u8BB2\u5230\u7684\u80A1\u6027\u533A\u522B\u3002\u82E5\u80A1\u7968A\u8FD9\u6837\u6CE2\u52A8\u8F83\u5C0F\u7684\u54C1\u79CD\u548C\u80A1\u7968B\u8FD9\u6837\u6CE2\u52A8\u8F83\u5927\u7684\u54C1\u79CD\u90FD\u9009\u62E98%\u4F5C\u4E3A\u6B62\u635F\u7EBF\uFF0C\u663E\u7136\u4E0D\u592A\u5408\u7406\u3002\u8FD9\u65F6\u5019\uFF0CATR\u5C31\u6709\u7528\u6B66\u4E4B\u5730\u4E86\u3002</p><p>\u5229\u7528ATR\u8BBE\u5B9A\u6B62\u635F\u5176\u5B9E\u5F88\u7B80\u5355\uFF0C\u5927\u4F53\u5C31\u662F\u9009\u62E9\u4E00\u4E2A\u57FA\u51C6\u4EF7\u4F4D\uFF0C\u7136\u540E\u4E58\u4EE5\u4E00\u4E2A\u7CFB\u6570\u5F97\u5230\u8C03\u6574\u540E\u7684ATR\u4F5C\u4E3A\u6B62\u635F\u4EF7\u4F4D\u3002\u5177\u4F53\u53EF\u4EE5\u53C2\u7167\u300A\u80A1\u7968\u4EA4\u6613\u7B56\u7565\uFF1A\u62E9\u65F6\u7B56\u7565\u878D\u5165ATR\u98CE\u9669\u7BA1\u7406\u300B\u4E2D\u5173\u4E8EATR\u6B62\u8D62\u6B62\u635F\u7684\u673A\u5236\u7684\u5B9E\u73B0\u3002</p><p>\u6B64\u5904\u66F4\u591A\u662F\u60F3\u5F3A\u8C03\u6B62\u635F\u673A\u5236\u7684\u91CD\u8981\u6027\u3002\u4E00\u65E6\u80A1\u4EF7\u8DCC\u7834\u6B62\u635F\u4EF7\u4F4D\uFF0C\u5C31\u5FC5\u987B100%\u7684\u6267\u884C\u5356\u51FA\u64CD\u4F5C\uFF0C\u5982\u679C\u4E0D\u5356\uFF0C\u4E00\u65E6\u6709\u6548\u8DCC\u7834\uFF0C\u7531\u4E8E\u4E4B\u540E\u5E76\u4E0D\u4F1A\u4EA7\u751F\u66F4\u597D\u7684\u5356\u51FA\u4FE1\u53F7\uFF0C\u5BFC\u81F4\u7684\u540E\u679C\u5C31\u662F\u6DF1\u5EA6\u5957\u7262\uFF0C\u5373\u4F7F\u51FA\u73B0\u8FD9\u79CD\u7ED3\u679C\u7684\u6982\u7387\u5F88\u4F4E\uFF0C\u4F5C\u4E3A\u4E00\u5957\u6210\u719F\u7684\u4EA4\u6613\u7CFB\u7EDF\uFF0C\u4E5F\u662F\u4E0D\u53EF\u63A5\u53D7\u7684\u3002\u6240\u4EE5\uFF0C\u6B62\u635F\u4EF7\u4F4D\u8BBE\u5B9A\u540E\uFF0C\u5B9E\u6218\u4E2D\u4E00\u65E6\u89E6\u53CA\uFF0C\u5C31\u5E94\u8BE5\u575A\u51B3\u6267\u884C\uFF0C\u4ECE\u957F\u8FDC\u8003\u8651\u4E3A\u4E0B\u4E00\u6B21\u4EA4\u6613\u7559\u4E0B\u8DB3\u591F\u7684\u5F39\u836F\u3002</p><p>\u603B\u7ED3</p><p>\u672C\u5C0F\u8282\u6211\u4EEC\u4ECE\u5934\u5BF8\u7BA1\u7406\u548C\u52A8\u6001\u52A0\u51CF\u4ED3\u8FD9\u4E24\u4E2A\u89D2\u5EA6\u4ECB\u7ECD\u4E86\u57FA\u4E8EATR\u6307\u6807\u7684\u52A8\u6001\u8D44\u91D1\u7BA1\u7406\u7684\u539F\u7406\u548C\u5B9E\u73B0\u65B9\u6CD5\u3002\u540C\u5B66\u4EEC\u53EF\u4EE5\u518D\u7ED3\u5408\u300A\u80A1\u7968\u4EA4\u6613\u7B56\u7565\uFF1A\u62E9\u65F6\u7B56\u7565\u878D\u5165ATR\u98CE\u9669\u7BA1\u7406\u300B\u4E2D\u5173\u4E8EATR\u6B62\u8D62\u6B62\u635F\u7684\u673A\u5236\uFF0C\u5C06\u5934\u5BF8\u7BA1\u7406\u3001\u52A8\u6001\u52A0\u51CF\u4ED3\u3001\u6B62\u8D62\u6B62\u635F\u7CFB\u7EDF\u5730\u7ED3\u5408\u4E3A\u4E00\u4E2A\u5B8C\u6574\u7684\u8D44\u91D1\u7BA1\u7406\u6A21\u5757\u3002</p>`,49),o=[e];function t(c,i,r,A,C,d){return n(),a("div",null,o)}const f=s(p,[["render",t]]);export{_ as __pageData,f as default};
