import{_ as s,c as a,o as n,d as l}from"./app.c4f45da1.js";const y=JSON.parse('{"title":"\u80A1\u7968\u4EA4\u6613\u7B56\u7565-\u6536\u76CA\u4E0E\u98CE\u9669\u7EF4\u5EA6\u5EA6\u91CF\u7B56\u7565\u6548\u679C","description":"","frontmatter":{},"headers":[{"level":2,"title":"\u524D\u8A00","slug":"\u524D\u8A00","link":"#\u524D\u8A00","children":[]},{"level":2,"title":"\u7B56\u7565\u6536\u76CA\u663E\u793A","slug":"\u7B56\u7565\u6536\u76CA\u663E\u793A","link":"#\u7B56\u7565\u6536\u76CA\u663E\u793A","children":[]},{"level":2,"title":"\u56DE\u64A4\u7684\u98CE\u9669\u5EA6\u91CF","slug":"\u56DE\u64A4\u7684\u98CE\u9669\u5EA6\u91CF","link":"#\u56DE\u64A4\u7684\u98CE\u9669\u5EA6\u91CF","children":[]},{"level":2,"title":"\u6536\u76CA\u4E0E\u98CE\u9669\u56FE\u8868\u96C6\u6210","slug":"\u6536\u76CA\u4E0E\u98CE\u9669\u56FE\u8868\u96C6\u6210","link":"#\u6536\u76CA\u4E0E\u98CE\u9669\u56FE\u8868\u96C6\u6210","children":[]},{"level":2,"title":"\u603B\u7ED3","slug":"\u603B\u7ED3","link":"#\u603B\u7ED3","children":[]}],"relativePath":"\u5176\u4ED6/Python\u6570\u636E\u5206\u6790\u5B9E\u6218\uFF1A\u6784\u5EFA\u80A1\u7968\u91CF\u5316\u4EA4\u6613\u7CFB\u7EDF/\u80A1\u7968\u4EA4\u6613\u7B56\u7565-\u6536\u76CA\u4E0E\u98CE\u9669\u7EF4\u5EA6\u5EA6\u91CF\u7B56\u7565\u6548\u679C.md"}'),p={name:"\u5176\u4ED6/Python\u6570\u636E\u5206\u6790\u5B9E\u6218\uFF1A\u6784\u5EFA\u80A1\u7968\u91CF\u5316\u4EA4\u6613\u7CFB\u7EDF/\u80A1\u7968\u4EA4\u6613\u7B56\u7565-\u6536\u76CA\u4E0E\u98CE\u9669\u7EF4\u5EA6\u5EA6\u91CF\u7B56\u7565\u6548\u679C.md"},o=l(`<h1 id="\u80A1\u7968\u4EA4\u6613\u7B56\u7565-\u6536\u76CA\u4E0E\u98CE\u9669\u7EF4\u5EA6\u5EA6\u91CF\u7B56\u7565\u6548\u679C" tabindex="-1">\u80A1\u7968\u4EA4\u6613\u7B56\u7565-\u6536\u76CA\u4E0E\u98CE\u9669\u7EF4\u5EA6\u5EA6\u91CF\u7B56\u7565\u6548\u679C <a class="header-anchor" href="#\u80A1\u7968\u4EA4\u6613\u7B56\u7565-\u6536\u76CA\u4E0E\u98CE\u9669\u7EF4\u5EA6\u5EA6\u91CF\u7B56\u7565\u6548\u679C" aria-hidden="true">#</a></h1><hr><h1 id="\u80A1\u7968\u4EA4\u6613\u7B56\u7565\uFF1A\u6536\u76CA\u4E0E\u98CE\u9669\u7EF4\u5EA6\u5EA6\u91CF\u7B56\u7565\u6548\u679C" tabindex="-1">\u80A1\u7968\u4EA4\u6613\u7B56\u7565\uFF1A\u6536\u76CA\u4E0E\u98CE\u9669\u7EF4\u5EA6\u5EA6\u91CF\u7B56\u7565\u6548\u679C <a class="header-anchor" href="#\u80A1\u7968\u4EA4\u6613\u7B56\u7565\uFF1A\u6536\u76CA\u4E0E\u98CE\u9669\u7EF4\u5EA6\u5EA6\u91CF\u7B56\u7565\u6548\u679C" aria-hidden="true">#</a></h1><h2 id="\u524D\u8A00" tabindex="-1">\u524D\u8A00 <a class="header-anchor" href="#\u524D\u8A00" aria-hidden="true">#</a></h2><p>\u867D\u7136\u638C\u63E1\u4E86N\u65E5\u7A81\u7834\u62E9\u65F6\u7B56\u7565\u7684\u5B9E\u73B0\u65B9\u6CD5\uFF0C\u4F46\u6211\u4EEC\u5E76\u4E0D\u80FD\u7ACB\u5373\u5C06\u8BE5\u7B56\u7565\u5E94\u7528\u4E8E\u5B9E\u76D8\u4EA4\u6613\u4E4B\u4E2D\uFF0C\u539F\u56E0\u5F88\u7B80\u5355\uFF0C\u6211\u4EEC\u65E0\u6CD5\u8BC4\u4EF7\u8BE5\u7B56\u7565\u7684\u5177\u4F53\u6548\u679C\u5982\u4F55\u3002\u5BF9\u6B64\uFF0C\u6211\u4EEC\u9700\u8981\u5C06\u7B56\u7565\u57FA\u4E8E\u4E00\u6BB5\u5386\u53F2\u80A1\u7968\u6570\u636E\u8FDB\u884C\u6A21\u62DF\u7684\u4E70\u5165\u548C\u5356\u51FA\uFF0C\u4EE5\u9A8C\u8BC1\u4EA4\u6613\u7B56\u7565\u7684\u53EF\u884C\u6027\uFF0C\u6211\u4EEC\u79F0\u8FD9\u4E2A\u73AF\u8282\u4E3A\u201C\u56DE\u6D4B\u9636\u6BB5\u201D\u3002</p><p>\u5728\u56DE\u6D4B\u9636\u6BB5\uFF0C\u7B56\u7565\u7684\u6536\u76CA\u548C\u98CE\u9669\u662F\u5EA6\u91CF\u7B56\u7565\u6548\u679C\u975E\u5E38\u5173\u952E\u7684\u4E24\u4E2A\u6307\u6807\uFF0C\u672C\u5C0F\u8282\u4ECB\u7ECD\u7B56\u7565\u6536\u76CA\u548C\u98CE\u9669\u7684\u5EA6\u91CF\u65B9\u6CD5\uFF0C\u5E76\u4E14\u901A\u8FC7\u76F4\u89C2\u7684\u56FE\u5F62\u5206\u6790\u6765\u4E86\u89E3\u4E0BN\u65E5\u7A81\u7834\u62E9\u65F6\u7B56\u7565\u7684\u6267\u884C\u6548\u679C\u3002</p><h2 id="\u7B56\u7565\u6536\u76CA\u663E\u793A" tabindex="-1">\u7B56\u7565\u6536\u76CA\u663E\u793A <a class="header-anchor" href="#\u7B56\u7565\u6536\u76CA\u663E\u793A" aria-hidden="true">#</a></h2><p>\u5173\u4E8E\u7B56\u7565\u7684\u6536\u76CA\u53EF\u5206\u4E3A\u7EDD\u5BF9\u6536\u76CA\u548C\u76F8\u5BF9\u6536\u76CA\uFF0C\u7EDD\u5BF9\u6536\u76CA\u6307\u7684\u662F\u6700\u7EC8\u7684\u8D44\u91D1\u6536\u76CA\u60C5\u51B5\uFF0C\u800C\u76F8\u5BF9\u6536\u76CA\u6307\u7684\u662F\u4F7F\u7528\u7B56\u7565\u7684\u6536\u76CA\u4E0E\u57FA\u51C6\u6536\u76CA\u7684\u5BF9\u6BD4\u60C5\u51B5\u3002</p><p>\u6211\u4EEC\u5EF6\u7EED\u4E0A\u4E00\u5C0F\u8282N\u65E5\u7A81\u7834\u62E9\u65F6\u7B56\u7565\u6240\u6784\u5EFA\u7684\u4E70\u5356\u4FE1\u53F7\u5E8F\u5217\uFF0C\u5728\u6B64\u57FA\u7840\u4E0A\u8BA1\u7B97\u7B56\u7565\u7684\u6536\u76CA\u60C5\u51B5\u3002\u9996\u5148\u8BA1\u7B97\u8D44\u91D1\u6536\u76CA\u66F2\u7EBF\uFF0C\u6B64\u5904\u8BBE\u7F6E\u521D\u59CB\u8D44\u91D1\u4E3A10\u4E07\u5143\uFF0C\u4E00\u65E6\u4FE1\u53F7\u89E6\u53D1\u5219\u5168\u4ED3\u64CD\u4F5C\uFF0C\u5373\u5168\u4ED3\u4E70\u5165\u80A1\u7968\u540E\u8D44\u91D1\u8F6C\u4E3A\u5E02\u503C\uFF0C\u5168\u4ED3\u5356\u51FA\u80A1\u7968\u540E\u5E02\u503C\u8F6C\u4E3A\u8D44\u91D1\u3002</p><p>\u521D\u59CB\u5316\u4EE5\u4E0B\u56DB\u4E2A\u53D8\u91CF\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">cash_hold = 100000 #\u521D\u59CB\u8D44\u91D1</span></span>
<span class="line"><span style="color:#A6ACCD;">posit_num = 0 #\u6301\u80A1\u6570\u76EE</span></span>
<span class="line"><span style="color:#A6ACCD;">market_total = 0 #\u6301\u80A1\u5E02\u503C</span></span>
<span class="line"><span style="color:#A6ACCD;">skip_days = 0 #\u6301\u80A1/\u6301\u5E01\u72B6\u6001</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u904D\u5386<code>df_stockload.signal</code>\u5E8F\u5217\uFF0C\u5F53\u7B26\u5408\u4E70\u5165/\u5356\u51FA\u64CD\u4F5C\u65F6\u6267\u884C\u76F8\u5E94\u7684\u4EE3\u7801\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">for kl_index, today in df_stockload.iterrows():</span></span>
<span class="line"><span style="color:#A6ACCD;">	#\u4E70\u5165/\u5356\u51FA\u6267\u884C\u4EE3\u7801</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u5F53\u89E6\u53D1\u4E70\u5165\u4FE1\u53F7\u65F6\uFF0C\u5982\u679C\u662F\u6301\u5E01\u72B6\u6001\u5219\u5C06\u8D44\u91D1\u8F6C\u6362\u4E3A\u80A1\u7968\uFF0C\u5F53\u89E6\u53D1\u5356\u51FA\u4FE1\u53F7\u65F6\uFF0C\u5982\u679C\u662F\u6301\u80A1\u72B6\u6001\u5219\u5C06\u80A1\u7968\u8F6C\u6362\u4E3A\u8D44\u91D1\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">#\u4E70\u5165/\u5356\u51FA\u6267\u884C\u4EE3\u7801</span></span>
<span class="line"><span style="color:#A6ACCD;">if today.signal == 1 and skip_days == 0:  # \u4E70\u5165</span></span>
<span class="line"><span style="color:#A6ACCD;">    start = df_stockload.index.get_loc(kl_index)</span></span>
<span class="line"><span style="color:#A6ACCD;">    skip_days = -1</span></span>
<span class="line"><span style="color:#A6ACCD;">    posit_num = int(cash_hold / today.Close) #\u8D44\u91D1\u8F6C\u5316\u4E3A\u80A1\u7968</span></span>
<span class="line"><span style="color:#A6ACCD;">    cash_hold = 0</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">elif today.signal == 0 and skip_days == -1:  # \u5356\u51FA \u907F\u514D\u672A\u4E70\u5148\u5356</span></span>
<span class="line"><span style="color:#A6ACCD;">    end = df_stockload.index.get_loc(kl_index) </span></span>
<span class="line"><span style="color:#A6ACCD;">    skip_days = 0</span></span>
<span class="line"><span style="color:#A6ACCD;">    cash_hold = int(posit_num * today.Close) #\u80A1\u7968\u8F6C\u5316\u4E3A\u8D44\u91D1</span></span>
<span class="line"><span style="color:#A6ACCD;">    market_total = 0</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u603B\u4F53\u6536\u76CA\u4E3A\u8D44\u91D1\u548C\u80A1\u7968\u5E02\u503C\u4E24\u8005\u7684\u7ED3\u5408\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">if skip_days == -1: #\u6301\u80A1</span></span>
<span class="line"><span style="color:#A6ACCD;">    market_total = int(posit_num * today.Close)</span></span>
<span class="line"><span style="color:#A6ACCD;">    df_stockload.loc[kl_index,&#39;total&#39;] = market_total</span></span>
<span class="line"><span style="color:#A6ACCD;">else: #\u7A7A\u4ED3</span></span>
<span class="line"><span style="color:#A6ACCD;">    df_stockload.loc[kl_index,&#39;total&#39;] = cash_hold</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">print(df_stockload.total)    </span></span>
<span class="line"><span style="color:#A6ACCD;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">Date</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-08    100000.0</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-09    100000.0</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-10    100000.0</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-11    100000.0</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-12    100000.0</span></span>
<span class="line"><span style="color:#A6ACCD;">                ...   </span></span>
<span class="line"><span style="color:#A6ACCD;">2019-03-27    138757.0</span></span>
<span class="line"><span style="color:#A6ACCD;">2019-03-28    132299.0</span></span>
<span class="line"><span style="color:#A6ACCD;">2019-03-29    136204.0</span></span>
<span class="line"><span style="color:#A6ACCD;">2019-04-01    141910.0</span></span>
<span class="line"><span style="color:#A6ACCD;">2019-04-02    140258.0</span></span>
<span class="line"><span style="color:#A6ACCD;">Name: total, Length: 120, dtype: float64</span></span>
<span class="line"><span style="color:#A6ACCD;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>Pandas\u6574\u5408\u4E86matplotlib\u7684\u76F8\u5173\u529F\u80FD\uFF0C\u56E0\u6B64\u57FA\u4E8EDataFrame\u683C\u5F0F\u6570\u636E\u53EF\u76F4\u63A5\u4F7F\u7528<code>plot()</code>\u65B9\u6CD5\u7ED8\u5236\u66F2\u7EBF\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">df_stockload.total.plot(grid=True)</span></span>
<span class="line"><span style="color:#A6ACCD;">plt.show()</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u6267\u884CN\u65E5\u7A81\u7834\u62E9\u65F6\u7B56\u7565\u540E\uFF0C\u6700\u7EC8\u7684\u8D44\u91D1\u6536\u76CA\u60C5\u51B5\u5982\u4E0B\u56FE\u6240\u793A\uFF1A</p><p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/4/13/16a15801869cb528~tplv-t2oaga2asx-image.image" alt=""></p><p>\u4ECE\u8D44\u91D1\u6536\u76CA\u66F2\u7EBF\u53EF\u83B7\u6089\u5230\uFF0C\u5728\u6267\u884C\u7B56\u7565\u540E\u8D44\u91D1\u6709\u663E\u8457\u7684\u589E\u957F\u3002</p><p>\u63A5\u4E0B\u6765\u8BA1\u7B97\u57FA\u51C6\u6536\u76CA\u4E0E\u4F7F\u7528\u7B56\u7565\u540E\u7684\u6536\u76CA\uFF0C\u5E76\u8FDB\u884C\u5BF9\u6BD4\u3002\u57FA\u51C6\u6536\u76CA\u6307\u7684\u662F\u7B2C\u4E00\u5929\u5F00\u59CB\u6301\u6709\u80A1\u7968\u76F4\u5230\u6700\u540E\u4E00\u5929\u7684\u6536\u76CA\u60C5\u51B5\uFF0C\u5B83\u4E3A\u5BF9\u6570\u6536\u76CA\u7387\uFF0C\u516C\u5F0F\u539F\u578B\u4E3A\uFF1A</p><p><img src="https://juejin.cn/equation?tex=r%20%3D%20ln%20(%20C_%7Bn%7D%2FC_%7Bn-1%7D%20)" alt="r = ln ( C_{n}/C_{n-1} )"></p><p>\uFF08Cn\u4E3A\u4ECA\u65E5\u6536\u76D8\u4EF7\uFF0CCn-1\u4E3A\u6628\u65E5\u6536\u76D8\u4EF7\uFF09\uFF0C\u5373\u6C42\u4EE5e\u4E3A\u5E95(Cn/Cn-1)\u7684\u5BF9\u6570\uFF0C\u5BF9\u5E94\u7684\u6307\u6570\u516C\u5F0F\u539F\u578B\u4E3A\uFF1A</p><p><img src="https://juejin.cn/equation?tex=C_%7Bn%7D%3DC_%7Bn-1%7D%20*e%5Er" alt="C_{n}=C_{n-1} *e^r"></p><p>\u5BF9\u6570\u6536\u76CA\u7387\u53EF\u7531<code>np.log()</code>\u65B9\u6CD5\u5B9E\u73B0\uFF0C\u6B64\u5904\u4F7F\u7528<code>np.log()</code>\u65B9\u6CD5\u5148\u8BA1\u7B97\u57FA\u51C6\u6536\u76CA\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">#\u8BA1\u7B97\u57FA\u51C6\u6536\u76CA </span></span>
<span class="line"><span style="color:#A6ACCD;">stock_df[&#39;benchmark_profit&#39;] = np.log(stock_df.Close/stock_df.Close.shift(1))</span></span>
<span class="line"><span style="color:#A6ACCD;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">Date</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-08        NaN</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-09    0.0e+00</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-10   -2.8e-03</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-11   -1.1e-01</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-12   -8.7e-02</span></span>
<span class="line"><span style="color:#A6ACCD;">               ...   </span></span>
<span class="line"><span style="color:#A6ACCD;">2019-03-27   -3.8e-02</span></span>
<span class="line"><span style="color:#A6ACCD;">2019-03-28   -4.8e-02</span></span>
<span class="line"><span style="color:#A6ACCD;">2019-03-29    2.9e-02</span></span>
<span class="line"><span style="color:#A6ACCD;">2019-04-01    4.1e-02</span></span>
<span class="line"><span style="color:#A6ACCD;">2019-04-02   -1.2e-02</span></span>
<span class="line"><span style="color:#A6ACCD;">Name: benchmark_profit, Length: 120, dtype: float64</span></span>
<span class="line"><span style="color:#A6ACCD;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u5BF9\u4E8E\u4F7F\u7528\u7B56\u7565\u540E\u6536\u76CA\u7684\u8BA1\u7B97\uFF0C\u6211\u4EEC\u53EF\u5728\u57FA\u51C6\u6536\u76CA\u57FA\u7840\u4E0A\u4E0E<code>signal</code>\u5E8F\u5217\u77E2\u91CF\u76F8\u4E58\u3002\u7531\u4E8E<code>signal</code>\u5E8F\u5217\u4E2D1\u4EE3\u8868\u4E70\u5165\u540E\u6301\u7EED\u6301\u6709\u80A1\u7968\uFF0C0\u4EE3\u8868\u5356\u51FA\u540E\u6301\u7EED\u7A7A\u4ED3\u6301\u5E01\uFF0C\u4E0E\u57FA\u51C6\u6536\u76CA\u76F8\u4E58\u53EF\u8FC7\u6EE4\u6389<code>signal</code>\u5E8F\u5217\u4E3A0\u65F6\u5BF9\u5E94\u5F53\u5929\u7684\u6536\u76CA\uFF0C\u540C\u65F6\u53EF\u4FDD\u6301<code>signal</code>\u5E8F\u5217\u4E3A1\u5BF9\u5E94\u5F53\u5929\u7684\u6536\u76CA\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">#\u8BA1\u7B97\u8D8B\u52BF\u7A81\u7834\u7B56\u7565\u6536\u76CA</span></span>
<span class="line"><span style="color:#A6ACCD;">df_stockload[&#39;trend_profit&#39;] = df_stockload.signal*df_stockload.benchmark_profit</span></span>
<span class="line"><span style="color:#A6ACCD;">print(df_stockload[&#39;trend_profit&#39;])</span></span>
<span class="line"><span style="color:#A6ACCD;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">Date</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-08        NaN</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-09    0.0e+00</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-10   -0.0e+00</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-11   -0.0e+00</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-12   -0.0e+00</span></span>
<span class="line"><span style="color:#A6ACCD;">               ...   </span></span>
<span class="line"><span style="color:#A6ACCD;">2019-03-27   -3.8e-02</span></span>
<span class="line"><span style="color:#A6ACCD;">2019-03-28   -4.8e-02</span></span>
<span class="line"><span style="color:#A6ACCD;">2019-03-29    2.9e-02</span></span>
<span class="line"><span style="color:#A6ACCD;">2019-04-01    4.1e-02</span></span>
<span class="line"><span style="color:#A6ACCD;">2019-04-02   -1.2e-02</span></span>
<span class="line"><span style="color:#A6ACCD;">Name: trend_profit, Length: 120, dtype: float64</span></span>
<span class="line"><span style="color:#A6ACCD;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u5BF9\u6570\u6536\u76CA\u7387\u53EF\u7EBF\u6027\u53E0\u52A0\uFF0C\u56E0\u6B64\u4F7F\u7528<code>cumsum()</code>\u65B9\u6CD5\u5C06\u5E8F\u5217\u503C\u7D2F\u52A0\u5F62\u6210\u57FA\u51C6\u6536\u76CA\u66F2\u7EBF\u548C\u7B56\u7565\u6536\u76CA\u66F2\u7EBF\uFF0C\u7136\u540E\u4F7F\u7528DataFrame\u683C\u5F0F\u6570\u636E\u81EA\u5E26\u7684<code>plot()</code>\u65B9\u6CD5\u7ED8\u5236\u8FD9\u4E24\u6761\u66F2\u7EBF\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">df_stockload[[&#39;benchmark_profit&#39;,&#39;trend_profit&#39;]].cumsum().plot(grid=True)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u57FA\u51C6\u6536\u76CA\u4E0E\u6267\u884CN\u65E5\u7A81\u7834\u62E9\u65F6\u7B56\u7565\u6536\u76CA\u5BF9\u6BD4\u60C5\u51B5\uFF0C\u5982\u4E0B\u56FE\u6240\u793A\uFF1A</p><p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/4/13/16a158159b54d0b5~tplv-t2oaga2asx-image.image" alt=""></p><p>\u4ECE\u5BF9\u6BD4\u60C5\u51B5\u53EF\u83B7\u6089\uFF0C\u6267\u884C\u7B56\u7565\u540E\u53EF\u4EE5\u901A\u8FC7\u7A7A\u4ED3\u65B9\u5F0F\u907F\u514D\u4E0B\u8DCC\u8FC7\u7A0B\u4E2D\u5E26\u6765\u7684\u635F\u5931\u3002</p><h2 id="\u56DE\u64A4\u7684\u98CE\u9669\u5EA6\u91CF" tabindex="-1">\u56DE\u64A4\u7684\u98CE\u9669\u5EA6\u91CF <a class="header-anchor" href="#\u56DE\u64A4\u7684\u98CE\u9669\u5EA6\u91CF" aria-hidden="true">#</a></h2><p>\u6211\u4EEC\u770B\u5230\u4E86\u6267\u884C\u4EA4\u6613\u7B56\u7565\u540E\u7684\u6536\u76CA\uFF0C\u4F46\u662F\u80A1\u7968\u4EA4\u6613\u662F\u6709\u98CE\u9669\u7684\uFF0C\u5982\u4F55\u53BB\u8861\u91CF\u8FD9\u4E2A\u98CE\u9669\u5462\uFF1F\u6700\u5927\u56DE\u64A4\u7387\u5C31\u662F\u4E00\u79CD\u76F4\u89C2\u7684\u5C06\u98CE\u9669\u5207\u5B9E\u91CF\u5316\u7684\u6307\u6807\uFF0C\u5B83\u63CF\u8FF0\u4E86\u4E70\u5165\u80A1\u7968\u540E\uFF0C\u5728\u7B56\u7565\u51FA\u73B0\u6700\u7CDF\u7CD5\u7684\u60C5\u51B5\u4E0B\u4F1A\u635F\u5931\u591A\u5C11\u94B1\uFF0C\u8FD9\u4E5F\u76F4\u63A5\u5173\u7CFB\u5230\u4E86\u98CE\u9669\u7B56\u7565\u4E2D\u6B62\u635F\u56E0\u5B50\u7684\u8BBE\u5B9A\u3002</p><p>\u56DE\u64A4\u7684\u610F\u601D\u662F\u6307\u5728\u67D0\u4E00\u6BB5\u65F6\u671F\u5185\u80A1\u4EF7\u4ECE\u6700\u9AD8\u70B9\u5F00\u59CB\u56DE\u843D\u5230\u6700\u4F4E\u70B9\u7684\u5E45\u5EA6\u3002\u6700\u5927\u56DE\u64A4\u7387\u8BA1\u7B97\u516C\u5F0F\u4E3A\uFF1A</p><p>max\uFF081-\u5F53\u65E5\u6536\u76D8\u4EF7/\u5F53\u65E5\u4E4B\u524D\u6700\u9AD8\u4EF7\uFF09*100\uFF05</p><p>\u4E3E\u4E2A\u4F8B\u5B50\uFF0C\u5728\u80A1\u7968\u6700\u9AD8\u4EF72\u5143\u4E70\u5165\uFF0C\u8FD1\u534A\u5E74\u5185\uFF0C\u80A1\u4EF7\u4E0B\u8DCC\u5230\u6700\u4F4E\u70B91.6\u5143\uFF0C\u6700\u5927\u4E8F\u635F0.4\u5143\uFF0C\u90A3\u4E48\u8FD9\u8FD1\u534A\u5E74\u6700\u5927\u56DE\u64A4\u7387=1-1.6/2\xD7100\uFF05\uFF0C\u7ED3\u679C\u662F20\uFF05\u3002\u663E\u800C\u6613\u89C1\uFF0C\u56DE\u64A4\u7387\u8D8A\u5C0F\u8D8A\u597D\uFF0C\u56E0\u4E3A\u56DE\u64A4\u4E0E\u98CE\u9669\u6210\u6B63\u6BD4\uFF0C\u56DE\u64A4\u8D8A\u5927\uFF0C\u98CE\u9669\u4E5F\u5C31\u8D8A\u9AD8\u3002</p><p>\u90A3\u4E48\u6211\u4EEC\u5148\u4ECB\u7ECD\u4E0B\u5982\u4F55\u5B9E\u73B0\u80A1\u7968\u6536\u76D8\u4EF7\u6700\u5927\u56DE\u64A4\u7387\u7684\u8BA1\u7B97\u3002</p><p>\u9996\u5148\u4F7F\u7528<code>expanding()</code> \u8BA1\u7B97\u6536\u76D8\u4EF7\u7684\u6EDA\u52A8\u6700\u5927\u503C\u5E8F\u5217\uFF0C\u4E5F\u5C31\u662F\u622A\u6B62\u5230\u4EFB\u4E00\u4EA4\u6613\u65E5\u4E4B\u524D\u6536\u76D8\u4EF7\u7684\u6700\u5927\u503C\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;"># expanding()\u8BA1\u7B97\u6536\u76D8\u4EF7\u66F2\u7EBF\u5F53\u524D\u7684\u6EDA\u52A8\u6700\u9AD8\u503C</span></span>
<span class="line"><span style="color:#A6ACCD;">stock_df[&#39;max_close&#39;] = stock_df[&#39;Close&#39;].expanding().max()</span></span>
<span class="line"><span style="color:#A6ACCD;">df_stockload[&#39;max_close&#39;].plot(grid=True)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u7ED8\u5236\u6536\u76D8\u4EF7\u66F2\u7EBF\u53CA\u6536\u76D8\u4EF7\u6EDA\u52A8\u6700\u5927\u503C\u66F2\u7EBF\uFF0C\u5982\u4E0B\u56FE\u6240\u793A\uFF1A</p><p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/4/13/16a1585d4521daa7~tplv-t2oaga2asx-image.image" alt=""></p><p>\u63A5\u7740\uFF0C\u5C06\u6536\u76D8\u4EF7\u5E8F\u5217\u4E0E\u6EDA\u52A8\u6700\u5927\u503C\u5E8F\u5217\u77E2\u91CF\u76F8\u9664\uFF0C\u8BA1\u7B97\u6536\u76D8\u4EF7\u5BF9\u4E8E\u6700\u9AD8\u503C\u6240\u5360\u7684\u767E\u5206\u6BD4\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;"># \u8BA1\u7B97\u6536\u76D8\u4EF7\u66F2\u7EBF\u5BF9\u4E8E\u6EDA\u52A8\u6700\u9AD8\u503C\u540E\u6240\u5360\u7684\u767E\u5206\u6BD4</span></span>
<span class="line"><span style="color:#A6ACCD;">df_stockload[&#39;per_close&#39;] = df_stockload[&#39;Close&#39;] / df_stockload[&#39;max_close&#39;]</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u5BF9\u8BE5\u767E\u5206\u6BD4\u4ECE\u5C0F\u5230\u5927\u6392\u5E8F\uFF0C\u6536\u76D8\u4EF7\u5BF9\u4E8E\u6700\u9AD8\u503C\u6240\u5360\u7684\u767E\u5206\u6BD4\u8D8A\u4F4E\uFF0C\u8BF4\u660E\u56DE\u64A4\u7684\u5E45\u5EA6\u8D8A\u5927\uFF0C\u90A3\u4E48\u5C061\u51CF\u53BB\u6392\u5E8F\u540E\u7684\u6700\u5C0F\u6570\u503C\uFF0C\u5373\u5F97\u5230\u6536\u76D8\u4EF7\u7684\u6700\u5927\u56DE\u64A4\u7387\u3002\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">min_point_close = df_stockload.sort_values(by=[&#39;per_close&#39;]).iloc[[0], df_stockload.columns.get_loc(&#39;per_close&#39;)]</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u6253\u5370\u6536\u76D8\u4EF7\u7684\u6700\u5927\u56DE\u64A4\u7387\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">print(&quot;\u6700\u5927\u80A1\u4EF7\u56DE\u64A4%5.2f%%&quot; % (1 - min_point_close.values))</span></span>
<span class="line"><span style="color:#A6ACCD;">#\u6700\u5927\u80A1\u4EF7\u56DE\u64A4 0.26%</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u5BFB\u627E\u51FA\u6700\u5927\u56DE\u64A4\u7387\u6240\u5BF9\u5E94\u7684\u6700\u9AD8\u4EF7\u4EA4\u6613\u65E5\u548C\u6700\u5927\u56DE\u64A4\u4EA4\u6613\u65E5\uFF0C\u5E76\u6253\u5370\u663E\u793A\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">max_point_close = df_stockload[df_stockload.index &lt;= min_point_close.index[0]].sort_values \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    (by=[&#39;Close&#39;], ascending=False).iloc[[0], df_stockload.columns.get_loc(&#39;Close&#39;)]</span></span>
<span class="line"><span style="color:#A6ACCD;">print(&quot;\u4ECE%s\u5F00\u59CB\u81F3%s\u7ED3\u675F&quot; % (max_point_close.index[0], min_point_close.index[0]))</span></span>
<span class="line"><span style="color:#A6ACCD;">#\u4ECE2018-10-08 00:00:00\u5F00\u59CB\u81F32018-10-16 00:00:00\u7ED3\u675F</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u63A5\u4E0B\u6765\u6211\u4EEC\u4ECB\u7ECD\u4E0B\u8BA1\u7B97\u8D44\u91D1\u66F2\u7EBF\u6700\u5927\u56DE\u64A4\u7387\u7684\u65B9\u6CD5\uFF0C\u8BE5\u65B9\u6CD5\u4E0E\u8BA1\u7B97\u6536\u76D8\u4EF7\u66F2\u7EBF\u6700\u5927\u56DE\u64A4\u7387\u65B9\u6CD5\u7C7B\u540C\u3002</p><p>\u9996\u5148\u4F7F\u7528<code>expanding()</code> \u8BA1\u7B97\u8D44\u91D1\u5E8F\u5217\u7684\u6EDA\u52A8\u6700\u5927\u503C\uFF0C\u4E5F\u5C31\u662F\u622A\u6B62\u5230\u5F53\u524D\u4EA4\u6613\u65E5\uFF0C\u8D44\u91D1\u5E8F\u5217\u7684\u6700\u5927\u503C\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;"># expanding()\u8BA1\u7B97\u8D44\u91D1\u66F2\u7EBF\u5F53\u524D\u7684\u6EDA\u52A8\u6700\u9AD8\u503C</span></span>
<span class="line"><span style="color:#A6ACCD;">df_stockload[&#39;max_total&#39;] = df_stockload[&#39;total&#39;].expanding().max()</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u7ED8\u5236\u8D44\u91D1\u66F2\u7EBF\u53CA\u8D44\u91D1\u6EDA\u52A8\u6700\u5927\u503C\u66F2\u7EBF\uFF0C\u5982\u4E0B\u56FE\u6240\u793A\uFF1A</p><p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/4/13/16a1585829b754e3~tplv-t2oaga2asx-image.image" alt=""></p><p>\u63A5\u7740\u5C06\u8D44\u91D1\u5E8F\u5217\u4E0E\u8D44\u91D1\u5E8F\u5217\u6EDA\u52A8\u6700\u5927\u503C\u77E2\u91CF\u76F8\u9664\uFF0C\u5373\u5F97\u5230\u8D44\u91D1\u5E8F\u5217\u5728\u6EDA\u52A8\u6700\u5927\u503C\u4E4B\u540E\u5269\u4F59\u8D44\u91D1\u7684\u767E\u5206\u6BD4\uFF0C\u5BF9\u5269\u4F59\u8D44\u91D1\u767E\u5206\u6BD4\u4ECE\u5C0F\u5230\u5927\u6392\u5E8F\uFF0C\u90A3\u4E48\u6392\u5E8F\u540E\u7684\u7B2C\u4E00\u884C\u503C\u5373\u4E3A\u56DE\u64A4\u540E\u8D44\u91D1\u5269\u4F59\u767E\u5206\u6BD4\u7684\u6700\u5C0F\u503C\uFF0C1-\u8D44\u91D1\u5269\u4F59\u767E\u5206\u6BD4\u6700\u5C0F\u503C\u5373\u4E3A\u8D44\u91D1\u66F2\u7EBF\u6700\u5927\u56DE\u64A4\u7387\uFF0C\u6253\u5370\u8D44\u91D1\u6700\u5927\u56DE\u64A4\u7387\u3001\u8D44\u91D1\u6700\u9AD8\u503C/\u6700\u5927\u56DE\u64A4\u503C\u5BF9\u5E94\u7684\u4EA4\u6613\u65E5\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;"># \u8BA1\u7B97\u8D44\u91D1\u66F2\u7EBF\u5728\u6EDA\u52A8\u6700\u9AD8\u503C\u4E4B\u540E\u6240\u56DE\u64A4\u7684\u767E\u5206\u6BD4</span></span>
<span class="line"><span style="color:#A6ACCD;">df_stockload[&#39;per_total&#39;] = df_stockload[&#39;total&#39;] / df_stockload[&#39;max_total&#39;]</span></span>
<span class="line"><span style="color:#A6ACCD;">min_point_total = df_stockload.sort_values(by=[&#39;per_total&#39;]).iloc[[0], df_stockload.columns.get_loc(&#39;per_total&#39;)]</span></span>
<span class="line"><span style="color:#A6ACCD;">max_point_total = df_stockload[df_stockload.index &lt;= min_point_total.index[0]].sort_values \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    (by=[&#39;total&#39;], ascending=False).iloc[[0], df_stockload.columns.get_loc(&#39;total&#39;)]</span></span>
<span class="line"><span style="color:#A6ACCD;">print(&quot;\u6700\u5927\u8D44\u91D1\u56DE\u64A4%5.2f%%\u4ECE%s\u5F00\u59CB\u81F3%s\u7ED3\u675F&quot; % ((1 - min_point_total.values), \\</span></span>
<span class="line"><span style="color:#A6ACCD;">                                   max_point_total.index[0], min_point_total.index[0]))</span></span>
<span class="line"><span style="color:#A6ACCD;">#\u6700\u5927\u8D44\u91D1\u56DE\u64A4 0.17%\u4ECE2019-03-25 00:00:00\u5F00\u59CB\u81F32019-03-28 00:00:00\u7ED3\u675F</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u4F7F\u7528\u6700\u5927\u56DE\u64A4\u7387\u53BB\u5EA6\u91CF\u98CE\u9669\u6709\u4E24\u5927\u7528\u9014\uFF1A</p><ul><li>\u76F4\u63A5\u7684\u7528\u9014\u662F\u53EF\u4EE5\u6392\u9664\u4E0D\u9002\u5408\u81EA\u5DF1\u7684\u7B56\u7565\u3002\u5047\u8BBE\u4E00\u4E2A\u7B56\u7565\u7684\u6700\u5927\u56DE\u64A4\u662F20\uFF05\uFF0C\u90A3\u4E48\u4F7F\u7528\u8FD9\u4E2A\u7B56\u7565\u4E4B\u524D\u5C31\u8981\u6382\u91CF\u4E0B\u81EA\u5DF1\u80FD\u5426\u7ECF\u53D7\u5F97\u8D7720\uFF05\u6D6E\u4E8F\u7684\u6781\u7AEF\u7684\u60C5\u51B5\u3002\u5982\u679C\u6700\u5927\u56DE\u64A4\u4E00\u76F4\u63A7\u5236\u5728\u4F4E\u6C34\u5E73\uFF0C\u90A3\u4E48\u6700\u660E\u663E\u7684\u4E24\u4E2A\u597D\u5904\u5C31\u662F\u4E0D\u4F1A\u5927\u5E45\u4E27\u5931\u4E4B\u524D\u7684\u76C8\u5229\uFF0C\u4EE5\u53CA\u53EF\u4EE5\u8F83\u5FEB\u5730\u91CD\u65B0\u56DE\u5230\u539F\u6765\u7684\u6700\u9AD8\u70B9\u3002</li><li>\u901A\u8FC7\u6536\u76CA\u56DE\u64A4\u6BD4\uFF0C\u9009\u51FA\u6700\u6709\u4F18\u52BF\u7684\u4EA7\u54C1\u3002\u5982\u679C\u6536\u76CA\u7387\u4E3A30\uFF05\uFF0C\u56DE\u64A4\u7387\u4E3A5\uFF05\uFF0C\u90A3\u4E48\u6536\u76CA\u4E0E\u56DE\u64A4\u6BD4\uFF1A\u8D44\u91D1\u6536\u76CA\u7387/\u8D44\u91D1\u56DE\u64A4\u7387\uFF1D6, \u6BD4\u503C\u8D8A\u5927\u5F80\u5F80\u8BF4\u660E\u6B64\u80A1\u7968\u7684\u8D62\u5229\u80FD\u529B\u8D8A\u5F3A\u3002</li></ul><h2 id="\u6536\u76CA\u4E0E\u98CE\u9669\u56FE\u8868\u96C6\u6210" tabindex="-1">\u6536\u76CA\u4E0E\u98CE\u9669\u56FE\u8868\u96C6\u6210 <a class="header-anchor" href="#\u6536\u76CA\u4E0E\u98CE\u9669\u56FE\u8868\u96C6\u6210" aria-hidden="true">#</a></h2><p>\u63A5\u4E0B\u6765\u6211\u4EEC\u521B\u5EFA\u4E09\u4E2A\u5B50\u56FE\u5206\u522B\u7ED8\u5236\u5982\u4E0B\u5185\u5BB9\uFF1A</p><ul><li>\u5448\u73B0\u76C8\u4E8F\u72B6\u6001\u7684\u4E70\u5356\u533A\u95F4\u53CA\u6807\u6CE8\u4E0A\u4E70\u5356\u4FE1\u53F7\u70B9</li><li>\u8D44\u91D1\u66F2\u7EBF\u53CA\u8D44\u91D1\u6700\u5927\u56DE\u64A4\u70B9</li><li>\u57FA\u51C6\u6536\u76CA\u66F2\u7EBF\u53CA\u4F7F\u7528\u7B56\u7565\u540E\u7684\u6536\u76CA\u66F2\u7EBF</li></ul><p>\u521B\u5EFA\u4E00\u4E2A\u540D\u79F0\u4E3Afig\u7684\u56FE\u8868\u5BF9\u8C61\uFF0C\u5728fig\u5BF9\u8C61\u4E2D\u5206\u522B\u521B\u5EFA\u540D\u4E3A<code>graph_trade</code>\u3001<code>graph_total</code>\u3001<code>graph_profit</code>\u7684Axes\u5BF9\u8C61\uFF0C\u5E76\u5728\u5BF9\u8C61\u4E0A\u5F00\u59CB\u7ED8\u5236\u56FE\u8868\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">fig = plt.figure(figsize=(8, 6), dpi=100, facecolor=&quot;white&quot;)#\u521B\u5EFAfig\u5BF9\u8C61</span></span>
<span class="line"><span style="color:#A6ACCD;">gs = gridspec.GridSpec(3, 1, left=0.05, bottom=0.15, right=0.96, top=0.96, wspace=None, hspace=0.2, height_ratios=[4.5,2,2])</span></span>
<span class="line"><span style="color:#A6ACCD;">graph_trade = fig.add_subplot(gs[0,:])</span></span>
<span class="line"><span style="color:#A6ACCD;">graph_total = fig.add_subplot(gs[1,:])</span></span>
<span class="line"><span style="color:#A6ACCD;">graph_profit = fig.add_subplot(gs[2,:])</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u63A5\u4E0B\u6765\u5C31\u628A\u6211\u4EEC\u5DF2\u7ECF\u4ECB\u7ECD\u8FC7\u7684\u8D44\u91D1\u66F2\u7EBF\u3001\u57FA\u51C6\u6536\u76CA\u66F2\u7EBF\u3001\u6700\u5927\u56DE\u64A4\u70B9\u7B49\u5206\u7ACB\u56FE\u8868\u5143\u7D20\u6C47\u603B\u5728\u5927\u56FE\u8868\u4E0A\uFF0C\u6574\u4F53\u4EE3\u7801\u5B9E\u73B0\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">import pandas_datareader.data as web</span></span>
<span class="line"><span style="color:#A6ACCD;">import pandas as pd</span></span>
<span class="line"><span style="color:#A6ACCD;">import numpy as np</span></span>
<span class="line"><span style="color:#A6ACCD;">import datetime</span></span>
<span class="line"><span style="color:#A6ACCD;">import matplotlib.pyplot as plt</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">import matplotlib.gridspec as gridspec  # \u5206\u5272\u5B50\u56FE</span></span>
<span class="line"><span style="color:#A6ACCD;">#\u521D\u59CB\u5316\u53D8\u91CF</span></span>
<span class="line"><span style="color:#A6ACCD;">skip_days = 0</span></span>
<span class="line"><span style="color:#A6ACCD;">cash_hold = 100000 #\u521D\u59CB\u8D44\u91D1</span></span>
<span class="line"><span style="color:#A6ACCD;">posit_num = 0 #\u6301\u80A1\u6570\u76EE</span></span>
<span class="line"><span style="color:#A6ACCD;">market_total = 0 #\u6301\u80A1\u5E02\u503C</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">#\u521B\u5EFA\u56FE\u8868</span></span>
<span class="line"><span style="color:#A6ACCD;">fig = plt.figure(figsize=(10, 8), dpi=100, facecolor=&quot;white&quot;)#\u521B\u5EFAfig\u5BF9\u8C61</span></span>
<span class="line"><span style="color:#A6ACCD;">gs = gridspec.GridSpec(3, 1, left=0.05, bottom=0.1, right=0.96, top=0.96, wspace=None, hspace=0.05, height_ratios=[4,2,2])</span></span>
<span class="line"><span style="color:#A6ACCD;">graph_trade = fig.add_subplot(gs[0,:])</span></span>
<span class="line"><span style="color:#A6ACCD;">graph_total = fig.add_subplot(gs[1,:])</span></span>
<span class="line"><span style="color:#A6ACCD;">graph_profit = fig.add_subplot(gs[2,:])</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">#\u83B7\u53D6\u80A1\u7968\u4EA4\u6613\u6570\u636E</span></span>
<span class="line"><span style="color:#A6ACCD;">df_stockload = GetStockDatApi(&quot;600410.SS&quot;,datetime.datetime(2018, 10, 1), datetime.datetime(2019, 4, 1))</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">for kl_index, today in df_stockload.iterrows():</span></span>
<span class="line"><span style="color:#A6ACCD;">    # \u4E70\u5165/\u5356\u51FA\u6267\u884C\u4EE3\u7801</span></span>
<span class="line"><span style="color:#A6ACCD;">    if today.signal == 1 and skip_days == 0:  # \u4E70\u5165</span></span>
<span class="line"><span style="color:#A6ACCD;">        start = df_stockload.index.get_loc(kl_index)</span></span>
<span class="line"><span style="color:#A6ACCD;">        skip_days = -1</span></span>
<span class="line"><span style="color:#A6ACCD;">        posit_num = int(cash_hold / today.Close) #\u8D44\u91D1\u8F6C\u5316\u4E3A\u80A1\u7968</span></span>
<span class="line"><span style="color:#A6ACCD;">        cash_hold = 0</span></span>
<span class="line"><span style="color:#A6ACCD;">        graph_trade.annotate(&#39;\u4E70\u5165&#39;,xy=(kl_index,df_stockload.Close.asof(kl_index)),xytext=(kl_index, df_stockload.Close.asof(kl_index)+2),arrowprops=dict(facecolor=&#39;r&#39;,shrink=0.1),horizontalalignment=&#39;left&#39;,verticalalignment=&#39;top&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    elif today.signal == 0 and skip_days == -1:  # \u5356\u51FA \u907F\u514D\u672A\u4E70\u5148\u5356</span></span>
<span class="line"><span style="color:#A6ACCD;">        end = df_stockload.index.get_loc(kl_index)</span></span>
<span class="line"><span style="color:#A6ACCD;">        skip_days = 0</span></span>
<span class="line"><span style="color:#A6ACCD;">        cash_hold = int(posit_num * today.Close) #\u80A1\u7968\u8F6C\u5316\u4E3A\u8D44\u91D1</span></span>
<span class="line"><span style="color:#A6ACCD;">        market_total = 0</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">        if df_stockload.Close[end] &lt; df_stockload.Close[start]:  # \u8D54\u94B1\u663E\u793A\u7EFF\u8272</span></span>
<span class="line"><span style="color:#A6ACCD;">            graph_trade.fill_between(df_stockload.index[start:end], 0, df_stockload.Close[start:end], color=&#39;green&#39;, alpha=0.38)</span></span>
<span class="line"><span style="color:#A6ACCD;">        else:  # \u8D5A\u94B1\u663E\u793A\u7EA2\u8272</span></span>
<span class="line"><span style="color:#A6ACCD;">            graph_trade.fill_between(df_stockload.index[start:end], 0, df_stockload.Close[start:end], color=&#39;red&#39;, alpha=0.38)</span></span>
<span class="line"><span style="color:#A6ACCD;">        graph_trade.annotate(&#39;\u5356\u51FA&#39;,xy=(kl_index,df_stockload.Close.asof(kl_index)),xytext=(kl_index+datetime.timedelta(days=5), df_stockload.Close.asof(kl_index)+2),arrowprops=dict(facecolor=&#39;g&#39;,shrink=0.1),horizontalalignment=&#39;left&#39;,verticalalignment=&#39;top&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    if skip_days == -1: #\u6301\u80A1</span></span>
<span class="line"><span style="color:#A6ACCD;">        market_total = int(posit_num * today.Close)</span></span>
<span class="line"><span style="color:#A6ACCD;">        df_stockload.loc[kl_index,&#39;total&#39;] = market_total</span></span>
<span class="line"><span style="color:#A6ACCD;">    else: #\u7A7A\u4ED3</span></span>
<span class="line"><span style="color:#A6ACCD;">        df_stockload.loc[kl_index,&#39;total&#39;] = cash_hold</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">#\u8BA1\u7B97\u57FA\u51C6\u6536\u76CA/\u8D8B\u52BF\u7A81\u7834\u7B56\u7565\u6536\u76CA</span></span>
<span class="line"><span style="color:#A6ACCD;">df_stockload[&#39;benchmark_profit&#39;] = np.log(df_stockload.Close/df_stockload.Close.shift(1))</span></span>
<span class="line"><span style="color:#A6ACCD;">df_stockload[&#39;trend_profit&#39;] = df_stockload.signal*df_stockload.benchmark_profit</span></span>
<span class="line"><span style="color:#A6ACCD;">df_stockload[[&#39;benchmark_profit&#39;,&#39;trend_profit&#39;]].cumsum().plot(grid=True,ax=graph_profit)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">#\u8BA1\u7B97\u6536\u76D8\u4EF7\u66F2\u7EBF\u5F53\u524D\u7684\u6EDA\u52A8\u6700\u9AD8\u503C</span></span>
<span class="line"><span style="color:#A6ACCD;">df_stockload[&#39;max_close&#39;] = df_stockload[&#39;Close&#39;].expanding().max()</span></span>
<span class="line"><span style="color:#A6ACCD;">df_stockload[[&#39;max_close&#39;,&#39;Close&#39;]].plot(grid=True,ax=graph_trade)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">#\u8BA1\u7B97\u8D44\u91D1\u66F2\u7EBF\u5F53\u524D\u7684\u6EDA\u52A8\u6700\u9AD8\u503C</span></span>
<span class="line"><span style="color:#A6ACCD;">df_stockload[&#39;max_total&#39;] = df_stockload[&#39;total&#39;].expanding().max()</span></span>
<span class="line"><span style="color:#A6ACCD;">df_stockload[[&#39;max_total&#39;,&#39;total&#39;]].plot(grid=True,ax=graph_total)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">#\u8BA1\u7B97\u8D44\u91D1\u66F2\u7EBF\u5728\u6EDA\u52A8\u6700\u9AD8\u503C\u4E4B\u540E\u6240\u56DE\u64A4\u7684\u767E\u5206\u6BD4</span></span>
<span class="line"><span style="color:#A6ACCD;">df_stockload[&#39;per_total&#39;] = df_stockload[&#39;total&#39;] / df_stockload[&#39;max_total&#39;]</span></span>
<span class="line"><span style="color:#A6ACCD;">min_point_total = df_stockload.sort_values(by=[&#39;per_total&#39;]).iloc[[0], df_stockload.columns.get_loc(&#39;per_total&#39;)]</span></span>
<span class="line"><span style="color:#A6ACCD;">max_point_total = df_stockload[df_stockload.index &lt;= min_point_total.index[0]].sort_values \\</span></span>
<span class="line"><span style="color:#A6ACCD;">    (by=[&#39;total&#39;], ascending=False).iloc[[0], df_stockload.columns.get_loc(&#39;total&#39;)]</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">#\u6807\u6CE8\u6EDA\u52A8\u6700\u5927\u70B9\u53CA\u6700\u5927\u56DE\u64A4\u70B9</span></span>
<span class="line"><span style="color:#A6ACCD;">graph_total.annotate(&#39;\u6EDA\u52A8\u6700\u5927\u70B9&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">                     xy=(max_point_total.index[0], df_stockload.total.asof(max_point_total.index[0])),</span></span>
<span class="line"><span style="color:#A6ACCD;">                     xytext=(max_point_total.index[0], df_stockload.total.asof(max_point_total.index[0]) + 4),</span></span>
<span class="line"><span style="color:#A6ACCD;">                     arrowprops=dict(facecolor=&#39;yellow&#39;, shrink=0.1), horizontalalignment=&#39;left&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">                     verticalalignment=&#39;top&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">graph_total.annotate(&#39;\u6700\u5927\u56DE\u64A4\u70B9&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">                     xy=(min_point_total.index[0], df_stockload.total.asof(min_point_total.index[0])),</span></span>
<span class="line"><span style="color:#A6ACCD;">                     xytext=(min_point_total.index[0], df_stockload.total.asof(min_point_total.index[0]) + 4),</span></span>
<span class="line"><span style="color:#A6ACCD;">                     arrowprops=dict(facecolor=&#39;yellow&#39;, shrink=0.1), horizontalalignment=&#39;left&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">                     verticalalignment=&#39;top&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">#\u56FE\u8868\u663E\u793A\u53C2\u6570\u914D\u7F6E</span></span>
<span class="line"><span style="color:#A6ACCD;">for label in graph_trade.xaxis.get_ticklabels():</span></span>
<span class="line"><span style="color:#A6ACCD;">    label.set_visible(False)</span></span>
<span class="line"><span style="color:#A6ACCD;">for label in graph_total.xaxis.get_ticklabels():</span></span>
<span class="line"><span style="color:#A6ACCD;">    label.set_visible(False)</span></span>
<span class="line"><span style="color:#A6ACCD;">for label in graph_profit.xaxis.get_ticklabels():</span></span>
<span class="line"><span style="color:#A6ACCD;">    label.set_rotation(45)</span></span>
<span class="line"><span style="color:#A6ACCD;">    label.set_fontsize(10)  # \u8BBE\u7F6E\u6807\u7B7E\u5B57\u4F53</span></span>
<span class="line"><span style="color:#A6ACCD;">graph_trade.set_xlabel(&quot;&quot;)</span></span>
<span class="line"><span style="color:#A6ACCD;">graph_trade.set_title(u&#39;\u534E\u80DC\u5929\u6210 \u6536\u76CA\u4E0E\u98CE\u9669\u5EA6\u91CF&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">graph_total.set_xlabel(&quot;&quot;)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">plt.show()</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u6700\u7EC8\u7684\u6536\u76CA\u4E0E\u98CE\u9669\u5EA6\u91CF\u7684\u53EF\u89C6\u5316\u6548\u679C\uFF0C\u5982\u4E0B\u56FE\u6240\u793A\uFF1A</p><p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/4/13/16a1584ef0b90039~tplv-t2oaga2asx-image.image" alt=""></p><h2 id="\u603B\u7ED3" tabindex="-1">\u603B\u7ED3 <a class="header-anchor" href="#\u603B\u7ED3" aria-hidden="true">#</a></h2><p>\u57FA\u4E8E\u53EF\u89C6\u5316\u7684\u6536\u76CA\u4E0E\u98CE\u9669\u5EA6\u91CF\u53EF\u4EE5\u66F4\u597D\u5730\u5E2E\u52A9\u6211\u4EEC\u5206\u6790\u7B56\u7565\u7684\u56DE\u6D4B\u6267\u884C\u60C5\u51B5\u3002\u6BD4\u5982\u89C2\u5BDFN\u65E5\u7A81\u7834\u7B56\u7565\u7684\u56DE\u6D4B\u6548\u679C\uFF0C\u5728\u4E70\u5356\u533A\u95F4\u5B50\u56FE\u4E2D\u7EA2\u8272\u5373\u4E3A\u76C8\u5229\u64CD\u4F5C\uFF0C\u7EFF\u8272\u4E3A\u4E8F\u635F\u64CD\u4F5C\uFF0C\u53EF\u4EE5\u770B\u5230\u4ECA\u5E74\u83B7\u5229\u4EA4\u6613\u7684\u6B21\u6570\u8F83\u591A\u3002\u4ECE\u6536\u76CA\u66F2\u7EBF\u53EF\u4EE5\u770B\u51FA\u5E94\u7528\u8BE5\u7B56\u7565\u6267\u884C\u4EA4\u6613\u7684\u6548\u679C\u826F\u597D\uFF0C\u6700\u5927\u56DE\u64A4\u66F2\u7EBF\u53EF\u4EE5\u770B\u51FA\u8D44\u91D1\u7684\u4E8F\u635F\u5E45\u5EA6\uFF0C\u6574\u4F53\u5E94\u7528\u7B56\u7565\u7684\u6536\u76CA\u5927\u4E8E\u57FA\u51C6\u6536\u76CA\u3002</p><p>\u6700\u540E\uFF0C\u7ED9\u5927\u5BB6\u7559\u4E00\u9053\u601D\u8003\u9898\uFF1A</p><p>\u56DE\u6D4B\u9636\u6BB5\u53CD\u6620\u7684\u662F\u7B56\u7565\u57FA\u4E8E\u5386\u53F2\u4EA4\u6613\u6570\u636E\u6A21\u62DF\u4E70\u5356\u7684\u6548\u679C\uFF0C\u90A3\u4E48\u56DE\u6D4B\u80FD\u591F\u4EE3\u8868\u5B9E\u9645\u6267\u884C\u6548\u679C\u5417\uFF1F\u6211\u4EEC\u53C8\u8BE5\u5982\u4F55\u53BB\u7406\u89E3\u56DE\u6D4B\u9636\u6BB5\u7684\u610F\u4E49\u5462\uFF1F</p><p>\u6B22\u8FCE\u5927\u5BB6\u5728\u7559\u8A00\u533A\u7559\u8A00\uFF0C\u6211\u4EEC\u4E00\u8D77\u8BA8\u8BBA\u3002</p>`,76),e=[o];function t(c,i,r,d,C,A){return n(),a("div",null,e)}const D=s(p,[["render",t]]);export{y as __pageData,D as default};
