import{_ as s,c as n,o as a,d as o}from"./app.e5528619.js";const m=JSON.parse('{"title":"\u5C06\u722C\u53D6\u7684\u6587\u7AE0\u5B58\u50A8\u5230MongoDB","description":"","frontmatter":{},"headers":[{"level":3,"title":"MongoDB \u5B89\u88C5","slug":"mongodb-\u5B89\u88C5","link":"#mongodb-\u5B89\u88C5","children":[]},{"level":3,"title":"\u542F\u52A8 MongoDB","slug":"\u542F\u52A8-mongodb","link":"#\u542F\u52A8-mongodb","children":[]},{"level":3,"title":"MongoEngine","slug":"mongoengine","link":"#mongoengine","children":[]},{"level":3,"title":"\u6570\u636E\u4FDD\u5B58","slug":"\u6570\u636E\u4FDD\u5B58","link":"#\u6570\u636E\u4FDD\u5B58","children":[]},{"level":3,"title":"\u5C0F\u7ED3","slug":"\u5C0F\u7ED3","link":"#\u5C0F\u7ED3","children":[]}],"relativePath":"\u5176\u4ED6/\u57FA\u4E8E Python \u5B9E\u73B0\u5FAE\u4FE1\u516C\u4F17\u53F7\u722C\u866B/\u5C06\u722C\u53D6\u7684\u6587\u7AE0\u5B58\u50A8\u5230MongoDB.md"}'),e={name:"\u5176\u4ED6/\u57FA\u4E8E Python \u5B9E\u73B0\u5FAE\u4FE1\u516C\u4F17\u53F7\u722C\u866B/\u5C06\u722C\u53D6\u7684\u6587\u7AE0\u5B58\u50A8\u5230MongoDB.md"},l=o(`<h1 id="\u5C06\u722C\u53D6\u7684\u6587\u7AE0\u5B58\u50A8\u5230mongodb" tabindex="-1">\u5C06\u722C\u53D6\u7684\u6587\u7AE0\u5B58\u50A8\u5230MongoDB <a class="header-anchor" href="#\u5C06\u722C\u53D6\u7684\u6587\u7AE0\u5B58\u50A8\u5230mongodb" aria-hidden="true">#</a></h1><hr><h1 id="\u5C06\u722C\u53D6\u7684\u6587\u7AE0\u5B58\u50A8\u5230mongodb-1" tabindex="-1">\u5C06\u722C\u53D6\u7684\u6587\u7AE0\u5B58\u50A8\u5230MongoDB <a class="header-anchor" href="#\u5C06\u722C\u53D6\u7684\u6587\u7AE0\u5B58\u50A8\u5230mongodb-1" aria-hidden="true">#</a></h1><p>\u5173\u4E8E\u6570\u636E\u7684\u5B58\u50A8\u6709\u5F88\u591A\u9009\u62E9\uFF0C\u6700\u7B80\u5355\u7684\u65B9\u5F0F\u5C31\u662F\u76F4\u63A5\u4FDD\u5B58\u5230 CSV \u6587\u4EF6\u4E2D\uFF0C\u8FD9\u79CD\u65B9\u5F0F\u64CD\u4F5C\u7B80\u5355\uFF0C\u9002\u5408\u6570\u636E\u91CF\u5C11\u7684\u60C5\u51B5\uFF0CPython\u7684\u6807\u51C6\u5E93 <code>csv</code> \u6A21\u5757\u5C31\u53EF\u4EE5\u76F4\u63A5\u652F\u6301\u3002\u5982\u679C\u9047\u5230\u6570\u636E\u91CF\u975E\u5E38\u5927\u7684\u60C5\u51B5\uFF0C\u5C31\u5FC5\u987B\u8981\u7528\u5230\u4E13\u4E1A\u7684\u6570\u636E\u5E93\u7CFB\u7EDF\uFF0C\u4F60\u65E2\u53EF\u4EE5\u4F7F\u7528 MySQL \u8FD9\u6837\u7684\u5173\u7CFB\u578B\u6570\u636E\u5E93\uFF0C\u4E5F\u53EF\u4EE5\u4F7F\u7528 MongoDB \u4E00\u7C7B\u7684\u6587\u6863\u578B\u6570\u636E\u5E93\u3002\u7528Python \u64CD\u4F5C MongoDB \u975E\u5E38\u65B9\u4FBF\uFF0C\u65E0\u9700\u5B9A\u4E49\u8868\u7ED3\u6784\u5C31\u53EF\u4EE5\u76F4\u63A5\u5C06\u6570\u636E\u63D2\u5165\uFF0C\u6240\u4EE5\u6211\u4EEC\u5728\u8FD9\u4E00\u8282\u91C7\u7528 MongoDB \u6765\u5B58\u50A8\u6570\u636E\u3002</p><h3 id="mongodb-\u5B89\u88C5" tabindex="-1">MongoDB \u5B89\u88C5 <a class="header-anchor" href="#mongodb-\u5B89\u88C5" aria-hidden="true">#</a></h3><p>MongoDB \u76EE\u524D\u6700\u65B0\u7248\u672C\u662F3.6\uFF0C\u5728\u5B98\u7F51\u5730\u5740<a href="https://www.mongodb.com/download-center#community" target="_blank" rel="noreferrer">https://www.mongodb.com/download-center#community</a>\u9009\u62E9\u76F8\u5E94\u5E73\u53F0\u4E0B\u8F7D\u5B89\u88C5\u3002</p><p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2017/12/25/1608ae95b25c3215~tplv-t2oaga2asx-image.image" alt=""></p><p>Windows \u9ED8\u8BA4\u5B89\u88C5\u5728 C:\\Program Files\\MongoDB\\Server\\3.6\\\uFF0CmacOS \u4E5F\u53EF\u4EE5\u76F4\u63A5\u901A\u8FC7 brew \u547D\u4EE4\u5B89\u88C5\uFF0CLinux\u5E73\u53F0\u76F4\u63A5\u4E0B\u8F7D\u538B\u7F29\u5305\u89E3\u538B\u5373\u53EF\u3002</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">brew install mongodb --with-openssl</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><h3 id="\u542F\u52A8-mongodb" tabindex="-1">\u542F\u52A8 MongoDB <a class="header-anchor" href="#\u542F\u52A8-mongodb" aria-hidden="true">#</a></h3><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">mongod --dbpath &lt;path to data directory&gt; </span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u9ED8\u8BA4\u7AEF\u53E3\u662F 27017\uFF0C\u4E3A\u4E86\u66F4\u597D\u7684\u67E5\u770B\u6570\u636E\uFF0C\u6211\u4EEC\u53EF\u4EE5\u88C5\u4E00\u4E2A MongoDB \u5BA2\u6237\u7AEF\uFF0C \u5B98\u65B9\u81EA\u5E26\u6709 compass\uFF0C\u4E5F\u53EF\u4EE5\u4E0B\u8F7D\u7B2C\u4E09\u65B9\u5DE5\u5177 Robo 3T <a href="https://robomongo.org/" target="_blank" rel="noreferrer">https://robomongo.org/</a>\uFF0C\u8FD9\u91CC\u63A8\u8350\u5927\u5BB6\u4F7F\u7528\u514D\u8D39\u7684 Robo 3T\u3002</p><p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2017/12/25/1608aea6b3f9332f~tplv-t2oaga2asx-image.image" alt=""></p><h3 id="mongoengine" tabindex="-1">MongoEngine <a class="header-anchor" href="#mongoengine" aria-hidden="true">#</a></h3><p>MongoEngine \u662F MongoDB \u7684 DOM\uFF08Document-Object Mapper\uFF09\u6846\u67B6\uFF0C\u4E00\u79CD\u7C7B\u4F3C\u4E8E\u5173\u7CFB\u578B\u6570\u636E\u5E93\u4E2D\u7684ORM\u6846\u67B6 \uFF0C\u4F7F\u7528\u5B83\u53EF\u4EE5\u66F4\u65B9\u4FBF\u5E76\u5199\u51FA\u7B80\u6D01\u7684\u4EE3\u7801</p><p>\u5B89\u88C5</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">$ pip install mongoengine</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u8FDE\u63A5</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">from mongoengine import connect</span></span>
<span class="line"><span style="color:#A6ACCD;"># \u8FDE\u63A5 mongodb\uFF0C\u65E0\u9700\u4E8B\u5148\u521B\u5EFA\u6570\u636E\u5E93</span></span>
<span class="line"><span style="color:#A6ACCD;">connect(&#39;weixin&#39;, host=&#39;localhost&#39;, port=27017)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u5B9A\u4E49\u6570\u636E\u6A21\u578B</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span style="color:#A6ACCD;">from datetime import datetime</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">from mongoengine import DateTimeField</span></span>
<span class="line"><span style="color:#A6ACCD;">from mongoengine import Document</span></span>
<span class="line"><span style="color:#A6ACCD;">from mongoengine import IntField</span></span>
<span class="line"><span style="color:#A6ACCD;">from mongoengine import StringField</span></span>
<span class="line"><span style="color:#A6ACCD;">from mongoengine import URLField</span></span>
<span class="line"><span style="color:#A6ACCD;">from mongoengine import connect</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">__author__ = &quot;liuzhijun&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"># \u8FDE\u63A5 mongodb</span></span>
<span class="line"><span style="color:#A6ACCD;">connect(&#39;weixin2&#39;, host=&#39;localhost&#39;, port=27017)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">class Post(Document):</span></span>
<span class="line"><span style="color:#A6ACCD;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    \u6587\u7AE0\u4FE1\u606F</span></span>
<span class="line"><span style="color:#A6ACCD;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    title = StringField()  # \u6587\u7AE0\u6807\u9898</span></span>
<span class="line"><span style="color:#A6ACCD;">    content_url = StringField()  # \u6587\u7AE0\u94FE\u63A5</span></span>
<span class="line"><span style="color:#A6ACCD;">    content = StringField()  # \u6587\u7AE0\u5185\u5BB9</span></span>
<span class="line"><span style="color:#A6ACCD;">    source_url = StringField()  # \u539F\u6587\u94FE\u63A5</span></span>
<span class="line"><span style="color:#A6ACCD;">    digest = StringField()  # \u6587\u7AE0\u6458\u8981</span></span>
<span class="line"><span style="color:#A6ACCD;">    cover = URLField(validation=None)  # \u5C01\u9762\u56FE</span></span>
<span class="line"><span style="color:#A6ACCD;">    p_date = DateTimeField()  # \u63A8\u9001\u65F6\u95F4</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    read_num = IntField(default=0)  # \u9605\u8BFB\u6570</span></span>
<span class="line"><span style="color:#A6ACCD;">    like_num = IntField(default=0)  # \u70B9\u8D5E\u6570</span></span>
<span class="line"><span style="color:#A6ACCD;">    comment_num = IntField(default=0)  # \u8BC4\u8BBA\u6570</span></span>
<span class="line"><span style="color:#A6ACCD;">    reward_num = IntField(default=0)  # \u8D5E\u8D4F\u6570</span></span>
<span class="line"><span style="color:#A6ACCD;">    author = StringField()  # \u4F5C\u8005</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    c_date = DateTimeField(default=datetime.now)  # \u6570\u636E\u751F\u6210\u65F6\u95F4</span></span>
<span class="line"><span style="color:#A6ACCD;">    u_date = DateTimeField(default=datetime.now)  # \u6700\u540E\u66F4\u65B0\u65F6\u95F4</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><h3 id="\u6570\u636E\u4FDD\u5B58" tabindex="-1">\u6570\u636E\u4FDD\u5B58 <a class="header-anchor" href="#\u6570\u636E\u4FDD\u5B58" aria-hidden="true">#</a></h3><p>\u5728\u7B2C\u4E94\u5C0F\u8282\u4E2D\uFF0C\u6211\u4EEC\u53EA\u662F\u628A\u6293\u53D6\u7684\u6570\u636E\u7B80\u5355\u7684\u6253\u5370\u51FA\u6765\uFF0C\u73B0\u5728\u6211\u4EEC\u5C31\u628A\u5B83\u5B58\u6570\u636E\u5E93\uFF0C\u56E0\u4E3A\u6293\u53D6\u7684\u6570\u636E\u4E2D\u6709\u5F88\u591A\u65E0\u7528\u7684\u5B57\u6BB5\uFF0C\u6240\u4EE5\uFF0C\u8FD9\u91CC\u6211\u4EEC\u5199\u4E00\u4E2A\u5DE5\u5177\u51FD\u6570\u53EB <code>sub_dict</code> \u7528\u4E8E\u83B7\u53D6\u6307\u5B9A\u5B57\u6BB5\u4FE1\u606F\u3002</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">import html</span></span>
<span class="line"><span style="color:#A6ACCD;">def sub_dict(d, keys):</span></span>
<span class="line"><span style="color:#A6ACCD;">    return {k: html.unescape(d[k]) for k in d if k in keys}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">d = {&quot;a&quot;: &quot;1&quot;, &quot;b&quot;: 2, &quot;c&quot;: 3}</span></span>
<span class="line"><span style="color:#A6ACCD;">sub_dict(d, [&quot;a&quot;, &quot;b&quot;]) # {&quot;a&quot;:&quot;1&quot;, &quot;b&quot;: &quot;2&quot;}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u83B7\u53D6\u5B57\u5178\u7684\u5B50\u5B57\u5178\u53EF\u4EE5\u7528\u5B57\u5178\u63A8\u5BFC\u5F0F\u5B9E\u73B0\uFF0C\u6211\u8FD9\u91CC\u8FD8\u5BFC\u5165\u4E86<code>html.unescape</code>\u65B9\u6CD5\u662F\u5E0C\u671B\u4FDD\u5B58\u5230\u6570\u636E\u5E93\u7684\u6570\u636E\u90FD\u662F\u7ECF\u8FC7\u53CD\u8F6C\u4E49\u5904\u7406\u7684\u3002</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">    @staticmethod</span></span>
<span class="line"><span style="color:#A6ACCD;">    def save(msg_list):</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">        msg_list = msg_list.replace(&quot;\\/&quot;, &quot;/&quot;)</span></span>
<span class="line"><span style="color:#A6ACCD;">        data = json.loads(msg_list)</span></span>
<span class="line"><span style="color:#A6ACCD;">        msg_list = data.get(&quot;list&quot;)</span></span>
<span class="line"><span style="color:#A6ACCD;">        for msg in msg_list:</span></span>
<span class="line"><span style="color:#A6ACCD;">            p_date = msg.get(&quot;comm_msg_info&quot;).get(&quot;datetime&quot;)</span></span>
<span class="line"><span style="color:#A6ACCD;">            msg_info = msg.get(&quot;app_msg_ext_info&quot;)  # \u975E\u56FE\u6587\u6D88\u606F\u6CA1\u6709\u6B64\u5B57\u6BB5</span></span>
<span class="line"><span style="color:#A6ACCD;">            if msg_info:</span></span>
<span class="line"><span style="color:#A6ACCD;">                WeiXinCrawler._insert(msg_info, p_date)</span></span>
<span class="line"><span style="color:#A6ACCD;">                multi_msg_info = msg_info.get(&quot;multi_app_msg_item_list&quot;) # \u591A\u56FE\u6587\u63A8\u9001\uFF0C\u628A\u7B2C\u4E8C\u6761\u7B2C\u4E09\u6761\u4E5F\u4FDD\u5B58</span></span>
<span class="line"><span style="color:#A6ACCD;">                for msg_item in multi_msg_info:</span></span>
<span class="line"><span style="color:#A6ACCD;">                    WeiXinCrawler._insert(msg_item, p_date)</span></span>
<span class="line"><span style="color:#A6ACCD;">            else:</span></span>
<span class="line"><span style="color:#A6ACCD;">                logger.warning(u&quot;\u6B64\u6D88\u606F\u4E0D\u662F\u56FE\u6587\u63A8\u9001\uFF0Cdata=%s&quot; % json.dumps(msg.get(&quot;comm_msg_info&quot;)))</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    @staticmethod</span></span>
<span class="line"><span style="color:#A6ACCD;">    def _insert(item, p_date):</span></span>
<span class="line"><span style="color:#A6ACCD;">        keys = (&#39;title&#39;, &#39;author&#39;, &#39;content_url&#39;, &#39;digest&#39;, &#39;cover&#39;, &#39;source_url&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">        sub_data = utils.sub_dict(item, keys)</span></span>
<span class="line"><span style="color:#A6ACCD;">        post = Post(**sub_data)</span></span>
<span class="line"><span style="color:#A6ACCD;">        p_date = datetime.fromtimestamp(p_date)</span></span>
<span class="line"><span style="color:#A6ACCD;">        post[&quot;p_date&quot;] = p_date</span></span>
<span class="line"><span style="color:#A6ACCD;">        logger.info(&#39;save data %s &#39; % post.title)</span></span>
<span class="line"><span style="color:#A6ACCD;">        try:</span></span>
<span class="line"><span style="color:#A6ACCD;">            post.save()</span></span>
<span class="line"><span style="color:#A6ACCD;">        except Exception as e:</span></span>
<span class="line"><span style="color:#A6ACCD;">            logger.error(&quot;\u4FDD\u5B58\u5931\u8D25 data=%s&quot; % post.to_json(), exc_info=True)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u5982\u679C\u662F\u6587\u5B57\u63A8\u9001\u5C31\u6CA1\u6709<code>app_msg_ext_info</code>\u5B57\u6BB5\uFF0C\u65E0\u9700\u4FDD\u5B58\uFF0C<code>multi_app_msg_item_list</code>\u662F\u591A\u56FE\u6587\u63A8\u9001\u5B57\u6BB5\uFF0C\u800C\u4E14\u548C\u5916\u5C42\u7684<code>app_msg_ext_info</code>\u5B57\u6BB5\u662F\u4E00\u81F4\u7684\uFF0C\u6709\u6807\u9898\u3001\u5C01\u9762\u56FE\u3001\u6458\u8981\u3001\u94FE\u63A5\u7B49\u4FE1\u606F\uFF0C\u6240\u4EE5\u6211\u4EEC\u628A\u63D2\u5165\u6570\u636E\u5E93\u7684\u4EE3\u7801<code>_insert</code>\u4F5C\u4E3A\u79C1\u6709\u65B9\u6CD5\u62BD\u79BB\u51FA\u6765\u5171\u7528\u3002</p><p>\u6700\u540E\u6211\u4EEC\u770B\u4E00\u4E0B\u4FDD\u5B58\u7684\u6570\u636E\u3002</p><p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2017/12/29/1609e87c99c34c71~tplv-t2oaga2asx-image.image" alt=""></p><h3 id="\u5C0F\u7ED3" tabindex="-1">\u5C0F\u7ED3 <a class="header-anchor" href="#\u5C0F\u7ED3" aria-hidden="true">#</a></h3><p>\u672C\u8282\u5B8C\u6210\u4EE3\u7801\u5728GitHub <a href="https://github.com/pythonzhichan/weixincrawler/tree/v0.3" target="_blank" rel="noreferrer">v0.3</a>\uFF0C\u8FD9\u5C0F\u8282\u6211\u4EEC\u4E3B\u8981\u719F\u6089 Mongodb \u7684\u5B89\u88C5\u4EE5\u53CA\u5982\u4F55\u7528Python\u8FDE\u63A5 Mongodb \u8FDB\u884C\u6570\u636E\u5B58\u50A8\uFF0C\u63A8\u8350\u4E24\u4E2A\u8D44\u6E90\uFF0C\u7B2C\u4E00\u4E2A\u662F\uFF1A<a href="https://jockchou.gitbooks.io/getting-started-with-mongodb/content/" target="_blank" rel="noreferrer">\u300AMongoDB \u5165\u95E8\u6307\u5357\u300B</a>\uFF0C\u7B2C\u4E8C\u4E2A\u662F <a href="http://docs.mongoengine.org/index.html" target="_blank" rel="noreferrer">MongoEngine \u6559\u7A0B</a>\uFF0C\u5982\u679C\u4F60\u60F3\u8FDB\u884C\u7CFB\u7EDF\u7684\u5B66\u4E60 MongoDB\uFF0C\u63A8\u8350\u4E24\u672C\u4E66\u7C4D\u300AMongoDB\u6743\u5A01\u6307\u5357\u300B\u548C\u300AMongoDB\u5B9E\u6218\u300B\u3002</p>`,31),p=[l];function t(c,i,r,d,g,C){return a(),n("div",null,p)}const u=s(e,[["render",t]]);export{m as __pageData,u as default};
