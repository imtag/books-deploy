import{_ as s,c as n,o as a,d as l}from"./app.e0e4ea3a.js";const y=JSON.parse('{"title":"\u6293\u53D6\u5FAE\u4FE1\u516C\u4F17\u53F7\u6240\u6709\u5386\u53F2\u6587\u7AE0","description":"","frontmatter":{},"headers":[{"level":3,"title":"\u5206\u6790\u6293\u5305\u6570\u636E","slug":"\u5206\u6790\u6293\u5305\u6570\u636E","link":"#\u5206\u6790\u6293\u5305\u6570\u636E","children":[]},{"level":3,"title":"\u4EE3\u7801\u5B9E\u73B0","slug":"\u4EE3\u7801\u5B9E\u73B0","link":"#\u4EE3\u7801\u5B9E\u73B0","children":[]}],"relativePath":"\u5176\u4ED6/\u57FA\u4E8E Python \u5B9E\u73B0\u5FAE\u4FE1\u516C\u4F17\u53F7\u722C\u866B/\u6293\u53D6\u5FAE\u4FE1\u516C\u4F17\u53F7\u6240\u6709\u5386\u53F2\u6587\u7AE0.md"}'),p={name:"\u5176\u4ED6/\u57FA\u4E8E Python \u5B9E\u73B0\u5FAE\u4FE1\u516C\u4F17\u53F7\u722C\u866B/\u6293\u53D6\u5FAE\u4FE1\u516C\u4F17\u53F7\u6240\u6709\u5386\u53F2\u6587\u7AE0.md"},e=l(`<h1 id="\u6293\u53D6\u5FAE\u4FE1\u516C\u4F17\u53F7\u6240\u6709\u5386\u53F2\u6587\u7AE0" tabindex="-1">\u6293\u53D6\u5FAE\u4FE1\u516C\u4F17\u53F7\u6240\u6709\u5386\u53F2\u6587\u7AE0 <a class="header-anchor" href="#\u6293\u53D6\u5FAE\u4FE1\u516C\u4F17\u53F7\u6240\u6709\u5386\u53F2\u6587\u7AE0" aria-hidden="true">#</a></h1><hr><h1 id="\u6293\u53D6\u516C\u4F17\u53F7\u6240\u6709\u5386\u53F2\u6587\u7AE0" tabindex="-1">\u6293\u53D6\u516C\u4F17\u53F7\u6240\u6709\u5386\u53F2\u6587\u7AE0 <a class="header-anchor" href="#\u6293\u53D6\u516C\u4F17\u53F7\u6240\u6709\u5386\u53F2\u6587\u7AE0" aria-hidden="true">#</a></h1><p>\u6211\u4EEC\u6309\u7167\u7B2C\u4E09\u8282\u4F7F\u7528 Fiddler \u6293\u5305\u65B9\u5F0F\uFF0C\u6253\u5F00\u624B\u673A\u67D0\u4E2A\u5FAE\u4FE1\u516C\u4F17\u53F7\u5386\u53F2\u6587\u7AE0\u5217\u8868\uFF0C\u4E0A\u62C9\u52A0\u8F7D\u66F4\u591A\uFF0C\u627E\u5230\u52A0\u8F7D\u66F4\u591A\u6587\u7AE0\u7684 URL \u8BF7\u6C42\u5730\u5740\uFF0C\u4F60\u4F1A\u770B\u5230 Fiddler \u4F1A\u6709\u4E00\u4E2A\u52A0\u8F7D\u66F4\u591A\u6587\u7AE0\u5217\u8868\u7684\u8BF7\u6C42\u3002</p><p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2017/12/23/1607f86a0e361895~tplv-t2oaga2asx-image.image" alt=""></p><h3 id="\u5206\u6790\u6293\u5305\u6570\u636E" tabindex="-1">\u5206\u6790\u6293\u5305\u6570\u636E <a class="header-anchor" href="#\u5206\u6790\u6293\u5305\u6570\u636E" aria-hidden="true">#</a></h3><p>\u8BE5\u63A5\u53E3\u8FD4\u56DE\u7684\u6570\u636E\u662F JSON \u683C\u5F0F\uFF0C\u8FD9\u79CD\u6570\u636E\u683C\u5F0F\u5904\u7406\u8D77\u6765\u975E\u5E38\u65B9\u4FBF\uFF0C\u9996\u5148\u6211\u4EEC\u628A\u6570\u636E\u62F7\u8D1D\u5230 Chrome \u63D2\u4EF6 JSON Editor \u6216\u8005\u627E\u4E00\u4E2A<a href="https://jsonformatter.curiousconcept.com/" target="_blank" rel="noreferrer">JSON Online Formatter</a> \u5BF9\u8FD4\u56DE\u7684\u6570\u636E\u8FDB\u884C\u683C\u5F0F\u5316\u5904\u7406\uFF0C\u4EE5\u4FBF\u67E5\u770B\u6BCF\u4E2A\u5B57\u6BB5\u6240\u4EE3\u8868\u7684\u610F\u4E49\u3002</p><p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2017/12/23/1607f86e8b11adca~tplv-t2oaga2asx-image.image" alt=""></p><p>\u4F60\u53EF\u4EE5\u5927\u6982\u731C\u51FA\u6765\u6BCF\u4E2A\u5B57\u6BB5\u7684\u610F\u601D</p><ul><li>ret\uFF1A\u8BF7\u6C42\u662F\u5426\u6210\u529F\uFF0C0\u5C31\u8868\u793A\u6210\u529F</li><li>msg_count\uFF1A \u8FD4\u56DE\u7684\u6570\u636E\u6761\u6570</li><li>can_msg_continue\uFF1A \u662F\u5426\u8FD8\u6709\u4E0B\u4E00\u9875\u6570\u636E</li><li>next_offset\uFF1A \u4E0B\u4E00\u6B21\u8BF7\u6C42\u7684\u8D77\u59CB\u4F4D\u7F6E</li><li>general_msg_list\uFF1A\u771F\u5B9E\u6570\u636E</li></ul><p><code>general_msg_list</code>\u662F\u5386\u53F2\u6587\u7AE0\u91CC\u9762\u7684\u57FA\u672C\u4FE1\u606F\uFF0C\u5305\u62EC\u6BCF\u7BC7\u6587\u7AE0\u7684\u6807\u9898\u3001\u53D1\u5E03\u65F6\u95F4\u3001\u6458\u8981\u3001\u94FE\u63A5\u5730\u5740\u3001\u5C01\u9762\u56FE\u7B49\uFF0C\u800C\u50CF\u6587\u7AE0\u7684\u9605\u8BFB\u6570\u3001\u70B9\u8D5E\u6570\u3001\u8BC4\u8BBA\u6570\u3001\u8D5E\u8D4F\u6570\u8FD9\u4E9B\u6570\u636E\u90FD\u9700\u8981\u901A\u8FC7\u989D\u5916\u63A5\u53E3\u83B7\u53D6\u3002</p><h3 id="\u4EE3\u7801\u5B9E\u73B0" tabindex="-1">\u4EE3\u7801\u5B9E\u73B0 <a class="header-anchor" href="#\u4EE3\u7801\u5B9E\u73B0" aria-hidden="true">#</a></h3><p>\u5206\u6790\u5B8C\u540E\uFF0C\u7528\u4EE3\u7801\u5B9E\u73B0\u5176\u5B9E\u975E\u5E38\u7B80\u5355\uFF0C\u6309\u7167\u4E0A\u8282\u7684\u65B9\u5F0F\uFF0C\u6211\u4EEC\u628A URL \u548C Header \u4FE1\u606F\u76F4\u63A5\u4ECE Fiddler \u4E2D\u62F7\u8D1D\u8FC7\u6765\u3002</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;"># crawler.py</span></span>
<span class="line"><span style="color:#A6ACCD;"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">import logging</span></span>
<span class="line"><span style="color:#A6ACCD;">import utils</span></span>
<span class="line"><span style="color:#A6ACCD;">import requests</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">logging.basicConfig(level=logging.INFO)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">logger = logging.getLogger(__name__)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">class WeiXinCrawler:</span></span>
<span class="line"><span style="color:#A6ACCD;">    def crawl(self):</span></span>
<span class="line"><span style="color:#A6ACCD;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        \u722C\u53D6\u66F4\u591A\u6587\u7AE0</span></span>
<span class="line"><span style="color:#A6ACCD;">        :return:</span></span>
<span class="line"><span style="color:#A6ACCD;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        url = &quot;https://mp.weixin.qq.com/mp/profile_ext?&quot; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">                &quot;action=getmsg&amp;&quot; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">                &quot;__biz=MjM5MzgyODQxMQ==&quot; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">                &quot;&amp;f=json&amp;&quot; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">                &quot;offset=11&amp;&quot; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">                &quot;count=10&amp;&quot; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">                &quot;is_ok=1&quot; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">                &quot;&amp;scene=124&amp;&quot; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">                &quot;uin=777&amp;key=777&amp;&quot; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">                &quot;pass_ticket=25llsA6zWUPC9KHOvP4oE%2BQwJ3nS%2F3CjeWxeKBjDhxCb7V1lQQJa6d0ZrgSmCvWa&amp;wxtoken=&amp;&quot; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">                &quot;appmsg_token=936_qKN8I1KSEO%252BWB2YUShHV8kgkIGXgzl-CT8JJpw~~&amp;&quot; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">                &quot;x5=0&amp;&quot; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">                &quot;f=json&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">        headers = &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">                    Host: mp.weixin.qq.com</span></span>
<span class="line"><span style="color:#A6ACCD;">                    .... \u7701\u7565\u4E86\uFF0C\u81EA\u5DF1\u8865\u5145 ...</span></span>
<span class="line"><span style="color:#A6ACCD;">                    &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        headers = utils.str_to_dict(headers)</span></span>
<span class="line"><span style="color:#A6ACCD;">        response = requests.get(url, headers=headers, verify=False)</span></span>
<span class="line"><span style="color:#A6ACCD;">        result = response.json()</span></span>
<span class="line"><span style="color:#A6ACCD;">        if result.get(&quot;ret&quot;) == 0:</span></span>
<span class="line"><span style="color:#A6ACCD;">            msg_list = result.get(&quot;general_msg_list&quot;)</span></span>
<span class="line"><span style="color:#A6ACCD;">            logger.info(&quot;\u6293\u53D6\u6570\u636E\uFF1Aoffset=%s, data=%s&quot; % (offset, msg_list))</span></span>
<span class="line"><span style="color:#A6ACCD;">        else:</span></span>
<span class="line"><span style="color:#A6ACCD;">            # \u9519\u8BEF\u6D88\u606F</span></span>
<span class="line"><span style="color:#A6ACCD;">            # {&quot;ret&quot;:-3,&quot;errmsg&quot;:&quot;no session&quot;,&quot;cookie_count&quot;:1}</span></span>
<span class="line"><span style="color:#A6ACCD;">            logger.error(&quot;\u65E0\u6CD5\u6B63\u786E\u83B7\u53D6\u5185\u5BB9\uFF0C\u8BF7\u91CD\u65B0\u4ECEFiddler\u83B7\u53D6\u8BF7\u6C42\u53C2\u6570\u548C\u8BF7\u6C42\u5934&quot;)</span></span>
<span class="line"><span style="color:#A6ACCD;">            exit()</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">if __name__ == &#39;__main__&#39;:</span></span>
<span class="line"><span style="color:#A6ACCD;">    crawler = WeiXinCrawler()</span></span>
<span class="line"><span style="color:#A6ACCD;">    crawler.crawl()</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u6210\u529F\u722C\u53D6\u4E86\u7B2C\u4E8C\u9875\u7684\u6570\u636E\uFF0C\u90A3\u4E48\u7B2C\u4E09\u9875\u5462\uFF0C\u7B2C\u56DB\u9875\u5462\uFF1F\u6240\u4EE5\uFF0C\u6211\u4EEC\u8FD8\u9700\u8981\u5BF9\u8BE5\u65B9\u6CD5\u8FDB\u884C\u91CD\u6784\uFF0C\u4F7F\u5F97\u5B83\u53EF\u4EE5\u6293\u53D6\u516C\u4F17\u53F7\u5168\u90E8\u5386\u53F2\u6587\u7AE0\u3002\u901A\u8FC7\u5B57\u6BB5 can_msg_continue \u786E\u5B9A\u662F\u5426\u7EE7\u7EED\u6293\u53D6\uFF0C\u518D\u7ED3\u5408 next_offset \u5C31\u53EF\u4EE5\u52A0\u8F7D\u66F4\u591A\u6570\u636E\uFF0C\u6211\u4EEC\u9700\u8981\u628A url \u4E2D\u53EF\u53D8\u7684\u53C2\u6570 offset \u7528\u53D8\u91CF\u6765\u4EE3\u66FF\uFF0C\u9012\u5F52\u8C03\u7528\u76F4\u5230 <code>can_msg_continue</code> \u4E3A 0 \u8BF4\u660E\u6240\u6709\u6587\u7AE0\u90FD\u722C\u53D6\u5B8C\u4E86\u3002</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">    def crawl(self, offset=0):</span></span>
<span class="line"><span style="color:#A6ACCD;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        \u722C\u53D6\u66F4\u591A\u6587\u7AE0</span></span>
<span class="line"><span style="color:#A6ACCD;">        :return:</span></span>
<span class="line"><span style="color:#A6ACCD;">        &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        url = &quot;https://mp.weixin.qq.com/mp/profile_ext?&quot; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">              &quot;action=getmsg&amp;&quot; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">              &quot;__biz=MjM5MzgyODQxMQ==&amp;&quot; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">              &quot;f=json&amp;&quot; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">              &quot;offset={offset}&amp;&quot; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">              &quot;count=10&amp;&quot; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">              &quot;is_ok=1&amp;&quot; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">              &quot;scene=&amp;&quot; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">              &quot;uin=777&amp;&quot; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">              &quot;key=777&amp;&quot; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">              &quot;pass_ticket=25llsA6zWUPC9KHOvP4oE+QwJ3nS/3CjeWxeKBjDhxCb7V1lQQJa6d0ZrgSmCvWa&amp;&quot; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">              &quot;wxtoken=&amp;&quot; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">              &quot;appmsg_token=936_qKN8I1KSEO%2BWB2YUShHV8kgkIGXgzl-CT8JJpw~~&amp;&quot; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">              &quot;x5=1&amp;&quot; \\</span></span>
<span class="line"><span style="color:#A6ACCD;">              &quot;f=json&quot;.format(offset=offset)  # \u8BF7\u5C06appmsg_token\u548Cpass_ticket\u66FF\u6362\u6210\u4F60\u81EA\u5DF1\u7684</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">        headers = &quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">Host: mp.weixin.qq.com</span></span>
<span class="line"><span style="color:#A6ACCD;">.... \u7701\u7565\u4E86\uFF0C\u81EA\u5DF1\u8865\u5145 ...</span></span>
<span class="line"><span style="color:#A6ACCD;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        headers = utils.str_to_dict(headers)</span></span>
<span class="line"><span style="color:#A6ACCD;">        response = requests.get(url, headers=headers, verify=False)</span></span>
<span class="line"><span style="color:#A6ACCD;">        result = response.json()</span></span>
<span class="line"><span style="color:#A6ACCD;">        if result.get(&quot;ret&quot;) == 0:</span></span>
<span class="line"><span style="color:#A6ACCD;">            msg_list = result.get(&quot;general_msg_list&quot;)</span></span>
<span class="line"><span style="color:#A6ACCD;">            logger.info(&quot;\u6293\u53D6\u6570\u636E\uFF1Aoffset=%s, data=%s&quot; % (offset, msg_list))</span></span>
<span class="line"><span style="color:#A6ACCD;">            # \u9012\u5F52\u8C03\u7528</span></span>
<span class="line"><span style="color:#A6ACCD;">            has_next = result.get(&quot;can_msg_continue&quot;)</span></span>
<span class="line"><span style="color:#A6ACCD;">            if has_next == 1:</span></span>
<span class="line"><span style="color:#A6ACCD;">                next_offset = result.get(&quot;next_offset&quot;)</span></span>
<span class="line"><span style="color:#A6ACCD;">                time.sleep(2)</span></span>
<span class="line"><span style="color:#A6ACCD;">                self.crawl(next_offset)</span></span>
<span class="line"><span style="color:#A6ACCD;">        else:</span></span>
<span class="line"><span style="color:#A6ACCD;">            # \u9519\u8BEF\u6D88\u606F</span></span>
<span class="line"><span style="color:#A6ACCD;">            # {&quot;ret&quot;:-3,&quot;errmsg&quot;:&quot;no session&quot;,&quot;cookie_count&quot;:1}</span></span>
<span class="line"><span style="color:#A6ACCD;">            logger.error(&quot;\u65E0\u6CD5\u6B63\u786E\u83B7\u53D6\u5185\u5BB9\uFF0C\u8BF7\u91CD\u65B0\u4ECEFiddler\u83B7\u53D6\u8BF7\u6C42\u53C2\u6570\u548C\u8BF7\u6C42\u5934&quot;)</span></span>
<span class="line"><span style="color:#A6ACCD;">            exit()</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u5F53 has_next \u4E3A 0 \u65F6\uFF0C\u8BF4\u660E\u5DF2\u7ECF\u5230\u4E86\u6700\u540E\u4E00\u9875\uFF0C\u8FD9\u65F6\u624D\u7B97\u722C\u5B8C\u4E86\u4E00\u4E2A\u516C\u4F17\u53F7\u7684\u6240\u6709\u5386\u53F2\u6587\u7AE0\uFF0C\u73B0\u5728\u628A\u6240\u6709\u7684\u6587\u7AE0\u6458\u8981\u6570\u636E\u6293\u53D6\u4E0B\u6765\u4E86\uFF0C\u4F46\u662F\u6570\u636E\u8FD8\u6CA1\u6709\u5B58\u50A8\uFF0C\u4E0B\u4E00\u8282\uFF0C\u6211\u4EEC\u5C06\u4F7F\u7528MongoDB\u5C06\u6570\u636E\u8FDB\u884C\u6301\u4E45\u5316\u3002</p><p>\u672C\u8282\u5B8C\u6574\u4EE3\u7801\u5730\u5740\uFF1A<a href="https://github.com/pythonzhichan/weixincrawler/tree/v0.2" target="_blank" rel="noreferrer">weixincrawler/v0.2</a></p>`,18),o=[e];function t(c,r,i,C,A,u){return a(),n("div",null,o)}const D=s(p,[["render",t]]);export{y as __pageData,D as default};
