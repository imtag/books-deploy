import{_ as s,c as n,o as a,d as l}from"./app.e0e4ea3a.js";const D=JSON.parse('{"title":"\u80A1\u7968\u4EA4\u6613\u7B56\u7565-\u6D77\u9F9F\u62E9\u65F6\u7B56\u7565\u5165\u95E8\u91CF\u5316\u4EA4\u6613","description":"","frontmatter":{},"headers":[{"level":2,"title":"\u524D\u8A00","slug":"\u524D\u8A00","link":"#\u524D\u8A00","children":[]},{"level":2,"title":"N\u65E5\u7A81\u7834\u62E9\u65F6\u7B56\u7565","slug":"n\u65E5\u7A81\u7834\u62E9\u65F6\u7B56\u7565","link":"#n\u65E5\u7A81\u7834\u62E9\u65F6\u7B56\u7565","children":[]},{"level":2,"title":"\u4E70\u5356\u4FE1\u53F7\u533A\u95F4\u53EF\u89C6\u5316","slug":"\u4E70\u5356\u4FE1\u53F7\u533A\u95F4\u53EF\u89C6\u5316","link":"#\u4E70\u5356\u4FE1\u53F7\u533A\u95F4\u53EF\u89C6\u5316","children":[]},{"level":2,"title":"\u603B\u7ED3","slug":"\u603B\u7ED3","link":"#\u603B\u7ED3","children":[]}],"relativePath":"\u5176\u4ED6/Python\u6570\u636E\u5206\u6790\u5B9E\u6218\uFF1A\u6784\u5EFA\u80A1\u7968\u91CF\u5316\u4EA4\u6613\u7CFB\u7EDF/\u80A1\u7968\u4EA4\u6613\u7B56\u7565-\u6D77\u9F9F\u62E9\u65F6\u7B56\u7565\u5165\u95E8\u91CF\u5316\u4EA4\u6613.md"}'),p={name:"\u5176\u4ED6/Python\u6570\u636E\u5206\u6790\u5B9E\u6218\uFF1A\u6784\u5EFA\u80A1\u7968\u91CF\u5316\u4EA4\u6613\u7CFB\u7EDF/\u80A1\u7968\u4EA4\u6613\u7B56\u7565-\u6D77\u9F9F\u62E9\u65F6\u7B56\u7565\u5165\u95E8\u91CF\u5316\u4EA4\u6613.md"},o=l(`<h1 id="\u80A1\u7968\u4EA4\u6613\u7B56\u7565-\u6D77\u9F9F\u62E9\u65F6\u7B56\u7565\u5165\u95E8\u91CF\u5316\u4EA4\u6613" tabindex="-1">\u80A1\u7968\u4EA4\u6613\u7B56\u7565-\u6D77\u9F9F\u62E9\u65F6\u7B56\u7565\u5165\u95E8\u91CF\u5316\u4EA4\u6613 <a class="header-anchor" href="#\u80A1\u7968\u4EA4\u6613\u7B56\u7565-\u6D77\u9F9F\u62E9\u65F6\u7B56\u7565\u5165\u95E8\u91CF\u5316\u4EA4\u6613" aria-hidden="true">#</a></h1><hr><h1 id="\u80A1\u7968\u4EA4\u6613\u7B56\u7565\uFF1A\u6D77\u9F9F\u62E9\u65F6\u7B56\u7565\u5165\u95E8\u91CF\u5316\u4EA4\u6613" tabindex="-1">\u80A1\u7968\u4EA4\u6613\u7B56\u7565\uFF1A\u6D77\u9F9F\u62E9\u65F6\u7B56\u7565\u5165\u95E8\u91CF\u5316\u4EA4\u6613 <a class="header-anchor" href="#\u80A1\u7968\u4EA4\u6613\u7B56\u7565\uFF1A\u6D77\u9F9F\u62E9\u65F6\u7B56\u7565\u5165\u95E8\u91CF\u5316\u4EA4\u6613" aria-hidden="true">#</a></h1><h2 id="\u524D\u8A00" tabindex="-1">\u524D\u8A00 <a class="header-anchor" href="#\u524D\u8A00" aria-hidden="true">#</a></h2><p>\u80A1\u7968\u4EA4\u6613\u9700\u8981\u505A\u7684\u6709\u4E09\u4EF6\u4E8B\uFF1A\u9009\u80A1\u3001\u62E9\u65F6\u548C\u4ED3\u4F4D\u7BA1\u7406\u3002\u5173\u4E8E\u62E9\u65F6\u65B9\u9762\u7684\u4EA4\u6613\u7B56\u7565\uFF0C\u76EE\u524D\u5E02\u9762\u4E0A\u6709\u590D\u6742\u7684\u3001\u4E5F\u6709\u7B80\u5355\u7684\uFF0C\u79CD\u7C7B\u7E41\u591A\u3002\u5176\u5B9E\u80A1\u4EF7\u7684\u6DA8\u8DCC\u672C\u8D28\u539F\u56E0\u662F\u591A\u7A7A\u53CC\u65B9\u4E4B\u95F4\u7684\u535A\u5F08\uFF0C\u9009\u62E9\u4EA4\u6613\u7684\u65F6\u673A\u4E5F\u5C31\u662F\u5224\u65AD\u591A\u7A7A\u53CC\u65B9\u4E4B\u95F4\u6297\u8861\u7684\u5C40\u52BF\u3002</p><p>\u4F5C\u4E3A\u4E00\u540D\u80A1\u7968\u4EA4\u6613\u8005\uFF0C\u5236\u5B9A\u7B56\u7565\u7684\u51FA\u53D1\u70B9\u5E94\u8BE5\u66F4\u591A\u7684\u662F\u4E3A\u4E86\u62E8\u5F00\u80A1\u4EF7\u73B0\u8C61\u770B\u5230\u591A\u7A7A\u53CC\u65B9\u52A8\u80FD\u7684\u672C\u8D28\uFF0C\u800C\u4E0D\u662F\u4E00\u5473\u8FFD\u6C42\u590D\u6742\u7684\u7B56\u7565\u673A\u5236\u3002\u672C\u5C0F\u8282\u9009\u53D6\u91CF\u5316\u7ECF\u5178\u4F5C\u54C1\u300A\u6D77\u9F9F\u4EA4\u6613\u6CD5\u5219\u300B\u4E2D\u7684\u7ECF\u5178\u8D8B\u52BF\u578B\u7B56\u7565\u4F5C\u4E3A\u6848\u4F8B\uFF0C\u4ECB\u7ECD\u91CF\u5316\u4EA4\u6613\u62E9\u65F6\u7B56\u7565\u7684\u4E70\u5356\u4FE1\u53F7\u5236\u5B9A\u8FC7\u7A0B\uFF0C\u5E76\u4EE5\u53EF\u89C6\u5316\u65B9\u6CD5\u5448\u73B0\u4FE1\u53F7\u7684\u89E6\u53D1\u3002</p><h2 id="n\u65E5\u7A81\u7834\u62E9\u65F6\u7B56\u7565" tabindex="-1">N\u65E5\u7A81\u7834\u62E9\u65F6\u7B56\u7565 <a class="header-anchor" href="#n\u65E5\u7A81\u7834\u62E9\u65F6\u7B56\u7565" aria-hidden="true">#</a></h2><p>\u201C\u6211\u4EEC\u8981\u57F9\u517B\u4EA4\u6613\u8005\uFF0C\u5C31\u50CF\u65B0\u52A0\u5761\u4EBA\u517B\u6D77\u9F9F\u4E00\u6837\u3002\u201D\u8457\u540D\u7684\u4EA4\u6613\u5927\u5E08\u7406\u67E5\u5FB7\xB7\u4E39\u5C3C\u65AF\u5728\u65B0\u52A0\u5761\u65F6\u805A\u7CBE\u4F1A\u795E\u89C2\u5BDF\u7740\u4E00\u4E2A\u6D77\u9F9F\u519C\u573A\uFF0C\u7A81\u7136\u51B2\u53E3\u8BF4\u51FA\u4E86\u8FD9\u6837\u4E00\u53E5\u8BDD\uFF0C\u8457\u540D\u7684\u201C\u6D77\u9F9F\u4EA4\u6613\u8BD5\u9A8C\u201D\u6B63\u662F\u53D6\u540D\u4E8E\u6B64\u3002</p><p>\u201C\u6D77\u9F9F\u4EA4\u6613\u8BD5\u9A8C\u201D\u7684\u8D77\u56E0\u662F\u7406\u67E5\u5FB7\xB7\u4E39\u5C3C\u65AF\u60F3\u5F04\u6E05\u4F1F\u5927\u7684\u4EA4\u6613\u5458\u662F\u5929\u751F\u9020\u5C31\u7684\u8FD8\u662F\u540E\u5929\u57F9\u517B\u7684\u3002\u4E3A\u6B64\uFF0C\u4ED6\u57281983\u5E74\u4ED6\u62DB\u52DF\u4E8613\u4E2A\u4EBA\uFF0C\u6559\u6388\u7ED9\u4ED6\u4EEC\u671F\u8D27\u4EA4\u6613\u7684\u57FA\u672C\u6982\u5FF5\uFF0C\u4EE5\u53CA\u4ED6\u81EA\u5DF1\u7684\u4EA4\u6613\u65B9\u6CD5\u548C\u539F\u5219\uFF0C\u5B66\u5458\u4EEC\u88AB\u79F0\u4E3A\u201C\u6D77\u9F9F\u201D\u3002\u5728\u968F\u540E\u76844\u5E74\u4E2D\uFF0C\u6D77\u9F9F\u4EEC\u53D6\u5F97\u4E86\u5E74\u5747\u590D\u522980%\u7684\u6536\u76CA\u3002</p><p>\u201C\u6D77\u9F9F\u4EA4\u6613\u8BD5\u9A8C\u201D\u4E5F\u56E0\u6B64\u6210\u4E3A\u4E86\u91D1\u878D\u53F2\u4E0A\u8457\u540D\u7684\u5B9E\u9A8C\uFF0C\u5728\u5B9E\u9A8C\u4E2D\u7684\u8FD0\u7528\u7684\u300A\u6D77\u9F9F\u4EA4\u6613\u6CD5\u5219\u300B\u975E\u5E38\u9002\u5408\u5E94\u7528\u4E8E\u91CF\u5316\u5206\u6790\uFF0C\u4EE5\u81F3\u4E8E\u5728\u8FD1\u51E0\u5E74\u7684\u91CF\u5316\u6295\u8D44\u70ED\u6D6A\u4E2D\u518D\u4E00\u6B21\u6210\u4E3A\u70ED\u95E8\u6A21\u5F0F\u3002</p><p>\u300A\u6D77\u9F9F\u4EA4\u6613\u6CD5\u5219\u300B\u4E2D\u4ECB\u7ECD\u4E86\u4E00\u79CD\u8D8B\u52BF\u7C7B\u7684\u62E9\u65F6\u7B56\u7565\u2014\u2014N\u65E5\u7A81\u7834\u7B56\u7565\u3002\u7B56\u7565\u7684\u6838\u5FC3\u601D\u60F3\u4E3A\uFF1A\u5F53\u5929\u6536\u76D8\u4EF7\u8D85\u8FC7N1\u5929\u5185\u6700\u9AD8\u4EF7\u8BA4\u4E3A\u4E0A\u5347\u8D8B\u52BF\u6210\u7ACB\uFF0C\u4F5C\u4E3A\u4E70\u5165\u4FE1\u53F7\uFF1B\u5F53\u5929\u6536\u76D8\u4EF7\u4F4E\u4E8EN2\u5929\u5185\u6700\u4F4E\u4EF7\u683C\u8BA4\u4E3A\u4E0B\u8DCC\u8D8B\u52BF\u6210\u7ACB\uFF0C\u4F5C\u4E3A\u5356\u51FA\u4FE1\u53F7\u3002\u4E5F\u5C31\u662F\u8BF4\uFF0CN\u65E5\u8D8B\u52BF\u7A81\u7834\u4E70\u5165\u5373\u4E3AN\u65E5\u521B\u65B0\u9AD8\u4E70\u5165\uFF0C\u80A1\u4EF7\u521B\u51FA\u9636\u6BB5\u6027\u65B0\u9AD8\u6216\u5386\u53F2\u65B0\u9AD8\u540E\uFF0C\u4E00\u65B9\u9762\u8BF4\u660E\u8BE5\u80A1\u6709\u8D44\u91D1\u5728\u8FD0\u4F5C\uFF0C\u76F8\u5BF9\u6BD4\u8F83\u5F3A\u52BF\uFF0C\u66F4\u5BB9\u6613\u987A\u52BF\u800C\u4E0A\uFF0C\u53E6\u4E00\u65B9\u9762\u521B\u65B0\u9AD8\u540E\u8FD1\u671F\u4E70\u5165\u7684\u6295\u8D44\u8005\u90FD\u6709\u83B7\u5229\uFF0C\u4E0A\u6863\u7684\u5957\u7262\u76D8\u6BD4\u8F83\u5C11\uFF0C\u80A1\u4EF7\u4E0A\u51B2\u7684\u963B\u529B\u4E5F\u8F83\u5C0F\uFF0C\u66F4\u5BB9\u6613\u7EE7\u7EED\u4E0A\u6DA8\u3002\u53CD\u4E4B\uFF0CN\u65E5\u8D8B\u52BF\u8DCC\u7834\u65F6\u5356\u51FA\u7684\u903B\u8F91\u601D\u7EF4\u4E00\u6837\u6210\u7ACB\u3002</p><p>\u6B64\u5904\u4F7F\u7528\u524D\u9762\u5C0F\u8282\u6240\u4ECB\u7ECD\u7684\u80A1\u7968\u4EA4\u6613\u6570\u636E\u63A5\u53E3\u6765\u83B7\u53D6\u534E\u80DC\u5929\u62102018-10-1\u81F32019-4-1\u534A\u5E74\u7684\u4EA4\u6613\u6570\u636E\uFF0C\u4F5C\u4E3A\u672C\u5C0F\u8282\u7684\u4F8B\u7A0B\u6570\u636E\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">df_stockload = web.DataReader(&quot;600410.SS&quot;, &quot;yahoo&quot;, datetime.datetime(2018,10,1), datetime.datetime(2019,4,1))</span></span>
<span class="line"><span style="color:#A6ACCD;">print(df_stockload.describe())</span></span>
<span class="line"><span style="color:#A6ACCD;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        High    Low   Open  Close   Volume  Adj Close</span></span>
<span class="line"><span style="color:#A6ACCD;">count  120.0  120.0  120.0  120.0  1.2e+02      120.0</span></span>
<span class="line"><span style="color:#A6ACCD;">mean     6.9    6.6    6.8    6.8  2.9e+07        6.8</span></span>
<span class="line"><span style="color:#A6ACCD;">std      1.1    1.0    1.1    1.1  2.9e+07        1.1</span></span>
<span class="line"><span style="color:#A6ACCD;">min      5.5    5.1    5.2    5.3  0.0e+00        5.3</span></span>
<span class="line"><span style="color:#A6ACCD;">25%      6.2    6.0    6.1    6.1  1.3e+07        6.1</span></span>
<span class="line"><span style="color:#A6ACCD;">50%      6.6    6.3    6.4    6.4  1.7e+07        6.4</span></span>
<span class="line"><span style="color:#A6ACCD;">75%      7.1    6.8    6.9    7.0  3.1e+07        7.0</span></span>
<span class="line"><span style="color:#A6ACCD;">max     10.7   10.0   10.4   10.7  1.5e+08       10.7</span></span>
<span class="line"><span style="color:#A6ACCD;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u63A5\u4E0B\u6765\u9700\u8981\u786E\u5B9AN\u65E5\u7A81\u7834\u7B56\u7565\u7684\u53C2\u6570N1\u3001N2\u3002\u5173\u4E8E\u53C2\u6570N1\u3001N2\u7684\u9009\u53D6\uFF0C\u5047\u5B9A\u6211\u4EEC\u4FA7\u91CD\u4E8E\u4E2D\u7EBF\u5468\u671F\u7684\u4EA4\u6613\uFF0C\u6B64\u5904\u9009\u62E9N1\u53C2\u6570\u4E3A15\u5929\uFF0CN2\u53C2\u6570\u4E3A5\u5929\uFF0C\u81F3\u4E8E\u53C2\u6570N1\u5927\u4E8EN2\u7684\u539F\u56E0\u662F\u4E3A\u4E86\u6253\u9020\u4E00\u4E2A\u975E\u5747\u8861\u80DC\u8D1F\u6536\u76CA\u7684\u73AF\u5883\uFF0C\u56E0\u4E3A\u6211\u4EEC\u4ECE\u4E8B\u91CF\u5316\u4EA4\u6613\u7684\u76EE\u6807\u662F\u8981\u8D62\u94B1\u6BD4\u4E8F\u94B1\u8981\u591A\u3002</p><p>\u8BA1\u7B97\u8BE5\u80A1N1\u65E5\u4EA4\u6613\u65E5\u7684\u6EDA\u52A8\u6700\u5927\u503C\u3002\u6B64\u5904\u4F7F\u7528<code>df.rolling().max()</code>\u8FD9\u79CD\u65B9\u5F0F\uFF0C\u53EA\u9700\u63D0\u4F9B\u6700\u9AD8\u4EF7\u548C\u79FB\u52A8\u65F6\u95F4\u7A97\u53E3\u5927\u5C0F\u5373\u53EF\uFF0C\u5BF9\u4F7F\u7528\u8005\u6765\u8BF4\u662F\u975E\u5E38\u65B9\u4FBF\u5FEB\u6377\u7684\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">df_stockload[&#39;N1_High&#39;] = df_stockload.High.rolling(window=N1).max()#\u8BA1\u7B97\u6700\u8FD1N1\u4E2A\u4EA4\u6613\u65E5\u6700\u9AD8\u4EF7</span></span>
<span class="line"><span style="color:#A6ACCD;">print(df_stockload.info())</span></span>
<span class="line"><span style="color:#A6ACCD;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">DatetimeIndex: 120 entries, 2018-10-08 to 2019-04-02</span></span>
<span class="line"><span style="color:#A6ACCD;">Data columns (total 7 columns):</span></span>
<span class="line"><span style="color:#A6ACCD;">High         120 non-null float64</span></span>
<span class="line"><span style="color:#A6ACCD;">Low          120 non-null float64</span></span>
<span class="line"><span style="color:#A6ACCD;">Open         120 non-null float64</span></span>
<span class="line"><span style="color:#A6ACCD;">Close        120 non-null float64</span></span>
<span class="line"><span style="color:#A6ACCD;">Volume       120 non-null int64</span></span>
<span class="line"><span style="color:#A6ACCD;">Adj Close    120 non-null float64</span></span>
<span class="line"><span style="color:#A6ACCD;">N1_High      99 non-null float64</span></span>
<span class="line"><span style="color:#A6ACCD;">dtypes: float64(6), int64(1)</span></span>
<span class="line"><span style="color:#A6ACCD;">memory usage: 7.5 KB</span></span>
<span class="line"><span style="color:#A6ACCD;">None</span></span>
<span class="line"><span style="color:#A6ACCD;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">print(df_stockload.head())</span></span>
<span class="line"><span style="color:#A6ACCD;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">            High  Low  Open   ...       Volume  Adj Close  N1_High</span></span>
<span class="line"><span style="color:#A6ACCD;">Date                          ...                                 </span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-08   7.3  7.1   7.2   ...      8108183        7.1      NaN</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-09   7.2  7.1   7.1   ...      4170580        7.1      NaN</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-10   7.1  7.0   7.1   ...      4653619        7.1      NaN</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-11   6.8  6.3   6.8   ...     16612288        6.3      NaN</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-12   6.3  5.7   6.3   ...     26829150        5.8      NaN</span></span>
<span class="line"><span style="color:#A6ACCD;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u7531\u4E8E\u4ECE\u7B2CN1\u5929\u5F00\u59CB\u6EDA\u52A8\u8BA1\u7B97\u8BE5\u5468\u671F\u5185\u6700\u5927\u503C\uFF0C\u56E0\u6B64\u524DN1\u4E2A\u6570\u503C\u90FD\u4E3A<code>NaN</code>\uFF0C\u6B64\u5904\u4ECE\u6536\u76D8\u4EF7\u5E8F\u5217\u7B2C\u4E00\u4E2A\u6570\u636E\u5F00\u59CB\u4F9D\u6B21\u5BFB\u627E\u5F53\u524D\u4E3A\u6B62\u7684\u6700\u5927\u503C\u6765\u586B\u5145\u524DN1\u4E2A<code>NaN</code>\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">expan_max = df_stockload.Close.expanding().max()</span></span>
<span class="line"><span style="color:#A6ACCD;">print(expan_max)</span></span>
<span class="line"><span style="color:#A6ACCD;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">Date</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-08     7.1</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-09     7.1</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-10     7.1</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-11     7.1</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-12     7.1</span></span>
<span class="line"><span style="color:#A6ACCD;">              ... </span></span>
<span class="line"><span style="color:#A6ACCD;">2019-03-27    10.7</span></span>
<span class="line"><span style="color:#A6ACCD;">2019-03-28    10.7</span></span>
<span class="line"><span style="color:#A6ACCD;">2019-03-29    10.7</span></span>
<span class="line"><span style="color:#A6ACCD;">2019-04-01    10.7</span></span>
<span class="line"><span style="color:#A6ACCD;">2019-04-02    10.7</span></span>
<span class="line"><span style="color:#A6ACCD;">Name: Close, Length: 120, dtype: float64</span></span>
<span class="line"><span style="color:#A6ACCD;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">df_stockload[&#39;N1_High&#39;].fillna(value=expan_max,inplace=True)#\u76EE\u524D\u51FA\u73B0\u8FC7\u7684\u6700\u5927\u503C\u586B\u5145\u524DN1\u4E2Anan</span></span>
<span class="line"><span style="color:#A6ACCD;">print(df_stockload.head())</span></span>
<span class="line"><span style="color:#A6ACCD;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">            High  Low  Open   ...       Volume  Adj Close  N1_High</span></span>
<span class="line"><span style="color:#A6ACCD;">Date                          ...                                 </span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-08   7.3  7.1   7.2   ...      8108183        7.1      7.1</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-09   7.2  7.1   7.1   ...      4170580        7.1      7.1</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-10   7.1  7.0   7.1   ...      4653619        7.1      7.1</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-11   6.8  6.3   6.8   ...     16612288        6.3      7.1</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-12   6.3  5.7   6.3   ...     26829150        5.8      7.1</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">[5 rows x 7 columns]</span></span>
<span class="line"><span style="color:#A6ACCD;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u540C\u7406\uFF0C\u8BA1\u7B97\u8BE5\u80A1N2\u65E5\u4EA4\u6613\u65E5\u7684\u6EDA\u52A8\u6700\u5C0F\u503C\u7C7B\u4F3C\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">df_stockload[&#39;N2_Low&#39;] = df_stockload.Low.rolling(window=N2).min()#\u8BA1\u7B97\u6700\u8FD1N2\u4E2A\u4EA4\u6613\u65E5\u6700\u4F4E\u4EF7</span></span>
<span class="line"><span style="color:#A6ACCD;">print(df_stockload.head())</span></span>
<span class="line"><span style="color:#A6ACCD;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">            High  Low  Open   ...    Adj Close  N1_High  N2_Low</span></span>
<span class="line"><span style="color:#A6ACCD;">Date                          ...                              </span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-08   7.3  7.1   7.2   ...          7.1      7.1     NaN</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-09   7.2  7.1   7.1   ...          7.1      7.1     NaN</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-10   7.1  7.0   7.1   ...          7.1      7.1     NaN</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-11   6.8  6.3   6.8   ...          6.3      7.1     NaN</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-12   6.3  5.7   6.3   ...          5.8      7.1     NaN</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">[5 rows x 8 columns]</span></span>
<span class="line"><span style="color:#A6ACCD;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">expan_min = df_stockload.Close.expanding().min()</span></span>
<span class="line"><span style="color:#A6ACCD;">df_stockload[&#39;N2_Low&#39;].fillna(value=expan_min,inplace=True)#\u76EE\u524D\u51FA\u73B0\u8FC7\u7684\u6700\u5C0F\u503C\u586B\u5145\u524DN2\u4E2Anan</span></span>
<span class="line"><span style="color:#A6ACCD;">print(df_stockload.head())</span></span>
<span class="line"><span style="color:#A6ACCD;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">            High  Low  Open   ...    Adj Close  N1_High  N2_Low</span></span>
<span class="line"><span style="color:#A6ACCD;">Date                          ...                              </span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-08   7.3  7.1   7.2   ...          7.1      7.1     7.1</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-09   7.2  7.1   7.1   ...          7.1      7.1     7.1</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-10   7.1  7.0   7.1   ...          7.1      7.1     7.1</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-11   6.8  6.3   6.8   ...          6.3      7.1     6.3</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-12   6.3  5.7   6.3   ...          5.8      7.1     5.8</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">[5 rows x 8 columns]</span></span>
<span class="line"><span style="color:#A6ACCD;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u6839\u636E\u7A81\u7834\u5B9A\u4E49\u6784\u5EFA\u4E70\u5356\u4FE1\u53F7\u3002\u5F53\u5929\u7684\u6536\u76D8\u4EF7\u8D85\u8FC7N1\u5929\u5185\u6700\u9AD8\u4EF7\u65F6\u7ED9\u51FA\u4E70\u5165\u80A1\u7968\u4FE1\u53F7\uFF0C\u5F53\u5929\u7684\u6536\u76D8\u4EF7\u8DCC\u7834N2\u5929\u5185\u6700\u4F4E\u4EF7\u65F6\u7ED9\u51FA\u5356\u51FA\u80A1\u7968\u4FE1\u53F7\u3002</p><p>\u63A5\u4E0B\u6765\u5BFB\u627E\u7B26\u5408\u4E70\u5165\u6761\u4EF6\u7684\u65F6\u95F4\u5E8F\u5217<code>buy_index</code>\uFF0C\u4EE5\u53CA\u7B26\u5408\u4E70\u51FA\u6761\u4EF6\u7684\u65F6\u95F4\u5E8F\u5217<code>sell_index</code>\uFF0C\u6211\u4EEC\u5DF2\u7ECF\u4ECB\u7ECD\u4E86Dataframe\u77E2\u91CF\u5316\u5904\u7406\u6570\u636E\u7684\u65B9\u5F0F\uFF0C\u6B64\u5904\u4EC5\u9700\u7B80\u5355\u7684\u51E0\u884C\u4EE3\u7801\u5C31\u53EF\u4EE5\u5B9E\u73B0\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">&quot;&quot;&quot; \u6536\u76D8\u4EF7\u8D85\u8FC7N1\u6700\u9AD8\u4EF7 \u4E70\u5165\u80A1\u7968\u6301\u6709&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">buy_index = stock_df[stock_df.Close &gt; stock_df.N1_High.shift(1)].index</span></span>
<span class="line"><span style="color:#A6ACCD;">print(buy_index)</span></span>
<span class="line"><span style="color:#A6ACCD;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">DatetimeIndex([&#39;2018-11-13&#39;, &#39;2018-11-15&#39;, &#39;2018-11-16&#39;, &#39;2019-02-25&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">               &#39;2019-03-05&#39;, &#39;2019-03-06&#39;, &#39;2019-03-07&#39;, &#39;2019-03-08&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">               &#39;2019-03-25&#39;],</span></span>
<span class="line"><span style="color:#A6ACCD;">              dtype=&#39;datetime64[ns]&#39;, name=&#39;Date&#39;, freq=None)</span></span>
<span class="line"><span style="color:#A6ACCD;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">&quot;&quot;&quot; \u6536\u76D8\u4EF7\u8D85\u8FC7N2\u6700\u4F4E\u4EF7 \u5356\u51FA\u80A1\u7968\u6301\u6709&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">sell_index = stock_df[stock_df.Close &lt; stock_df.N2_Low.shift(1)].index</span></span>
<span class="line"><span style="color:#A6ACCD;">print(sell_index)</span></span>
<span class="line"><span style="color:#A6ACCD;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">DatetimeIndex([&#39;2018-10-10&#39;, &#39;2018-10-11&#39;, &#39;2018-10-12&#39;, &#39;2018-10-15&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">               &#39;2018-10-16&#39;, &#39;2018-12-18&#39;, &#39;2018-12-25&#39;, &#39;2019-01-02&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">               &#39;2019-01-29&#39;, &#39;2019-01-31&#39;],</span></span>
<span class="line"><span style="color:#A6ACCD;">              dtype=&#39;datetime64[ns]&#39;, name=&#39;Date&#39;, freq=None)</span></span>
<span class="line"><span style="color:#A6ACCD;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u9700\u8981\u8BF4\u660E\u7684\u662F<code>shift(1)</code>\u7684\u4F5C\u7528\u662F\u5728index\u4E0D\u53D8\u7684\u60C5\u51B5\u4E0B\u5BF9\u5E8F\u5217\u7684\u503C\u5411\u53F3\u79FB\u52A8\u4E00\u4E2A\u5355\u4F4D\uFF0C\u8FD9\u4E48\u505A\u7684\u76EE\u7684\u662F\u83B7\u53D6\u6628\u5929\u4E3A\u6B62\u7684\u6700\u9AD8\u4EF7\u683C\uFF0C\u8868\u793A\u5F53\u65E5\u6536\u76D8\u4EF7\u7A81\u7834\u6628\u65E5\u4E3A\u6B62\u6700\u9AD8\u4EF7\u683C\u65F6\u4E70\u5165\u80A1\u7968\u3002\u5BFB\u627E\u5230\u7B26\u5408\u4E70\u5165/\u5356\u51FA\u6761\u4EF6\u7684\u65F6\u95F4\u5E8F\u5217\u540E\uFF0C\u4EE5\u8BE5\u65F6\u95F4\u5E8F\u5217\u6784\u5EFA<code>signal</code>\u5E8F\u5217\uFF0C\u5C06\u4E70\u5165\u5F53\u5929\u7684<code>signal</code>\u503C\u8BBE\u7F6E\u4E3A1\uFF0C\u4EE3\u8868\u4E70\u5165\uFF0C\u540C\u7406\u5C06<code>signal</code>\u8BBE\u7F6E\u4E3A0\uFF0C\u4EE3\u8868\u5356\u51FA\u3002\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">stock_df.loc[buy_index,&#39;signal&#39;] = 1 </span></span>
<span class="line"><span style="color:#A6ACCD;">stock_df.loc[sell_index,&#39;signal&#39;] = 0</span></span>
<span class="line"><span style="color:#A6ACCD;">print(df_stockload.signal)</span></span>
<span class="line"><span style="color:#A6ACCD;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">Date</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-08    NaN</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-09    NaN</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-10    0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-11    0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-12    0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">             ... </span></span>
<span class="line"><span style="color:#A6ACCD;">2019-03-27    NaN</span></span>
<span class="line"><span style="color:#A6ACCD;">2019-03-28    NaN</span></span>
<span class="line"><span style="color:#A6ACCD;">2019-03-29    NaN</span></span>
<span class="line"><span style="color:#A6ACCD;">2019-04-01    NaN</span></span>
<span class="line"><span style="color:#A6ACCD;">2019-04-02    NaN</span></span>
<span class="line"><span style="color:#A6ACCD;">Name: signal, Length: 120, dtype: float64</span></span>
<span class="line"><span style="color:#A6ACCD;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u4E0A\u8FF0\u65B0\u6DFB\u52A0\u7684\u65B0\u5217<code>signal</code>\u4EE3\u8868\u4FE1\u53F7\u89E6\u53D1\u7684\u4E70\u5356\u4FE1\u53F7\uFF0C\u672C\u5C0F\u8282\u672A\u6D89\u53CA\u4ED3\u4F4D\u7BA1\u7406\u7684\u65B9\u6CD5\uFF0C\u6B64\u5904\u8BBE\u5B9A\u4E3A\u4E00\u65E6\u4E70\u5165\u4FE1\u53F7\u89E6\u53D1\u5219\u5168\u4ED3\u4E70\u5165\uFF0C\u4E00\u65E6\u5356\u51FA\u4FE1\u53F7\u89E6\u53D1\u5219\u5168\u4ED3\u5356\u51FA\u3002\u5728\u7B2C\u4E00\u4E2A\u4FE1\u53F7\u89E6\u53D1\u540E\uFF0C\u7531\u4E8E\u662F\u5168\u4ED3\u4E70\u5165\u6216\u5168\u4ED3\u5356\u51FA\uFF0C\u5373\u4F7F\u540E\u7EED\u4ECD\u6709\u4FE1\u53F7\u53D1\u51FA\u4E5F\u4E0D\u6267\u884C\uFF0C\u4E5F\u5C31\u662F\u8BF4\u8FDE\u7EED\u7684\u4FE1\u53F7\u53EA\u6709\u7B2C\u4E00\u4E2A\u6709\u5B9E\u9645\u7684\u64CD\u4F5C\u610F\u4E49\u3002</p><p>\u6211\u4EEC\u770B\u5230<code>signal</code>\u5E8F\u5217\u542B\u6709<code>NaN</code>\u503C\uFF0C\u6B64\u5904\u4F7F\u7528<code>fillna()</code>\u65B9\u6CD5\u5C06\u6240\u6709<code>NaN</code>\u503C\u4E0E\u524D\u9762\u5143\u7D20\u503C\u4FDD\u6301\u4E00\u81F4\uFF0C\u8FD9\u6837\u7B26\u5408\u4E00\u65E6\u72B6\u6001\u88AB\u8BBE\u7F6E\u4E3A1\uFF08\u4E70\u5165\u6301\u6709\uFF09\uFF0C\u53EA\u6709\u9047\u52300\uFF08\u5356\u51FA\u7A7A\u4ED3\uFF09\u65F6<code>signal</code>\u72B6\u6001\u624D\u4F1A\u6539\u53D8\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">df_stockload[&#39;signal&#39;].fillna(method = &#39;ffill&#39;,inplace = True)</span></span>
<span class="line"><span style="color:#A6ACCD;">print(df_stockload.signal)</span></span>
<span class="line"><span style="color:#A6ACCD;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">Date</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-08    NaN</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-09    NaN</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-10    0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-11    0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-12    0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">             ... </span></span>
<span class="line"><span style="color:#A6ACCD;">2019-03-27    1.0</span></span>
<span class="line"><span style="color:#A6ACCD;">2019-03-28    1.0</span></span>
<span class="line"><span style="color:#A6ACCD;">2019-03-29    1.0</span></span>
<span class="line"><span style="color:#A6ACCD;">2019-04-01    1.0</span></span>
<span class="line"><span style="color:#A6ACCD;">2019-04-02    1.0</span></span>
<span class="line"><span style="color:#A6ACCD;">Name: signal, Length: 120, dtype: float64</span></span>
<span class="line"><span style="color:#A6ACCD;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u7531\u4E8E\u6536\u76D8\u4EF7\u683C\u662F\u5728\u6536\u76D8\u540E\u624D\u786E\u5B9A\uFF0C\u90A3\u4E48\u7B2C\u4E8C\u5929\u624D\u80FD\u6267\u884C\u7ED9\u51FA\u7684\u4E70\u5356\u64CD\u4F5C\uFF0C\u6B64\u5904\u5C06<code>signal</code>\u5E8F\u5217\u4F7F\u7528<code>shift(1)</code>\u65B9\u6CD5\u53F3\u79FB\u66F4\u63A5\u8FD1\u771F\u5B9E\u60C5\u51B5\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">df_stockload[&#39;signal&#39;] = df_stockload.signal.shift(1)</span></span>
<span class="line"><span style="color:#A6ACCD;">print(df_stockload.signal)</span></span>
<span class="line"><span style="color:#A6ACCD;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">Date</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-08    NaN</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-09    NaN</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-10    NaN</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-11    0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-12    0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">             ... </span></span>
<span class="line"><span style="color:#A6ACCD;">2019-03-27    1.0</span></span>
<span class="line"><span style="color:#A6ACCD;">2019-03-28    1.0</span></span>
<span class="line"><span style="color:#A6ACCD;">2019-03-29    1.0</span></span>
<span class="line"><span style="color:#A6ACCD;">2019-04-01    1.0</span></span>
<span class="line"><span style="color:#A6ACCD;">2019-04-02    1.0</span></span>
<span class="line"><span style="color:#A6ACCD;">Name: signal, Length: 120, dtype: float64</span></span>
<span class="line"><span style="color:#A6ACCD;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u4EE5\u4E0A\u867D\u7136\u4F7F\u7528<code>fillna()</code>\u65B9\u6CD5\u5C06\u6240\u6709NaN\u503C\u4E0E\u4E0A\u4E00\u4E2A\u5143\u7D20\u503C\u4FDD\u6301\u4E00\u81F4\uFF0C\u5BF9\u4E8Esignal\u5E8F\u5217\u6700\u524D\u9762\u51E0\u4E2A\u503C\u4E3ANaN\u503C\u65F6\u5E76\u4E0D\u8D77\u4F5C\u7528\uFF0C\u6B64\u65F6\u9700\u8981\u518D\u4E00\u6B21\u4F7F\u7528<code>fillna()</code>\u65B9\u6CD5\uFF0C\u9009\u62E9\u75280\u503C\u586B\u5145\u5E8F\u5217\u6700\u524D\u9762\u51E0\u4E2ANaN\u503C\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">df_stockload[&#39;signal&#39;].fillna(value=0, inplace=True)</span></span>
<span class="line"><span style="color:#A6ACCD;">print(df_stockload.signal)</span></span>
<span class="line"><span style="color:#A6ACCD;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">Date</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-08    0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-09    0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-10    0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-11    0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">2018-10-12    0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">             ... </span></span>
<span class="line"><span style="color:#A6ACCD;">2019-03-27    1.0</span></span>
<span class="line"><span style="color:#A6ACCD;">2019-03-28    1.0</span></span>
<span class="line"><span style="color:#A6ACCD;">2019-03-29    1.0</span></span>
<span class="line"><span style="color:#A6ACCD;">2019-04-01    1.0</span></span>
<span class="line"><span style="color:#A6ACCD;">2019-04-02    1.0</span></span>
<span class="line"><span style="color:#A6ACCD;">Name: signal, Length: 120, dtype: float64</span></span>
<span class="line"><span style="color:#A6ACCD;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><h2 id="\u4E70\u5356\u4FE1\u53F7\u533A\u95F4\u53EF\u89C6\u5316" tabindex="-1">\u4E70\u5356\u4FE1\u53F7\u533A\u95F4\u53EF\u89C6\u5316 <a class="header-anchor" href="#\u4E70\u5356\u4FE1\u53F7\u533A\u95F4\u53EF\u89C6\u5316" aria-hidden="true">#</a></h2><p>\u4EE5N\u65E5\u7A81\u7834\u62E9\u65F6\u7B56\u7565\u5F97\u5230\u4E86\u4E70\u5356\u4FE1\u53F7\u540E\uFF0C\u6211\u4EEC\u63A5\u4E0B\u6765\u5C06\u8FD9\u4E9B\u4FE1\u53F7\u4EE5\u53EF\u89C6\u5316\u65B9\u5F0F\u5448\u73B0\u3002\u53EF\u89C6\u5316\u7684\u5185\u5BB9\u5305\u62EC\uFF1A\u5C06\u4E70\u5356\u6301\u6709\u533A\u95F4\u4EE5\u76C8\u4E8F\u72B6\u6001\u586B\u5145\u989C\u8272\uFF1B\u5C06\u4E70\u5356\u4FE1\u53F7\u6807\u6CE8\u5728\u80A1\u7968\u8D70\u52BF\u56FE\u4E2D\u3002</p><p>\u5C06\u4E70\u5356\u6301\u6709\u533A\u95F4\u4EE5\u76C8\u4E8F\u72B6\u6001\u586B\u5145\u989C\u8272\u3002\u4F7F\u7528<code>matplotlib.pyplot</code>\u6A21\u5757\u7684<code>fill_between()</code>\u65B9\u6CD5\u53EF\u586B\u5145\u540C\u4E00\u4E2A\u5750\u6807\u8F74\u4E0B\u7684\u4E24\u4E2A\u66F2\u7EBF\u51FD\u6570\u4E4B\u95F4\u7684\u533A\u57DF\uFF0C\u6B64\u5904\u5373\u6536\u76D8\u4EF7\u66F2\u7EBF\u548Cx\u5750\u6807\u8F74\u4E4B\u95F4\u7684\u533A\u57DF\uFF0C\u53C2\u6570<code>alpha</code>\u4E3A\u5E95\u8272\u7684\u900F\u660E\u5EA6\u8BBE\u7F6E\u3002\u5F53\u4E70\u5165\u65F6\u7684\u6536\u76D8\u4EF7\u683C\u9AD8\u4E8E\u5356\u51FA\u65F6\u4E3A\u7EFF\u8272\uFF0C\u8868\u793A\u4E8F\u94B1\uFF0C\u53CD\u4E4B\u4E3A\u7EA2\u8272\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">if df_stockload.Close[end] &lt; df_stockload.Close[start]:  # \u8D54\u94B1\u663E\u793A\u7EFF\u8272</span></span>
<span class="line"><span style="color:#A6ACCD;">    plt.fill_between(df_stockload.index[start:end], 0, df_stockload.Close[start:end], color=&#39;green&#39;, alpha=0.38)</span></span>
<span class="line"><span style="color:#A6ACCD;">else:  # \u8D5A\u94B1\u663E\u793A\u7EA2\u8272</span></span>
<span class="line"><span style="color:#A6ACCD;">    plt.fill_between(df_stockload.index[start:end], 0, df_stockload.Close[start:end], color=&#39;red&#39;, alpha=0.38)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u5C06\u4E70\u5356\u4FE1\u53F7\u6807\u6CE8\u5728\u80A1\u7968\u8D70\u52BF\u56FE\u4E2D\u3002\u4F7F\u7528matplotlib.pyplot\u6A21\u5757\u7684<code>annotate()</code>\u65B9\u6CD5\u53EF\u5728\u56FE\u8868\u4E0A\u6DFB\u52A0\u6CE8\u91CA\uFF0C\u53C2\u6570<code>xy(x, y)</code>\u4E3A\u88AB\u6CE8\u91CA\u70B9\u7684\u5750\u6807\uFF0C\u53C2\u6570<code>xytext(x, y)</code>\u4E3A\u63D2\u5165\u6587\u672C\u7684\u5750\u6807\uFF0C\u53C2\u6570<code>arrowprops</code>\u662F\u4EE5\u5B57\u5178\u5F62\u5F0F\u8BBE\u7F6E\u7BAD\u5934\u7684\u5C5E\u6027\uFF0C\u53C2\u6570<code>verticalalignment</code>\u8868\u793A\u5B57\u4F53\u5782\u76F4\u5BF9\u9F50\u65B9\u5F0F\uFF0C<code>horizontalalignment</code>\u53C2\u6570\u8868\u793A\u5B57\u4F53\u6C34\u5E73\u5BF9\u9F50\u65B9\u5F0F\uFF0C\u5176\u4ED6\u8FD8\u6709\u591A\u4E2A\u53C2\u6570\u53EF\u6839\u636E\u663E\u793A\u8981\u6C42\u8BBE\u7F6E\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">plt.annotate(&#39;\u4E70\u5165&#39;,xy=(kl_index,df_stockload.Close.asof(kl_index)),xytext=(kl_index, df_stockload.Close.asof(kl_index)+2),arrowprops=dict(facecolor=&#39;r&#39;,shrink=0.1),horizontalalignment=&#39;left&#39;,verticalalignment=&#39;top&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">plt.annotate(&#39;\u5356\u51FA&#39;,xy=(kl_index,df_stockload.Close.asof(kl_index)),xytext=(kl_index, df_stockload.Close.asof(kl_index)+2),arrowprops=dict(facecolor=&#39;g&#39;,shrink=0.1),horizontalalignment=&#39;left&#39;,verticalalignment=&#39;top&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u6211\u4EEC\u5C06\u80A1\u7968\u4EA4\u6613\u6570\u636E\u7684\u83B7\u53D6\u548C\u5904\u7406\u90E8\u5206\u7684\u4EE3\u7801\u5C01\u88C5\u4E3A\u51FD\u6570\u5F62\u5F0F\uFF0C\u5C06\u80A1\u7968\u4EE3\u7801\u3001\u80A1\u7968\u6570\u636E\u8D77\u59CB\u65F6\u95F4\u3001N1\u3001N2\u4F5C\u4E3A\u53C2\u6570\u4F20\u5165\u8BE5\u51FD\u6570\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">#\u80A1\u7968\u6570\u636E\u83B7\u53D6\u53CA\u5904\u7406\u63A5\u53E3</span></span>
<span class="line"><span style="color:#A6ACCD;">def GetStockDatApi(stockName=None,stockTimeS=None,stockTimeE=None, N1=15,N2=5):</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    stockdata = web.DataReader(stockName, &quot;yahoo&quot;, stockTimeS, stockTimeE)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    stockdata[&#39;N1_High&#39;] = stockdata.High.rolling(window=N1).max()#\u8BA1\u7B97\u6700\u8FD1N1\u4E2A\u4EA4\u6613\u65E5\u6700\u9AD8\u4EF7</span></span>
<span class="line"><span style="color:#A6ACCD;">    expan_max = stockdata.Close.expanding().max()</span></span>
<span class="line"><span style="color:#A6ACCD;">    stockdata[&#39;N1_High&#39;].fillna(value=expan_max,inplace=True)#\u76EE\u524D\u51FA\u73B0\u8FC7\u7684\u6700\u5927\u503C\u586B\u5145\u524DN1\u4E2Anan</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    stockdata[&#39;N2_Low&#39;] = stockdata.Low.rolling(window=N2).min()#\u8BA1\u7B97\u6700\u8FD1N2\u4E2A\u4EA4\u6613\u65E5\u6700\u4F4E\u4EF7</span></span>
<span class="line"><span style="color:#A6ACCD;">    expan_min = stockdata.Close.expanding().min()</span></span>
<span class="line"><span style="color:#A6ACCD;">    stockdata[&#39;N2_Low&#39;].fillna(value=expan_min,inplace=True)#\u76EE\u524D\u51FA\u73B0\u8FC7\u7684\u6700\u5C0F\u503C\u586B\u5145\u524DN2\u4E2Anan</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    #\u6536\u76D8\u4EF7\u8D85\u8FC7N1\u6700\u9AD8\u4EF7 \u4E70\u5165\u80A1\u7968\u6301\u6709</span></span>
<span class="line"><span style="color:#A6ACCD;">    buy_index = stockdata[stockdata.Close &gt; stockdata.N1_High.shift(1)].index</span></span>
<span class="line"><span style="color:#A6ACCD;">    stockdata.loc[buy_index,&#39;signal&#39;] = 1</span></span>
<span class="line"><span style="color:#A6ACCD;">    #\u6536\u76D8\u4EF7\u8D85\u8FC7N2\u6700\u4F4E\u4EF7 \u5356\u51FA\u80A1\u7968\u6301\u6709</span></span>
<span class="line"><span style="color:#A6ACCD;">    sell_index = stockdata[stockdata.Close &lt; stockdata.N2_Low.shift(1)].index</span></span>
<span class="line"><span style="color:#A6ACCD;">    stockdata.loc[sell_index,&#39;signal&#39;] = 0</span></span>
<span class="line"><span style="color:#A6ACCD;">    stockdata[&#39;signal&#39;].fillna(method = &#39;ffill&#39;,inplace = True)</span></span>
<span class="line"><span style="color:#A6ACCD;">    stockdata[&#39;signal&#39;] = stockdata.signal.shift(1)</span></span>
<span class="line"><span style="color:#A6ACCD;">    stockdata[&#39;signal&#39;].fillna(method = &#39;bfill&#39;,inplace = True)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    return stockdata</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u63A5\u4E0B\u6765\u904D\u5386<code>signal</code>\u5E8F\u5217\uFF0C\u5F53\u7B26\u5408\u4E70\u5165/\u5356\u51FA\u64CD\u4F5C\u65F6\uFF0C\u4F7F\u7528<code>matplotlib.pyplot</code>\u6A21\u5757\u7ED8\u5236\u4E70\u5165/\u5356\u51FA\u4FE1\u53F7\u53CA\u76C8\u4E8F\u72B6\u6001\u3002\u4E3A\u4E86\u907F\u514D\u5728\u672A\u4E70\u5165\u80A1\u7968\u524D\u63D0\u4E0B\u8BEF\u6267\u884C\u5356\u51FA\u80A1\u7968\u64CD\u4F5C\uFF0C\u6B64\u5904<code>skip_days</code>\u53D8\u91CF\u6307\u793A\u6301\u80A1/\u6301\u5E01\u7684\u72B6\u6001\u3002\u5B8C\u6574\u4EE3\u7801\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">import pandas_datareader.data as web</span></span>
<span class="line"><span style="color:#A6ACCD;">import pandas as pd</span></span>
<span class="line"><span style="color:#A6ACCD;">import numpy as np</span></span>
<span class="line"><span style="color:#A6ACCD;">import datetime</span></span>
<span class="line"><span style="color:#A6ACCD;">import matplotlib.pyplot as plt</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"># N\u65E5\u7A81\u7834\u4E70\u5356\u4FE1\u53F7\u533A\u95F4\u663E\u793A</span></span>
<span class="line"><span style="color:#A6ACCD;">skip_days = 0</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">df_stockload = GetStockDatApi(&quot;600410.SS&quot;,datetime.datetime(2018, 10, 1), datetime.datetime(2019, 4, 1))</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">print(df_stockload)</span></span>
<span class="line"><span style="color:#A6ACCD;">df_stockload.Close.plot()</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">for kl_index, today in df_stockload.iterrows():</span></span>
<span class="line"><span style="color:#A6ACCD;">    if today.signal == 1 and skip_days == 0:  # \u4E70\u5165</span></span>
<span class="line"><span style="color:#A6ACCD;">        skip_days = -1</span></span>
<span class="line"><span style="color:#A6ACCD;">        start = df_stockload.index.get_loc(kl_index)</span></span>
<span class="line"><span style="color:#A6ACCD;">        plt.annotate(&#39;\u4E70\u5165&#39;,xy=(kl_index,df_stockload.Close.asof(kl_index)),xytext=(kl_index, df_stockload.Close.asof(kl_index)+2),arrowprops=dict(facecolor=&#39;r&#39;,shrink=0.1),horizontalalignment=&#39;left&#39;,verticalalignment=&#39;top&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">        print(&quot;buy:&quot;,kl_index)</span></span>
<span class="line"><span style="color:#A6ACCD;">    elif today.signal == 0 and skip_days == -1:  # \u5356\u51FA</span></span>
<span class="line"><span style="color:#A6ACCD;">        skip_days = 0</span></span>
<span class="line"><span style="color:#A6ACCD;">        end = df_stockload.index.get_loc(kl_index)</span></span>
<span class="line"><span style="color:#A6ACCD;">        if df_stockload.Close[end] &lt; df_stockload.Close[start]:  # \u8D54\u94B1\u663E\u793A\u7EFF\u8272</span></span>
<span class="line"><span style="color:#A6ACCD;">            plt.fill_between(df_stockload.index[start:end], 0, df_stockload.Close[start:end], color=&#39;green&#39;, alpha=0.38)</span></span>
<span class="line"><span style="color:#A6ACCD;">        else:  # \u8D5A\u94B1\u663E\u793A\u7EA2\u8272</span></span>
<span class="line"><span style="color:#A6ACCD;">            plt.fill_between(df_stockload.index[start:end], 0, df_stockload.Close[start:end], color=&#39;red&#39;, alpha=0.38)</span></span>
<span class="line"><span style="color:#A6ACCD;">        plt.annotate(&#39;\u5356\u51FA&#39;,xy=(kl_index,df_stockload.Close.asof(kl_index)),xytext=(kl_index+datetime.timedelta(days=5), df_stockload.Close.asof(kl_index)+2),arrowprops=dict(facecolor=&#39;g&#39;,shrink=0.1),horizontalalignment=&#39;left&#39;,verticalalignment=&#39;top&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">        print(&quot;sell:&quot;,kl_index)</span></span>
<span class="line"><span style="color:#A6ACCD;">plt.legend(loc=&#39;best&#39;)</span></span>
<span class="line"><span style="color:#A6ACCD;">plt.title(u&quot;\u534E\u80DC\u5929\u6210 N\u65E5\u7A81\u7834\u62E9\u65F6&quot;)</span></span>
<span class="line"><span style="color:#A6ACCD;">plt.show()</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">#\u4E70/\u5356\u65F6\u95F4</span></span>
<span class="line"><span style="color:#A6ACCD;">buy: 2018-11-07 00:00:00</span></span>
<span class="line"><span style="color:#A6ACCD;">sell: 2018-11-26 00:00:00</span></span>
<span class="line"><span style="color:#A6ACCD;">buy: 2019-01-17 00:00:00</span></span>
<span class="line"><span style="color:#A6ACCD;">sell: 2019-01-22 00:00:00</span></span>
<span class="line"><span style="color:#A6ACCD;">buy: 2019-02-19 00:00:00</span></span>
<span class="line"><span style="color:#A6ACCD;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u4E70\u5356\u4FE1\u53F7\u533A\u95F4\u7684\u53EF\u89C6\u5316\u6548\u679C\u5982\u4E0B\u56FE\u6240\u793A\uFF0C\u4ECE\u56FE\u4E2D\u53EF\u83B7\u6089\u4E00\u6B21\u4EA4\u6613\u4E3A\u76C8\u5229\u72B6\u6001\uFF0C\u7B2C\u4E8C\u6B21\u4EA4\u6613\u4E3A\u4E8F\u635F\uFF0C\u7B2C\u4E09\u6B21\u6267\u884C\u4E86\u4E70\u5165\u64CD\u4F5C\uFF0C\u76EE\u524D\u4ECD\u4E3A\u6301\u80A1\u72B6\u6001\u3002</p><p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/4/11/16a0a32aea2a4d23~tplv-t2oaga2asx-image.image" alt=""></p><h2 id="\u603B\u7ED3" tabindex="-1">\u603B\u7ED3 <a class="header-anchor" href="#\u603B\u7ED3" aria-hidden="true">#</a></h2><p>\u672C\u5C0F\u8282\u4ECB\u7ECD\u4E86N\u65E5\u7A81\u7834\u62E9\u65F6\u7B56\u7565\u7684\u5B9E\u73B0\uFF0C\u9700\u8981\u8BF4\u660E\u7684\u662F\u8BE5\u7B56\u7565\u4E2D\u5E76\u672A\u8003\u8651\u98CE\u9669\u56E0\u7D20\u3001\u8BBE\u5B9A\u6B62\u635F\u673A\u5236\u3001\u4ED3\u4F4D\u5206\u914D\u673A\u5236\uFF0C\u5E76\u4E14\u4E5F\u5FFD\u7565\u4E86\u624B\u7EED\u8D39\uFF0C\u4EC5\u4F5C\u4E3A\u5165\u95E8\u7814\u7A76\u53C2\u8003\uFF0C\u65E8\u5728\u4F7F\u540C\u5B66\u4EEC\u5BF9\u62E9\u65F6\u7B56\u7565\u6709\u6240\u7406\u89E3\u548C\u8BA4\u8BC6\u3002\u4ECE\u4E70\u5356\u4FE1\u53F7\u533A\u95F4\u7684\u53EF\u89C6\u5316\u6548\u679C\u4E0A\u770B\uFF0C\u4EC5\u4EC5\u4F9D\u9760\u62E9\u65F6\u7B56\u7565\u5C55\u5F00\u91CF\u5316\u4EA4\u6613\u662F\u8FDC\u8FDC\u4E0D\u591F\u7684\uFF0C\u540E\u7EED\u5185\u5BB9\u4E2D\u6211\u4EEC\u4F1A\u4E00\u6B65\u4E00\u6B65\u5730\u5B8C\u5584\u91CF\u5316\u4EA4\u6613\u7B56\u7565\u7684\u673A\u5236\u3002</p><p>\u6700\u540E\uFF0C\u7ED9\u5927\u5BB6\u7559\u4E00\u9053\u601D\u8003\u9898\uFF1A</p><p>\u6BCF\u79CD\u4EA4\u6613\u7B56\u7565\u6709\u5B83\u7684\u4F18\u70B9\u548C\u7F3A\u9677\uFF0C\u6709\u5B83\u6240\u9002\u5408\u53D1\u6325\u7684\u5E94\u7528\u573A\u666F\uFF0C\u5927\u5BB6\u8BA4\u4E3AN\u65E5\u7A81\u7834\u62E9\u65F6\u7B56\u7565\u6709\u54EA\u4E9B\u4F18\u7F3A\u70B9\u5462\uFF1F\u5B83\u66F4\u9002\u5408\u5728\u90A3\u7C7B\u884C\u60C5\u4E2D\u4F7F\u7528\u5462\uFF1F</p><p>\u6B22\u8FCE\u5927\u5BB6\u5728\u7559\u8A00\u533A\u7559\u8A00\uFF0C\u6211\u4EEC\u4E00\u8D77\u8BA8\u8BBA\u3002</p>`,49),e=[o];function c(t,i,C,A,r,d){return a(),n("div",null,e)}const u=s(p,[["render",c]]);export{D as __pageData,u as default};
