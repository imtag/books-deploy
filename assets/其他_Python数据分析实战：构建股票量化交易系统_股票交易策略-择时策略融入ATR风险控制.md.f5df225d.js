import{_ as s,c as a,o as n,d as l}from"./app.c4f45da1.js";const _=JSON.parse('{"title":"\u80A1\u7968\u4EA4\u6613\u7B56\u7565-\u62E9\u65F6\u7B56\u7565\u878D\u5165ATR\u98CE\u9669\u63A7\u5236","description":"","frontmatter":{},"headers":[{"level":2,"title":"\u524D\u8A00","slug":"\u524D\u8A00","link":"#\u524D\u8A00","children":[]},{"level":2,"title":"ATR\u6307\u6807\u7684\u5B9E\u73B0","slug":"atr\u6307\u6807\u7684\u5B9E\u73B0","link":"#atr\u6307\u6807\u7684\u5B9E\u73B0","children":[]},{"level":2,"title":"\u6B62\u76C8\u6B62\u635F\u7684\u5B9E\u73B0","slug":"\u6B62\u76C8\u6B62\u635F\u7684\u5B9E\u73B0","link":"#\u6B62\u76C8\u6B62\u635F\u7684\u5B9E\u73B0","children":[]},{"level":2,"title":"\u603B\u7ED3","slug":"\u603B\u7ED3","link":"#\u603B\u7ED3","children":[]}],"relativePath":"\u5176\u4ED6/Python\u6570\u636E\u5206\u6790\u5B9E\u6218\uFF1A\u6784\u5EFA\u80A1\u7968\u91CF\u5316\u4EA4\u6613\u7CFB\u7EDF/\u80A1\u7968\u4EA4\u6613\u7B56\u7565-\u62E9\u65F6\u7B56\u7565\u878D\u5165ATR\u98CE\u9669\u63A7\u5236.md"}'),p={name:"\u5176\u4ED6/Python\u6570\u636E\u5206\u6790\u5B9E\u6218\uFF1A\u6784\u5EFA\u80A1\u7968\u91CF\u5316\u4EA4\u6613\u7CFB\u7EDF/\u80A1\u7968\u4EA4\u6613\u7B56\u7565-\u62E9\u65F6\u7B56\u7565\u878D\u5165ATR\u98CE\u9669\u63A7\u5236.md"},e=l(`<h1 id="\u80A1\u7968\u4EA4\u6613\u7B56\u7565-\u62E9\u65F6\u7B56\u7565\u878D\u5165atr\u98CE\u9669\u63A7\u5236" tabindex="-1">\u80A1\u7968\u4EA4\u6613\u7B56\u7565-\u62E9\u65F6\u7B56\u7565\u878D\u5165ATR\u98CE\u9669\u63A7\u5236 <a class="header-anchor" href="#\u80A1\u7968\u4EA4\u6613\u7B56\u7565-\u62E9\u65F6\u7B56\u7565\u878D\u5165atr\u98CE\u9669\u63A7\u5236" aria-hidden="true">#</a></h1><hr><h1 id="\u80A1\u7968\u4EA4\u6613\u7B56\u7565\uFF1A\u62E9\u65F6\u7B56\u7565\u878D\u5165atr\u98CE\u9669\u7BA1\u7406" tabindex="-1">\u80A1\u7968\u4EA4\u6613\u7B56\u7565\uFF1A\u62E9\u65F6\u7B56\u7565\u878D\u5165ATR\u98CE\u9669\u7BA1\u7406 <a class="header-anchor" href="#\u80A1\u7968\u4EA4\u6613\u7B56\u7565\uFF1A\u62E9\u65F6\u7B56\u7565\u878D\u5165atr\u98CE\u9669\u7BA1\u7406" aria-hidden="true">#</a></h1><h2 id="\u524D\u8A00" tabindex="-1">\u524D\u8A00 <a class="header-anchor" href="#\u524D\u8A00" aria-hidden="true">#</a></h2><p>N\u65E5\u7A81\u7834\u62E9\u65F6\u7B56\u7565\u7684\u6838\u5FC3\u601D\u60F3\u4E3A\uFF1A\u5F53\u5929\u6536\u76D8\u4EF7\u8D85\u8FC7N1\u5929\u5185\u6700\u9AD8\u4EF7\u8BA4\u4E3A\u4E0A\u5347\u8D8B\u52BF\u6210\u7ACB\uFF0C\u4F5C\u4E3A\u4E70\u5165\u4FE1\u53F7\uFF1B\u5F53\u5929\u6536\u76D8\u4EF7\u4F4E\u4E8EN2\u5929\u5185\u6700\u4F4E\u4EF7\u683C\u8BA4\u4E3A\u4E0B\u8DCC\u8D8B\u52BF\u6210\u7ACB\uFF0C\u4F5C\u4E3A\u5356\u51FA\u4FE1\u53F7\u3002</p><p>\u6211\u4EEC\u53D1\u73B0\u8BE5\u7B56\u7565\u5B58\u5728\u7684\u95EE\u9898\u662F\uFF1A\u5F53\u4E70\u5165\u80A1\u7968\u540E\uFF0C\u5728\u4E0A\u6DA8\u8D8B\u52BF\u65F6\u5E76\u4E0D\u4F1A\u51FA\u73B0\u5356\u70B9\uFF0C\u800C\u662F\u5F53\u4E0B\u8DCC\u8D8B\u52BF\u6210\u7ACB\u540E\u624D\u51FA\u73B0\u5356\u70B9\uFF0C\u6B64\u65F6\u5DF2\u7ECF\u56DE\u64A4\u4E86\u8F83\u5927\u90E8\u5206\u76C8\u5229\uFF1B\u5F53\u7B56\u7565\u5224\u65AD\u9519\u8BEF\u800C\u7ED9\u51FA\u4E70\u5165\u4FE1\u53F7\u65F6\uFF0C\u80A1\u4EF7\u51FA\u73B0\u4E0D\u65AD\u4E0B\u8DCC\u7684\u8D70\u52BF\uFF0C\u5982\u679C\u76F4\u5230\u7B56\u7565\u7ED9\u51FA\u5356\u70B9\u4FE1\u53F7\u624D\u5356\u51FA\u80A1\u7968\uFF0C\u6B64\u65F6\u5DF2\u7ECF\u4E8F\u635F\u8F83\u591A\u8D44\u91D1\u3002</p><p>\u901A\u5E38\u4EA4\u6613\u7B56\u7565\u4E2D\u4F1A\u878D\u5165\u591A\u4E2A\u56E0\u5B50\u534F\u540C\u89E6\u53D1\u4FE1\u53F7\uFF0C\u672C\u5C0F\u8282\u5728N\u65E5\u7A81\u7834\u62E9\u65F6\u7B56\u7565\u7684\u57FA\u7840\u4E0A\u5F15\u5165\u98CE\u9669\u7BA1\u7406\u56E0\u5B50\u3002\u8BE5\u56E0\u5B50\u91C7\u7528\u6B62\u76C8\u6B62\u635F\u673A\u5236\u6765\u7BA1\u7406\u53EF\u80FD\u51FA\u73B0\u7684\u98CE\u9669\uFF0CATR\u6307\u6807\u5219\u4F5C\u4E3A\u6B62\u76C8\u6B62\u635F\u7684\u57FA\u51C6\u503C\u3002</p><h2 id="atr\u6307\u6807\u7684\u5B9E\u73B0" tabindex="-1">ATR\u6307\u6807\u7684\u5B9E\u73B0 <a class="header-anchor" href="#atr\u6307\u6807\u7684\u5B9E\u73B0" aria-hidden="true">#</a></h2><p>\u6280\u672F\u6307\u6807\u5927\u4F53\u5206\u4E3A\u8D8B\u52BF\u578B\u548C\u9707\u8361\u578B\u4E24\u7C7B\u3002N\u65E5\u7A81\u7834\u3001\u5747\u7EBF\u7A81\u7834\u5C5E\u4E8E\u8D8B\u52BF\u578B\u6307\u6807\uFF0C\u8D8B\u52BF\u578B\u6307\u6807\u80CC\u540E\u903B\u8F91\u662F\u5047\u8BBE\u4E4B\u524D\u4EF7\u683C\u4E0A\u6DA8\u9884\u793A\u7740\u4E4B\u540E\u4E00\u6BB5\u65F6\u95F4\u5185\u4ECD\u7136\u4F1A\u4E0A\u6DA8\u3002\u800C\u9707\u8361\u578B\u6307\u6807\u4FA7\u91CD\u4E8E\u6CE2\u52A8\u5E45\u5EA6\u7684\u5206\u6790\uFF0C\u6BD4\u5982\u4E4B\u524D\u4ECB\u7ECD\u7684KDJ\u6307\u6807\uFF0C\u672C\u5C0F\u8282\u4ECB\u7ECD\u7684ATR\u6307\u6807\u4E5F\u5C5E\u4E8E\u9707\u8361\u578B\u6307\u6807\u3002</p><p>ATR\uFF08Average True Range\uFF09\u53C8\u79F0\u5E73\u5747\u771F\u5B9E\u6CE2\u52A8\u8303\u56F4\uFF0C\u7531J.Welles Wilder\u6240\u53D1\u660E\u3002ATR\u6307\u6807\u4E3B\u8981\u662F\u7528\u6765\u8861\u91CF\u5E02\u573A\u6CE2\u52A8\u7684\u5F3A\u70C8\u7A0B\u5EA6\uFF0C\u7528\u4E8E\u53CD\u5E94\u5E02\u573A\u53D8\u5316\u7387\u7684\u6307\u6807\u3002\u8F83\u4F4E\u7684ATR\u503C\u8868\u793A\u5E02\u573A\u4EA4\u6613\u6C14\u6C1B\u6BD4\u8F83\u51B7\u6E05\uFF08\u80A1\u4EF7\u6A2A\u76D8\u6574\u7406\uFF0C\u9884\u793A\u53D8\u76D8\uFF09\uFF0C\u800C\u8F83\u9AD8\u7684ATR\u5219\u8868\u793A\u5E02\u573A\u4EA4\u6613\u6C14\u6C1B\u6BD4\u8F83\u65FA\u76DB\uFF08\u80A1\u4EF7\u6CE2\u5E45\u52A0\u5267\u6709\u4E3B\u529B\u8D44\u91D1\u8FDB\u51FA\uFF09\uFF0C\u8F83\u9AD8\u7684ATR\u6216\u8F83\u4F4E\u7684ATR\u53EF\u4EE5\u88AB\u770B\u4F5C\u4EF7\u683C\u8D8B\u52BF\u7684\u53CD\u8F6C\u6216\u4E0B\u4E00\u4E2A\u8D8B\u52BF\u7684\u5F00\u59CB\u3002</p><p>ATR\u6307\u6807\u7684\u8BA1\u7B97\u5206\u4E3A\u4EE5\u4E0B\u4E24\u6B65\uFF1A</p><ul><li>\u7B2C\u4E00\u6B65\u4E3A\u8BA1\u7B97\u771F\u5B9E\u6CE2\u5E45TR\u3002TR=MAX[(\u5F53\u65E5\u6700\u9AD8\u4EF7-\u5F53\u65E5\u6700\u4F4E\u4EF7)\u3001abs(\u5F53\u65E5\u6700\u9AD8\u4EF7-\u6628\u65E5\u6536\u76D8\u4EF7)\u3001abs(\u6628\u65E5\u6536\u76D8\u4EF7-\u5F53\u65E5\u6700\u4F4E\u4EF7)]\uFF0C\u6307\u7684\u662F\u4ECA\u65E5\u632F\u5E45\u3001\u4ECA\u65E5\u6700\u9AD8\u4EF7\u4E0E\u6628\u65E5\u6536\u76D8\u4EF7\u4E4B\u95F4\u7684\u6CE2\u5E45\u3001\u6628\u65E5\u6536\u76D8\u4EF7\u4E0E\u4ECA\u65E5\u6700\u4F4E\u4EF7\u4E4B\u95F4\u7684\u6CE2\u5E45\uFF0C\u53D6\u8FD9\u4E09\u8005\u4E4B\u4E2D\u7684\u6700\u5927\u503C\u3002</li><li>\u7B2C\u4E8C\u6B65\u5BF9\u771F\u5B9E\u6CE2\u5E45TR\u8FDB\u884CN\u65E5\u79FB\u52A8\u5E73\u5747\u8BA1\u7B97\u3002ATR=MA(TR,N)\uFF0C\u5E38\u7528\u53C2\u6570N\u4E3A14\u65E5\u621621\u65E5\u3002</li></ul><p>\u4F7F\u7528TA-Lib\u5E93\u4E2D\u7684<code>ATR()</code>\u65B9\u6CD5\u76F4\u63A5\u8BA1\u7B97ATR\u6CE2\u52A8\u5E45\u5EA6\u5E8F\u5217\uFF0C\u4F7F\u7528\u65F6\u9700\u8981\u8F93\u5165numpy.ndarray\u7C7B\u578B\u7684\u6700\u9AD8\u4EF7\u3001\u6700\u4F4E\u4EF7\u548C\u6536\u76D8\u4EF7\u5E8F\u5217\uFF0C\u4EE5\u53CA\u6307\u5B9AATR\u79FB\u52A8\u5E73\u5747\u53C2\u6570N\u3002\u4F7F\u7528\u80A1\u7968\u4EA4\u6613\u6570\u636E\u63A5\u53E3\u83B7\u53D6\u534E\u80DC\u5929\u62102018-10-1\u81F32019-4-1\u534A\u5E74\u7684\u4EA4\u6613\u6570\u636E\uFF0C\u5E76\u5206\u522B\u8BA1\u7B97ATR14\u548CATR21\u6307\u6807\u5E8F\u5217\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">df_stockload = web.DataReader(&quot;600410.SS&quot;, &quot;yahoo&quot;, datetime.datetime(2018,10,1), datetime.datetime(2019,4,1)) </span></span>
<span class="line"><span style="color:#A6ACCD;">df_stockload[&#39;art14&#39;] = talib.ATR(df_stockload.High.values,df_stockload.Low.values,df_stockload.Close.values,timeperiod=14)#\u8BA1\u7B97ATR14</span></span>
<span class="line"><span style="color:#A6ACCD;">df_stockload[&#39;art21&#39;] = talib.ATR(df_stockload.High.values,df_stockload.Low.values,df_stockload.Close.values,timeperiod=21)#\u8BA1\u7B97ATR21</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u5BF9\u8BA1\u7B97\u5F97\u5230\u7684ATR14\u548CATR21\u6307\u6807\u5E8F\u5217\uFF0C\u53EF\u76F4\u63A5\u4F7F\u7528<code>plot()</code>\u65B9\u6CD5\u7ED8\u5236\u66F2\u7EBF\uFF0C\u5982\u4E0B\u56FE\u6240\u793A\uFF1A</p><p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/4/14/16a1b60f13ff6b3a~tplv-t2oaga2asx-image.image" alt=""></p><h2 id="\u6B62\u76C8\u6B62\u635F\u7684\u5B9E\u73B0" tabindex="-1">\u6B62\u76C8\u6B62\u635F\u7684\u5B9E\u73B0 <a class="header-anchor" href="#\u6B62\u76C8\u6B62\u635F\u7684\u5B9E\u73B0" aria-hidden="true">#</a></h2><p>\u6B64\u5904\u5C06ATR\u503C\u4F5C\u4E3A\u6B62\u76C8\u6B62\u635F\u7684\u57FA\u51C6\u503C\uFF0C\u6B62\u76C8\u503C\u8BBE\u7F6E\u4E3An_win\u500D\u7684ATR\u503C\uFF0C\u6B62\u635F\u503C\u8BBE\u7F6E\u4E3An_loss\u500D\u7684ATR\u503C\uFF0Cn_win\u548Cn_loss\u5206\u522B\u4E3A\u6700\u5927\u6B62\u76C8\u7CFB\u6570\u548C\u6700\u5927\u6B62\u635F\u7CFB\u6570\uFF0C\u6B64\u5904\u8BBE\u7F6E\u6700\u5927\u6B62\u76C8\u7CFB\u6570\u4E3A2\uFF0C\u6700\u5927\u6B62\u635F\u7CFB\u6570\u4E3A0.8\uFF0C\u503E\u5411\u4E8E\u76C8\u5229\u503C\u8981\u5927\u4E8E\u4E8F\u635F\u503C\u3002\u89E6\u53D1\u6B62\u76C8\u6B62\u635F\u6761\u4EF6\u4E3A\uFF1A</p><ul><li>\u5F53n_win*ATR\u503C &gt; (\u4ECA\u65E5\u6536\u76D8\u4EF7\u683C - \u4E70\u5165\u4EF7\u683C)\uFF0C\u89E6\u53D1\u6B62\u76C8\u4FE1\u53F7\uFF0C\u5356\u51FA\u80A1\u7968</li><li>\u5F53n_loss*ATR\u503C &gt; (\u4E70\u5165\u4EF7\u683C - \u4ECA\u65E5\u6536\u76D8\u4EF7\u683C)\uFF0C\u89E6\u53D1\u6B62\u635F\u4FE1\u53F7\uFF0C\u5356\u51FA\u80A1\u7968</li></ul><p>\u63A5\u4E0B\u6765\u6211\u4EEC\u9700\u8981\u6574\u6539<code>GetStockDatApi()</code>\u63A5\u53E3\uFF0C\u8BE5\u63A5\u53E3\u539F\u6765\u4EE5\u77E2\u91CF\u5316\u65B9\u5F0F\u83B7\u5F97\u4E70\u5356\u70B9\u4FE1\u53F7\uFF0C\u73B0\u66F4\u6539\u4E3A\u904D\u5386\u65B9\u5F0F\u83B7\u5F97\u4E70\u5356\u70B9\u4FE1\u53F7\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">#\u539F\u5904\u7406\u65B9\u5F0F</span></span>
<span class="line"><span style="color:#A6ACCD;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">#\u6536\u76D8\u4EF7\u8D85\u8FC7N1\u6700\u9AD8\u4EF7 \u4E70\u5165\u80A1\u7968\u6301\u6709</span></span>
<span class="line"><span style="color:#A6ACCD;">buy_index = stockdata[stockdata.Close &gt; stockdata.N1_High].index</span></span>
<span class="line"><span style="color:#A6ACCD;">stockdata.loc[buy_index,&#39;signal&#39;] = 1</span></span>
<span class="line"><span style="color:#A6ACCD;">#\u6536\u76D8\u4EF7\u8D85\u8FC7N2\u6700\u4F4E\u4EF7 \u5356\u51FA\u80A1\u7968\u6301\u6709</span></span>
<span class="line"><span style="color:#A6ACCD;">sell_index = stockdata[stockdata.Close &lt; stockdata.N2_Low].index</span></span>
<span class="line"><span style="color:#A6ACCD;">stockdata.loc[sell_index,&#39;signal&#39;] = 0</span></span>
<span class="line"><span style="color:#A6ACCD;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">#\u73B0\u5904\u7406\u65B9\u5F0F</span></span>
<span class="line"><span style="color:#A6ACCD;">for kl_index, today in stockdata.iterrows():</span></span>
<span class="line"><span style="color:#A6ACCD;">    if today.Close &gt; today.N1_High:</span></span>
<span class="line"><span style="color:#A6ACCD;">        stockdata.loc[kl_index, &#39;signal&#39;] = 1</span></span>
<span class="line"><span style="color:#A6ACCD;">    elif today.Close &lt; today.N2_Low:</span></span>
<span class="line"><span style="color:#A6ACCD;">        stockdata.loc[kl_index, &#39;signal&#39;] = 0</span></span>
<span class="line"><span style="color:#A6ACCD;">    else:</span></span>
<span class="line"><span style="color:#A6ACCD;">        pass</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u5728\u6B64\u57FA\u7840\u4E0A\u878D\u5165ATR\u6B62\u76C8\u6B62\u635F\u7684\u5224\u65AD\uFF0C\u5F53N\u65E5\u7A81\u7834\u7B56\u7565\u7ED9\u51FA\u4E70\u5165\u4FE1\u53F7\u540E\uFF0C\u5C06\u4E70\u5165\u4EF7\u5B58\u50A8\u4E8E\u53D8\u91CF<code>buy_price</code>\u4E4B\u4E2D\uFF0C\u800C\u540E\u4E0E\u6BCF\u4E2A\u4EA4\u6613\u65E5\u7684\u6536\u76D8\u4EF7\u5BF9\u6BD4\uFF0C\u65E0\u8BBA\u662F\u5230\u8FBE\u6B62\u76C8\u4EF7\u683C\u8FD8\u662F\u6B62\u635F\u4EF7\u683C\u90FD\u4F1A\u89E6\u53D1\u5356\u51FA\u4FE1\u53F7\uFF0C\u5F53\u5356\u51FA\u540E\u5C06\u53D8\u91CF<code>buy_price</code>\u6E05\u96F6\uFF0C\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">buy_price = 0</span></span>
<span class="line"><span style="color:#A6ACCD;">for kl_index, today in stockdata.iterrows():</span></span>
<span class="line"><span style="color:#A6ACCD;">    if today.Close &gt; today.N1_High:</span></span>
<span class="line"><span style="color:#A6ACCD;">        print(&#39;N_day_buy&#39;, kl_index, today.Close)</span></span>
<span class="line"><span style="color:#A6ACCD;">        buy_price = today.Close</span></span>
<span class="line"><span style="color:#A6ACCD;">        stockdata.loc[kl_index, &#39;signal&#39;] = 1</span></span>
<span class="line"><span style="color:#A6ACCD;">    # \u5230\u8FBE\u6536\u76D8\u4EF7\u5C11\u4E8E\u4E70\u5165\u4EF7\u540E\u89E6\u53D1\u5356\u51FA</span></span>
<span class="line"><span style="color:#A6ACCD;">    elif (buy_price != 0) and (buy_price &gt; today.Close) and ((buy_price - today.Close) &gt; n_loss * today.atr14):</span></span>
<span class="line"><span style="color:#A6ACCD;">        print(&#39;stop_loss_n&#39;, kl_index, today.Close, buy_price)</span></span>
<span class="line"><span style="color:#A6ACCD;">        stockdata.loc[kl_index, &#39;signal&#39;] = 0</span></span>
<span class="line"><span style="color:#A6ACCD;">        buy_price = 0</span></span>
<span class="line"><span style="color:#A6ACCD;">    # \u5230\u8FBE\u6536\u76D8\u4EF7\u591A\u4E8E\u4E70\u5165\u4EF7\u540E\u89E6\u53D1\u5356\u51FA</span></span>
<span class="line"><span style="color:#A6ACCD;">    elif (buy_price != 0) and (buy_price &lt; today.Close) and ((today.Close - buy_price) &gt; n_win * today.atr14):</span></span>
<span class="line"><span style="color:#A6ACCD;">        print(&#39;stop_win_n&#39;, kl_index, today.Close, buy_price)</span></span>
<span class="line"><span style="color:#A6ACCD;">        stockdata.loc[kl_index, &#39;signal&#39;] = 0</span></span>
<span class="line"><span style="color:#A6ACCD;">        buy_price = 0</span></span>
<span class="line"><span style="color:#A6ACCD;">    elif today.Close &lt; today.N2_Low:</span></span>
<span class="line"><span style="color:#A6ACCD;">        print(&#39;N_day_sell&#39;, kl_index, today.Close, buy_price)</span></span>
<span class="line"><span style="color:#A6ACCD;">        stockdata.loc[kl_index, &#39;signal&#39;] = 0</span></span>
<span class="line"><span style="color:#A6ACCD;">        buy_price = 0</span></span>
<span class="line"><span style="color:#A6ACCD;">    else:</span></span>
<span class="line"><span style="color:#A6ACCD;">        pass</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u6574\u6539\u540E\u7684<code>GetStockDatApi()</code>\u63A5\u53E3\uFF0C\u53EF\u878D\u5408N\u65E5\u7A81\u7834\u62E9\u65F6\u7B56\u7565\u53CAATR\u6B62\u76C8\u6B62\u635F\u7B56\u7565\uFF0C\u5B8C\u6574\u4EE3\u7801\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">#\u80A1\u7968\u6570\u636E\u83B7\u53D6\u53CA\u5904\u7406\u63A5\u53E3</span></span>
<span class="line"><span style="color:#A6ACCD;">def GetStockDatApi(stockName=None,stockTimeS=None,stockTimeE=None, N1=15, N2=5, n_loss=0.8, n_win=2):</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    stockdata = web.DataReader(stockName, &quot;yahoo&quot;, stockTimeS, stockTimeE)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    stockdata[&#39;N1_High&#39;] = stockdata.High.rolling(window=N1).max()#\u8BA1\u7B97\u6700\u8FD1N1\u4E2A\u4EA4\u6613\u65E5\u6700\u9AD8\u4EF7</span></span>
<span class="line"><span style="color:#A6ACCD;">    stockdata[&#39;N1_High&#39;] = stockdata.N1_High.shift(1)</span></span>
<span class="line"><span style="color:#A6ACCD;">    expan_max = stockdata.Close.expanding().max()</span></span>
<span class="line"><span style="color:#A6ACCD;">    stockdata[&#39;N1_High&#39;].fillna(value=expan_max,inplace=True)#\u76EE\u524D\u51FA\u73B0\u8FC7\u7684\u6700\u5927\u503C\u586B\u5145\u524DN1\u4E2Anan</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    stockdata[&#39;N2_Low&#39;] = stockdata.Low.rolling(window=N2).min()#\u8BA1\u7B97\u6700\u8FD1N2\u4E2A\u4EA4\u6613\u65E5\u6700\u4F4E\u4EF7</span></span>
<span class="line"><span style="color:#A6ACCD;">    stockdata[&#39;N2_Low&#39;] = stockdata.N2_Low.shift(1)</span></span>
<span class="line"><span style="color:#A6ACCD;">    expan_min = stockdata.Close.expanding().min()</span></span>
<span class="line"><span style="color:#A6ACCD;">    stockdata[&#39;N2_Low&#39;].fillna(value=expan_min,inplace=True)#\u76EE\u524D\u51FA\u73B0\u8FC7\u7684\u6700\u5C0F\u503C\u586B\u5145\u524DN2\u4E2Anan</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    stockdata[&#39;atr14&#39;] = talib.ATR(stockdata.High.values, stockdata.Low.values, stockdata.Close.values, timeperiod=14)  # \u8BA1\u7B97ATR14</span></span>
<span class="line"><span style="color:#A6ACCD;">    buy_price = 0</span></span>
<span class="line"><span style="color:#A6ACCD;">    for kl_index, today in stockdata.iterrows():</span></span>
<span class="line"><span style="color:#A6ACCD;">        if today.Close &gt; today.N1_High:</span></span>
<span class="line"><span style="color:#A6ACCD;">            print(&#39;N_day_buy&#39;, kl_index, today.Close)</span></span>
<span class="line"><span style="color:#A6ACCD;">            buy_price = today.Close</span></span>
<span class="line"><span style="color:#A6ACCD;">            stockdata.loc[kl_index, &#39;signal&#39;] = 1</span></span>
<span class="line"><span style="color:#A6ACCD;">        #\u5230\u8FBE\u6536\u76D8\u4EF7\u5C11\u4E8E\u4E70\u5165\u4EF7\u540E\u89E6\u53D1\u5356\u51FA</span></span>
<span class="line"><span style="color:#A6ACCD;">        elif (buy_price != 0) and (buy_price &gt; today.Close) and ((buy_price - today.Close) &gt; n_loss * today.atr14):</span></span>
<span class="line"><span style="color:#A6ACCD;">            print(&#39;stop_loss_n&#39;, kl_index, today.Close, buy_price)</span></span>
<span class="line"><span style="color:#A6ACCD;">            stockdata.loc[kl_index, &#39;signal&#39;] = 0</span></span>
<span class="line"><span style="color:#A6ACCD;">            buy_price = 0</span></span>
<span class="line"><span style="color:#A6ACCD;">        #\u5230\u8FBE\u6536\u76D8\u4EF7\u591A\u4E8E\u4E70\u5165\u4EF7\u540E\u89E6\u53D1\u5356\u51FA</span></span>
<span class="line"><span style="color:#A6ACCD;">        elif (buy_price != 0) and (buy_price &lt; today.Close) and ((today.Close - buy_price) &gt; n_win * today.atr14):</span></span>
<span class="line"><span style="color:#A6ACCD;">            print(&#39;stop_win_n&#39;, kl_index, today.Close, buy_price)</span></span>
<span class="line"><span style="color:#A6ACCD;">            stockdata.loc[kl_index, &#39;signal&#39;] = 0</span></span>
<span class="line"><span style="color:#A6ACCD;">            buy_price = 0</span></span>
<span class="line"><span style="color:#A6ACCD;">        elif today.Close &lt; today.N2_Low:</span></span>
<span class="line"><span style="color:#A6ACCD;">            print(&#39;N_day_sell&#39;, kl_index, today.Close, buy_price)</span></span>
<span class="line"><span style="color:#A6ACCD;">            stockdata.loc[kl_index, &#39;signal&#39;] = 0</span></span>
<span class="line"><span style="color:#A6ACCD;">            buy_price = 0</span></span>
<span class="line"><span style="color:#A6ACCD;">        else:</span></span>
<span class="line"><span style="color:#A6ACCD;">            pass</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    stockdata[&#39;signal&#39;].fillna(method = &#39;ffill&#39;,inplace = True)</span></span>
<span class="line"><span style="color:#A6ACCD;">    stockdata[&#39;signal&#39;] = stockdata.signal.shift(1)</span></span>
<span class="line"><span style="color:#A6ACCD;">    stockdata[&#39;signal&#39;].fillna(method = &#39;bfill&#39;,inplace = True)</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    return stockdata</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u5BF9\u6BD4\u878D\u5165ATR\u6B62\u76C8\u6B62\u635F\u7B56\u7565\u524D\u540E\u7684\u6267\u884C\u6548\u679C\uFF0C\u6B64\u5904\u83B7\u53D6\u534E\u80DC\u5929\u62102018-1-1\u81F32019-4-1\u7684\u4EA4\u6613\u6570\u636E\uFF0C\u4EE5\u63D0\u4F9B\u66F4\u591A\u7684\u56DE\u6D4B\u6570\u636E\u3002</p><p>\u672A\u91C7\u7528ATR\u6B62\u76C8\u6B62\u635F\u7B56\u7565\u7684\u4E70\u5356\u4FE1\u53F7\u660E\u7EC6\u5982\u4E0B\u6240\u793A\uFF1A</p><ul><li><p>buy 2018-03-02 00:00:00 \u2014\u2014 sell 2018-03-15 00:00:00</p></li><li><p>buy 2018-04-25 00:00:00 \u2014\u2014 sell 2018-05-04 00:00:00</p></li><li><p>buy 2018-11-07 00:00:00 \u2014\u2014 sell 2018-11-26 00:00:0</p></li><li><p>buy 2019-01-17 00:00:00 \u2014\u2014 sell 2019-01-22 00:00:00</p></li><li><p>buy 2019-02-19 00:00:00</p></li></ul><p>\u53EF\u77E5\u603B\u5171\u67095\u7B14\u4EA4\u6613\uFF0C\u6700\u540E\u4E00\u6B21\u4E70\u5165\u867D\u7136\u6709\u6CE2\u52A8\uFF0C\u4F46\u59CB\u7EC8\u672A\u89E6\u53CAN\u65E5\u7A81\u7834\u7B56\u7565\u7684\u5356\u51FA\u9608\u503C\u3002\u5BF9\u5E94\u7684\u4E70\u5356\u533A\u95F4\u53CA\u53EF\u89C6\u5316\u6548\u679C\uFF0C\u5982\u4E0B\u56FE\u6240\u793A\uFF1A</p><p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/4/14/16a1b6305c42e85f~tplv-t2oaga2asx-image.image" alt=""></p><p>\u91C7\u7528ATR\u6B62\u76C8\u6B62\u635F\u7B56\u7565\u7684\u4E70\u5356\u4FE1\u53F7\u660E\u7EC6\u5982\u4E0B\u6240\u793A\uFF1A</p><ul><li><p>buy 2018-03-02 00:00:00 \u2014\u2014 sell 2018-03-15 00:00:00</p></li><li><p>buy 2018-04-25 00:00:00 \u2014\u2014 sell 2018-04-27 00:00:00\uFF08stop_loss_n 2018-04-26 00:00:00 12.59000015258789 13.1899995803833\uFF09</p></li><li><p>buy 2018-11-07 00:00:00 \u2014\u2014 sell 2018-11-23 00:00:00\uFF08stop_loss_n 2018-11-22 00:00:00 6.650000095367432 6.900000095367432\uFF09</p></li><li><p>buy 2019-01-17 00:00:00 \u2014\u2014 sell 2019-01-18 00:00:00\uFF08stop_loss_n 2019-01-17 00:00:00 6.409999847412109 6.769999980926514\uFF09</p></li><li><p>buy 2019-02-19 00:00:00 \u2014\u2014 sell 2019-03-01 00:00:00\uFF08stop_loss_n 2019-02-28 00:00:00 7.010000228881836 7.269999980926514\uFF09</p></li><li><p>buy 2019-03-06 00:00:00 \u2014\u2014 sell 2019-03-15 00:00:00\uFF08stop_loss_n 2019-03-14 00:00:00 8.119999885559082 8.729999542236328\uFF09</p></li><li><p>buy 2019-03-26 00:00:00 \u2014\u2014 sell 2019-03-27 00:00:00\uFF08stop_loss_n 2019-03-26 00:00:00 9.600000381469727 10.670000076293945\uFF09</p></li></ul><p>\u53EF\u77E5\u603B\u5171\u89E6\u53D1\u4E866\u7B14\u6B62\u635F\u4EA4\u6613\uFF0C\u6B62\u635F\u9608\u503C\u53C2\u6570\u8BBE\u7F6E\u8FC7\u4F4E\u6240\u5E26\u6765\u7684\u95EE\u9898\u5373\u662F\u5728\u6CE2\u52A8\u8F83\u5267\u70C8\u7684\u884C\u60C5\u4E2D\u5BB9\u6613\u88AB\u6D17\u51FA\u5C40\u3002\u5BF9\u5E94\u7684\u4E70\u5356\u533A\u95F4\u53CA\u53EF\u89C6\u5316\u6548\u679C\uFF0C\u5982\u4E0B\u56FE\u6240\u793A\uFF1A</p><p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/4/14/16a1b63fa2366d8d~tplv-t2oaga2asx-image.image" alt=""></p><h2 id="\u603B\u7ED3" tabindex="-1">\u603B\u7ED3 <a class="header-anchor" href="#\u603B\u7ED3" aria-hidden="true">#</a></h2><p>\u672C\u5C0F\u8282\u5C06ATR\u6B62\u76C8\u6B62\u635F\u7B56\u7565\u4F5C\u4E3A\u98CE\u9669\u7BA1\u7406\u56E0\u5B50\u4E0EN\u65E5\u7A81\u7834\u62E9\u65F6\u7B56\u7565\u76F8\u878D\u5408\uFF0C\u5C06\u591A\u4E2A\u7B56\u7565\u4F5C\u4E3A\u56E0\u5B50\u4F5C\u7528\u5728\u4E00\u8D77\u5224\u65AD\u8D70\u52BF\uFF0C\u53EF\u4EE5\u4ECE\u4E0D\u540C\u7684\u7EF4\u5EA6\u4FDD\u8BC1\u4EA4\u6613\u7684\u53EF\u9760\u6027\uFF0C\u4ECE\u800C\u907F\u514D\u7B56\u7565\u7684\u4E0D\u786E\u5B9A\u6027\u6240\u5E26\u6765\u7684\u4EA4\u6613\u4E0A\u7684\u98CE\u9669\u3002</p><p>\u6700\u540E\uFF0C\u7ED9\u5927\u5BB6\u7559\u4E00\u9053\u601D\u8003\u9898\uFF1A</p><p>\u5728\u80A1\u7968\u4EA4\u6613\u4E2D\u6B62\u635F\u662F\u975E\u5E38\u91CD\u8981\u7684\u98CE\u9669\u7BA1\u7406\u63AA\u65BD\uFF0C\u90A3\u4E48\u5927\u5BB6\u5E73\u65F6\u4E70\u5165\u80A1\u7968\u65F6\u90FD\u6709\u8BBE\u7F6E\u6B62\u635F\u70B9\u5417\uFF1F\u8BBE\u7F6E\u6B62\u635F\u70B9\u7684\u6807\u51C6\u53C8\u662F\u4EC0\u4E48\u5462\uFF1F</p><p>\u6B22\u8FCE\u5927\u5BB6\u5728\u7559\u8A00\u533A\u7559\u8A00\uFF0C\u6211\u4EEC\u4E00\u8D77\u8BA8\u8BBA\u3002</p>`,39),o=[e];function t(c,i,r,A,d,C){return n(),a("div",null,o)}const u=s(p,[["render",t]]);export{_ as __pageData,u as default};
