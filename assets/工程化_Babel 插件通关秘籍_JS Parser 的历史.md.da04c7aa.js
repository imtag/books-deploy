import{_ as s,c as a,o as n,d as p}from"./app.c4f45da1.js";const C=JSON.parse('{"title":"JS Parser \u7684\u5386\u53F2","description":"","frontmatter":{},"headers":[{"level":2,"title":"SpiderMonkey \u548C estree \u6807\u51C6","slug":"spidermonkey-\u548C-estree-\u6807\u51C6","link":"#spidermonkey-\u548C-estree-\u6807\u51C6","children":[]},{"level":2,"title":"acorn","slug":"acorn","link":"#acorn","children":[{"level":3,"title":"babel parser \u5BF9 estree AST \u7684\u6269\u5C55","slug":"babel-parser-\u5BF9-estree-ast-\u7684\u6269\u5C55","link":"#babel-parser-\u5BF9-estree-ast-\u7684\u6269\u5C55","children":[]}]},{"level":2,"title":"acorn \u63D2\u4EF6","slug":"acorn-\u63D2\u4EF6","link":"#acorn-\u63D2\u4EF6","children":[{"level":3,"title":"\u5206\u8BCD\uFF08\u8BCD\u6CD5\u5206\u6790\uFF09","slug":"\u5206\u8BCD\uFF08\u8BCD\u6CD5\u5206\u6790\uFF09","link":"#\u5206\u8BCD\uFF08\u8BCD\u6CD5\u5206\u6790\uFF09","children":[]},{"level":3,"title":"\u7EC4\u88C5AST\uFF08\u8BED\u6CD5\u5206\u6790\uFF09","slug":"\u7EC4\u88C5ast\uFF08\u8BED\u6CD5\u5206\u6790\uFF09","link":"#\u7EC4\u88C5ast\uFF08\u8BED\u6CD5\u5206\u6790\uFF09","children":[]}]},{"level":2,"title":"\u603B\u7ED3","slug":"\u603B\u7ED3","link":"#\u603B\u7ED3","children":[]}],"relativePath":"\u5DE5\u7A0B\u5316/Babel \u63D2\u4EF6\u901A\u5173\u79D8\u7C4D/JS Parser \u7684\u5386\u53F2.md"}'),l={name:"\u5DE5\u7A0B\u5316/Babel \u63D2\u4EF6\u901A\u5173\u79D8\u7C4D/JS Parser \u7684\u5386\u53F2.md"},o=p(`<h1 id="js-parser-\u7684\u5386\u53F2" tabindex="-1">JS Parser \u7684\u5386\u53F2 <a class="header-anchor" href="#js-parser-\u7684\u5386\u53F2" aria-hidden="true">#</a></h1><hr><p>\u524D\u9762\u6211\u4EEC\u5B66\u4E60\u4E86 babel \u7684 parser \u548C AST\uFF0Cbabel \u7684 parser \u662F\u57FA\u4E8E acorn \u6269\u5C55\u800C\u6765\u7684\uFF0C\u800C acorn \u4E5F\u4E0D\u662F\u6700\u65E9\u7684 js parser\uFF0Cjs parser \u7684\u5386\u53F2\u662F\u600E\u6837\u7684\uFF1F \u5404\u79CD parser \u4E4B\u95F4\u7684\u5173\u7CFB\u662F\u4EC0\u4E48\u6837\u7684\u5462\uFF1F\u8FD9\u8282\u6211\u4EEC\u6765\u68B3\u7406\u4E00\u4E0B\u3002</p><h2 id="spidermonkey-\u548C-estree-\u6807\u51C6" tabindex="-1">SpiderMonkey \u548C estree \u6807\u51C6 <a class="header-anchor" href="#spidermonkey-\u548C-estree-\u6807\u51C6" aria-hidden="true">#</a></h2><p>\u5728 nodejs \u51FA\u73B0\u4E4B\u540E\uFF0C\u524D\u7AEF\u53EF\u4EE5\u7528 nodejs \u6765\u505A\u4E00\u4E9B\u5DE5\u7A0B\u5316\u7684\u4E8B\u60C5\uFF0C\u5DE5\u7A0B\u5316\u9700\u8981\u5BF9\u4EE3\u7801\u505A\u7F16\u8BD1\u3001\u538B\u7F29\u3001lint \u7B49\u5904\u7406\uFF0C\u4E5F\u5C31\u6709\u4E86\u5BF9 js parser \u7684\u9700\u6C42\u3002</p><p>Mozilla \u5728 MDN \u4E0A\u516C\u5E03\u4E86\u706B\u72D0\u6D4F\u89C8\u5668\u7684 JS \u5F15\u64CE SpiderMonkey\uFF08c++ \u5199\u7684 js \u5F15\u64CE\uFF09\u7684 parser api \u548C AST \u6807\u51C6\uFF0C\u6240\u4EE5\u5F53\u65F6\u6700\u65E9\u7684 JS parser ---- <a href="https://github.com/jquery/esprima" target="_blank" rel="noreferrer">esprima</a> \u5C31\u662F\u57FA\u4E8E SpiderMonkey \u7684 AST \u6807\u51C6\u6765\u5B9E\u73B0\u7684\uFF0C\u540E\u6765\u5F62\u6210\u4E86 <a href="https://github.com/estree/estree" target="_blank" rel="noreferrer">estree \u6807\u51C6</a>\u3002 \u5F53\u65F6\u5F88\u591A\u7684\u524D\u7AEF\u9886\u57DF\u7684\u5DE5\u5177\u90FD\u57FA\u4E8E esprima\u3002</p><p>\u4F46\u662F\u5230\u4E86 2015 \u5E74\u4E4B\u540E\uFF0Ces \u6807\u51C6\u4E00\u5E74\u4E00\u4E2A\u7248\u672C\uFF0C\u800C esprima \u7684\u66F4\u65B0\u901F\u5EA6\u8DDF\u4E0D\u4E0A\uFF0C\u5B83\u8DDF\u4E0D\u4E0A\u4E5F\u5C31\u5BFC\u81F4\u4E86\u4F9D\u8D56\u5B83\u7684\u4E00\u7CFB\u5217\u5DE5\u5177\u90FD\u8DDF\u4E0D\u4E0A\uFF0C\u6240\u4EE5 eslint \u5C31 fork \u4E86\u4E00\u4EFD esprima\uFF0C\u505A\u4E86\u4E00\u4E9B\u6269\u5C55\uFF0C\u6765\u81EA\u5DF1\u5B9E\u73B0\u65B0\u8BED\u6CD5\u7684 parse\uFF0C\u8FD9\u5C31\u662F espree\uFF0C\u5B83\u4F9D\u7136\u662F estree \u6807\u51C6\u7684\uFF0C\u8FD9\u662F eslint \u7684\u9ED8\u8BA4 parser\u3002</p><h2 id="acorn" tabindex="-1">acorn <a class="header-anchor" href="#acorn" aria-hidden="true">#</a></h2><p>\u540E\u9762\u51FA\u73B0\u4E86 <a href="https://github.com/acornjs/acorn" target="_blank" rel="noreferrer">acorn</a>\uFF0C\u4E5F\u662F estree \u6807\u51C6\u7684\u5B9E\u73B0\uFF0C\u4F46\u662F\u4ED6\u7684\u901F\u5EA6\u6BD4 esprima \u5FEB\uFF0C\u800C\u4E14\u652F\u6301\u63D2\u4EF6\uFF0C\u53EF\u4EE5\u901A\u8FC7\u63D2\u4EF6\u6269\u5C55\u8BED\u6CD5\u652F\u6301\u3002\u6B63\u662F\u901F\u5EA6\u5FEB\u52A0\u4E0A\u652F\u6301\u63D2\u4EF6\u8BA9\u5F88\u591A\u5DE5\u5177\u90FD\u8F6C\u800C\u4F7F\u7528 acorn\u3002</p><p>eslint \u7684 parser\uFF0C\u4E5F\u5C31\u662F <a href="https://github.com/eslint/espree" target="_blank" rel="noreferrer">espree</a> \u672C\u6765\u662F fork \u81EA esprima\uFF0C\u4F46\u540E\u6765 espree 2.0 \u57FA\u4E8E acorn \u91CD\u65B0\u5B9E\u73B0\u4E86\uFF0C\u4E5F\u4F7F\u7528 acorn \u7684\u63D2\u4EF6\u673A\u5236\u6765\u6269\u5C55\u8BED\u6CD5\u3002</p><p>babel parser(babylon) \u4E5F\u9009\u62E9\u4E86\u57FA\u4E8E acorn \u6765\u5B9E\u73B0\u81EA\u5DF1\u7684 parser\u3002</p><p>\u4F46\u5B83\u5BF9 estree \u6807\u51C6\u7684 AST \u8282\u70B9\u548C\u5C5E\u6027\u90FD\u505A\u4E86\u6269\u5C55\uFF0C\u4E5F\u63D0\u4F9B\u4E86\u4E00\u4E9B\u652F\u6301 typescript\u3001jsx\u3001flow \u7684\u8BED\u6CD5\u63D2\u4EF6\uFF08\u5C31\u662F\u6211\u4EEC\u53EF\u4EE5\u5728 @babel/parser \u7684 plugins \u91CC\u9762\u6307\u5B9A\u7684\u90A3\u4E9B\uFF09\u3002</p><p>\u8FD9\u4E9B parser \u4E4B\u95F4\u7684\u5173\u7CFB\u5982\u56FE\u6240\u793A\uFF1A</p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9f30072e7a774fbf85539daedb8813ad~tplv-k3u1fbpfcp-watermark.image" alt=""></p><p>estree \u6807\u51C6\u662F\u57FA\u4E8E SpiderMonkey \u7684 AST \u6807\u51C6\u6269\u5C55\u7684\uFF0C\u5B83\u7684\u5B9E\u73B0\u6709 esprima\u3001acorn \u7B49\u3002</p><p>\u56E0\u4E3A acorn \u65B0\u7279\u6027\u652F\u6301\u7684\u5168\uFF0C\u800C\u4E14\u652F\u6301\u63D2\u4EF6\uFF0C\u6240\u4EE5 espree\u3001babel parser \u90FD\u662F\u57FA\u4E8E acorn \u505A\u4E86\u4E9B\u6269\u5C55\u3002</p><p>\u5F53\u7136\u4E5F\u4E0D\u662F\u6240\u6709\u7684 js parser \u90FD\u662F estree \u6807\u51C6\u7684\uFF0C\u6BD4\u5982 terser\u3001typescript \u7B49\u90FD\u6709\u81EA\u5DF1\u7684 AST \u6807\u51C6\u3002</p><p>\u90A3 babel \u5BF9 estree \u6807\u51C6\u7684 AST \u505A\u4E86\u54EA\u4E9B\u6269\u5C55\u5462\uFF1F</p><h3 id="babel-parser-\u5BF9-estree-ast-\u7684\u6269\u5C55" tabindex="-1">babel parser \u5BF9 estree AST \u7684\u6269\u5C55 <a class="header-anchor" href="#babel-parser-\u5BF9-estree-ast-\u7684\u6269\u5C55" aria-hidden="true">#</a></h3><p>\u5176\u5B9E\u8FD9\u4E9B\u53EF\u4EE5\u5728 <a href="https://babeljs.io/docs/en/babel-parser#output" target="_blank" rel="noreferrer">babel parser \u7684\u6587\u6863</a>\u91CC\u770B\u5230\uFF1A</p><p>\u4E5F\u5C31\u662F\uFF0Cbabel \u57FA\u4E8E acorn \u63D2\u4EF6\u5BF9 estree AST \u505A\u4E86\u5982\u4E0B\u6269\u5C55\uFF1A</p><ul><li>\u628A Literal \u66FF\u6362\u6210\u4E86 StringLiteral\u3001NumericLiteral\u3001 BigIntLiteral\u3001 BooleanLiteral\u3001 NullLiteral\u3001 RegExpLiteral</li><li>\u628A Property \u66FF\u6362\u6210\u4E86 ObjectProperty \u548C ObjectMethod</li><li>\u628A MethodDefinition \u66FF\u6362\u6210\u4E86 ClassMethod</li><li>Program \u548C BlockStatement \u652F\u6301\u4E86 directives \u5C5E\u6027\uFF0C\u4E5F\u5C31\u662F &#39;use strict&#39; \u7B49\u6307\u4EE4\u7684\u89E3\u6790\uFF0C\u5BF9\u5E94\u7684 ast \u662F Directive \u548C DirectiveLiteral</li><li>ChainExpression \u66FF\u6362\u4E3A\u4E86 ObjectMemberExpression \u548C OptionalCallExpression</li><li>ImportExpression \u66FF\u6362\u4E3A\u4E86 CallExpression \u5E76\u4E14 callee \u5C5E\u6027\u8BBE\u7F6E\u4E3A Import</li></ul><p>\u7B49</p><h2 id="acorn-\u63D2\u4EF6" tabindex="-1">acorn \u63D2\u4EF6 <a class="header-anchor" href="#acorn-\u63D2\u4EF6" aria-hidden="true">#</a></h2><p>babel parser \u57FA\u4E8E acorn \u6269\u5C55\u4E86\u4E00\u4E9B\u8BED\u6CD5\uFF0C\u90A3\u5B83\u662F\u600E\u4E48\u6269\u5C55\u7684\u5462\uFF1F</p><p>\u6211\u4EEC\u5199\u4E00\u4E2A acorn \u63D2\u4EF6\u6765\u611F\u53D7\u4E00\u4E0B\u3002</p><p>acorn \u4E3B\u8981\u662F\u4E00\u4E2A Parser \u7C7B\uFF0C\u4E0D\u540C\u7684\u65B9\u6CD5\u5B9E\u73B0\u4E86\u4E0D\u540C\u7684\u903B\u8F91\uFF0C\u63D2\u4EF6\u6269\u5C55\u5C31\u662F\u7EE7\u627F\u8FD9\u4E2A Parser\uFF0C\u91CD\u5199\u4E00\u4E9B\u65B9\u6CD5\u3002</p><p>acorn \u7684 api \u5982\u4E0B\uFF0C\u5176\u4E2D acorn-jsx\u3001acorn-bigint \u5C31\u662F acorn \u63D2\u4EF6</p><div class="language-javascript"><button class="copy"></button><span class="lang">javascript</span><pre><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> Parser </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">acorn</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> MyParser </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Parser</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">extend</span><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">acorn-jsx</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)()</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">acorn-bigint</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(MyParser</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">parse</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">// Some bigint + JSX code</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">))</span></span>
<span class="line"></span></code></pre></div><p>\u63D2\u4EF6\u662F\u4E00\u4E2A\u51FD\u6570\uFF0C\u63A5\u6536\u4E4B\u524D\u7684 Parser\uFF0C\u8FD4\u56DE\u6269\u5C55\u4EE5\u540E\u7684 Parser</p><div class="language-javascript"><button class="copy"></button><span class="lang">javascript</span><pre><code><span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">noisyReadToken</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">Parser</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">class</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">extends</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Parser</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    readToken</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">code</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Reading a token!</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">super</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">readToken</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">code</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u63A5\u4E0B\u6765\u6211\u4EEC\u5199\u4E00\u4E2A acorn \u63D2\u4EF6\u6765\u5B9E\u73B0 \u7ED9 javascript \u4E00\u4E2A\u5173\u952E\u5B57 guang\uFF0C\u53EF\u4EE5\u4F5C\u4E3A statement \u5355\u72EC\u4F7F\u7528\u3002</p><p>\u6211\u4EEC\u77E5\u9053 parse \u7684\u8FC7\u7A0B\u5176\u5B9E\u5C31\u662F<code>\u5206\u8BCD</code> + <code>\u7EC4\u88C5 AST</code>\u8FD9\u4E24\u6B65\uFF08\u4E00\u822C\u53EB\u8BCD\u6CD5\u5206\u6790\u548C\u8BED\u6CD5\u5206\u6790\uFF09\uFF0C\u6211\u4EEC\u53EA\u8981\u5B9E\u73B0\u8FD9\u4E24\u6B65\u5C31\u53EF\u4EE5\u4E86\u3002</p><h3 id="\u5206\u8BCD\uFF08\u8BCD\u6CD5\u5206\u6790\uFF09" tabindex="-1">\u5206\u8BCD\uFF08\u8BCD\u6CD5\u5206\u6790\uFF09 <a class="header-anchor" href="#\u5206\u8BCD\uFF08\u8BCD\u6CD5\u5206\u6790\uFF09" aria-hidden="true">#</a></h3><p>\u6211\u4EEC\u662F\u60F3\u589E\u52A0\u4E00\u4E2A\u5173\u952E\u5B57\uFF0Cacorn \u6709 keywords \u5C5E\u6027\uFF0C\u662F\u4E00\u4E2A\u6B63\u5219\u8868\u8FBE\u5F0F\uFF0C\u7528\u6765\u505A\u5173\u952E\u5B57\u62C6\u5206\uFF0C\u6240\u4EE5\u6211\u4EEC\u91CD\u5199 keywords \u5C5E\u6027\u5C31\u53EF\u4EE5\u3002\u5E76\u4E14\u8FD8\u8981\u4E3A\u65B0\u7684\u5173\u952E\u5B57\u6CE8\u518C\u4E00\u4E2A token \u7C7B\u578B\u3002</p><p>acorn Parser \u7684\u5165\u53E3\u65B9\u6CD5\u662F parse\uFF0C\u6211\u4EEC\u8981\u5728 parse \u65B9\u6CD5\u91CC\u9762\u8BBE\u7F6E keywords\u3002</p><div class="language-javascript"><button class="copy"></button><span class="lang">javascript</span><pre><code><span class="line"><span style="color:#82AAFF;">parse</span><span style="color:#A6ACCD;">(program) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">var</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">newKeywords</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this const class extends export import super</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">newKeywords</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;"> guang</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;">// \u589E\u52A0\u4E00\u4E2A\u5173\u952E\u5B57</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">keywords</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">RegExp</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">^(?:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">newKeywords</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">replace</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">/</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">/</span><span style="color:#F78C6C;">g</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">|</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">)$</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">super</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">parse</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">program</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u7136\u540E\u6CE8\u518C\u4E00\u4E2A\u65B0\u7684 token \u7C7B\u578B\u6765\u6807\u8BC6\u5B83</p><div class="language-javascript"><button class="copy"></button><span class="lang">javascript</span><pre><code><span class="line"><span style="color:#A6ACCD;">Parser</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">acorn</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">keywordTypes[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">guang</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">] </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">TokenType</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">guang</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,{</span><span style="color:#F07178;">keyword</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">guang</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u8FD9\u6837 acorn \u5C31\u4F1A\u5728 parse \u7684\u65F6\u5019\u5206\u51FA <code>guang</code> \u8FD9\u4E2A\u5173\u952E\u5B57</p><h3 id="\u7EC4\u88C5ast\uFF08\u8BED\u6CD5\u5206\u6790\uFF09" tabindex="-1">\u7EC4\u88C5AST\uFF08\u8BED\u6CD5\u5206\u6790\uFF09 <a class="header-anchor" href="#\u7EC4\u88C5ast\uFF08\u8BED\u6CD5\u5206\u6790\uFF09" aria-hidden="true">#</a></h3><p>\u5728\u8BCD\u6CD5\u5206\u6790\u9636\u6BB5\uFF0C\u4FEE\u6539\u4E86\u6B63\u5219\u6765\u5206\u51FA guang \u7684 token \u4E4B\u540E\uFF0C\u5C31\u53EF\u4EE5\u5728\u8BED\u6CD5\u5206\u6790\u7684\u65F6\u5019\u7528\u5B83\u521B\u5EFA\u5BF9\u5E94\u7684 AST \u4E86\u3002</p><p>acorn \u662F\u57FA\u4E8E\u9012\u5F52\u4E0B\u964D\u7684\u601D\u8DEF\u5B9E\u73B0\u7684\uFF0C\u4E5F\u5C31\u662F parse \u5230\u4E0D\u540C\u7C7B\u578B\u7684\u8282\u70B9\u4F1A\u8C03\u7528\u4E0D\u540C\u7684 parseXxx \u65B9\u6CD5\uFF0C\u8FD9\u6837\u9012\u5F52\u7684\u89E3\u6790\u3002</p><p>\u56E0\u4E3A\u6211\u4EEC\u662F\u5728 statement \u91CC\u9762\u7528\uFF0C\u90A3\u4E48\u5C31\u8981\u91CD\u5199 parseStatement \u65B9\u6CD5\uFF0C\u5728\u91CC\u9762\u7EC4\u88C5\u65B0\u7684 statement \u8282\u70B9\uFF1A</p><div class="language-javascript"><button class="copy"></button><span class="lang">javascript</span><pre><code><span class="line"><span style="color:#82AAFF;">parseStatement</span><span style="color:#A6ACCD;">(context</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> topLevel</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">exports</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">var</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">tokenType</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">type</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">tokenType</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Parser</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">acorn</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">keywordTypes</span><span style="color:#F07178;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">guang</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">]) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">var</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">node</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">startNode</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">next</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">finishNode</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">value</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">guang</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">},</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">GuangStatement</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">super</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">parseStatement</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">context</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">topLevel</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">exports</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>this.type \u662F\u5F53\u524D\u5904\u7406\u5230\u7684 token \u7684\u7C7B\u578B\uFF0C this.next \u65B9\u5F0F\u662F\u6D88\u8D39\u8FD9\u4E2A token\uFF0C\u6211\u4EEC\u8BC6\u522B\u51FA token \u7684\u7C7B\u578B\u4E3A guang \u7684\u65F6\u5019\uFF0C\u5C31\u7EC4\u88C5\u6210\u4E00\u4E2A AST \u8FD4\u56DE\u3002</p><p>\u521B\u5EFA AST \u8282\u70B9\u662F\u7528 this.startNode()\uFF0C\u8FD4\u56DE\u7528 guang \u8FD9\u4E2A token \u6765\u521B\u5EFA\u7684 AST \u8282\u70B9\u3002</p><p>\u5982\u679C\u4E0D\u662F\u6211\u4EEC\u6269\u5C55\u7684 token\uFF0C\u5219\u8C03\u7528\u7236\u7C7B\u7684 parseStatement \u5904\u7406\u3002</p><p>\u65B0\u7684\u5173\u952E\u5B57\u7684 parse \u5DF2\u7ECF\u5904\u7406\u5B8C\u4E86\u3002\u4F46\u662F\u6700\u597D\u8FD8\u662F\u628A\u8FD9\u6BB5\u89E3\u6790\u903B\u8F91\u62C6\u6210\u4E00\u4E2A\u65B0\u7684 parseXxx \u7684\u65B9\u6CD5\uFF0C\u8FD9\u6837\u5B50\u7C7B\u4E5F\u53EF\u4EE5\u7EE7\u627F\u7136\u540E\u8986\u76D6\u5B83\u3002</p><div class="language-javascript"><button class="copy"></button><span class="lang">javascript</span><pre><code><span class="line"><span style="color:#82AAFF;">parseStatement</span><span style="color:#A6ACCD;">(context</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> topLevel</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">exports</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">var</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">tokenType</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">type</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">tokenType</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Parser</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">acorn</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">keywordTypes</span><span style="color:#F07178;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">guang</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">]) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">var</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">node</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">startNode</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">parseGuangStatement</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">node</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">super</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">parseStatement</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">context</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">topLevel</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">exports</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">parseGuangStatement</span><span style="color:#A6ACCD;">(node) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">next</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">finishNode</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">value</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">guang</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">},</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">GuangStatement</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u5B8C\u6574\u4EE3\u7801\u5982\u4E0B\uFF1A</p><div class="language-javascript"><button class="copy"></button><span class="lang">javascript</span><pre><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> acorn </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">acorn</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> Parser </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> acorn</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Parser</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> TokenType </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> acorn</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">TokenType</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">Parser</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">acorn</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">keywordTypes[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">guang</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">] </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">TokenType</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">guang</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,{</span><span style="color:#F07178;">keyword</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">guang</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">wordsRegexp</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">words</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">RegExp</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">^(?:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">words</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">replace</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">/</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">/</span><span style="color:#F78C6C;">g</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">|</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">)$</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> guangKeyword </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">Parser</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">class</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">extends</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Parser</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    parse</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">program</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">newKeywords</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this const class extends export import super</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">newKeywords</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;"> guang</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">keywords</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">RegExp</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">^(?:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">newKeywords</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">replace</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">/</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">/</span><span style="color:#F78C6C;">g</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">|</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">)$</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">super</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">parse</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">program</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    parseStatement</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">context</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">topLevel</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">exports</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">var</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">starttype</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">type</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">starttype</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Parser</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">acorn</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">keywordTypes</span><span style="color:#F07178;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">guang</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">]) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">var</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">node</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">startNode</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">parseGuangStatement</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">node</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">super</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">parseStatement</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">context</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">topLevel</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">exports</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    parseGuangStatement</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">node</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">next</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">finishNode</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">value</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">guang</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">},</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">GuangStatement</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;">//\u65B0\u589E\u52A0\u7684ssh\u8BED\u53E5</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> newParser </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Parser</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">extend</span><span style="color:#A6ACCD;">(guangKeyword)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u6211\u4EEC\u6267\u884C\u4E0B\u8BD5\u4E0B\u6548\u679C</p><div class="language-javascript"><button class="copy"></button><span class="lang">javascript</span><pre><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> newParser </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Parser</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">extend</span><span style="color:#A6ACCD;">(guangKeywordPlugin)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> program </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#C3E88D;">    guang</span></span>
<span class="line"><span style="color:#C3E88D;">    const a = 1</span></span>
<span class="line"><span style="color:#89DDFF;">\`</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> ast </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> newParser</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">parse</span><span style="color:#A6ACCD;">(program)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(ast)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><p>\u4EA7\u751F\u7684AST\u5982\u4E0B\uFF1A</p><div class="language-"><button class="copy"></button><span class="lang"></span><pre><code><span class="line"><span style="color:#A6ACCD;">Node {</span></span>
<span class="line"><span style="color:#A6ACCD;">  type: &#39;Program&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">  start: 0,</span></span>
<span class="line"><span style="color:#A6ACCD;">  end: 27,</span></span>
<span class="line"><span style="color:#A6ACCD;">  body: [</span></span>
<span class="line"><span style="color:#A6ACCD;">    { value: &#39;guang&#39;, type: &#39;GuangStatement&#39;, end: 10 },</span></span>
<span class="line"><span style="color:#A6ACCD;">    Node {</span></span>
<span class="line"><span style="color:#A6ACCD;">      type: &#39;VariableDeclaration&#39;,</span></span>
<span class="line"><span style="color:#A6ACCD;">      start: 15,</span></span>
<span class="line"><span style="color:#A6ACCD;">      end: 26,</span></span>
<span class="line"><span style="color:#A6ACCD;">      declarations: [Array],</span></span>
<span class="line"><span style="color:#A6ACCD;">      kind: &#39;const&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">  ],</span></span>
<span class="line"><span style="color:#A6ACCD;">  sourceType: &#39;script&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><p>\u53EF\u4EE5\u770B\u5230\u4EE3\u7801\u91CC\u7684 guang \u6CA1\u6709\u62A5\u7F16\u8BD1\u9519\u8BEF\uFF0C\u800C\u662F\u4F5C\u4E3A\u5173\u952E\u5B57\u88AB\u89E3\u6790\u4E86\u3002\u5E76\u4E14\u8FD9\u6761\u8BED\u53E5\u5728 parse \u540E\u521B\u5EFA\u4E86 GuangStatement \u7C7B\u578B\u7684\u8282\u70B9\u3002</p><p>\u901A\u8FC7\u8FD9\u4E2A\u7B80\u5355\u7684\u4F8B\u5B50\uFF0C\u6211\u4EEC\u80FD\u5927\u6982\u7406\u89E3 babel \u662F\u600E\u4E48\u57FA\u4E8E acorn \u5B9E\u73B0 typescript\u3001jsx\u3001flow \u8BED\u6CD5\u89E3\u6790\u7684\u4E86\uFF1A\u5C31\u662F\u901A\u8FC7\u7EE7\u627F\u548C\u91CD\u5199\u7684\u65B9\u5F0F\u4FEE\u6539\u4E86\u8BCD\u6CD5\u5206\u6790\u3001\u8BED\u6CD5\u5206\u6790\u7684\u903B\u8F91\u3002</p><p>\u6BD4\u5982 Literal \u6269\u5C55\u4E86 StringLiteral\u3001NumericLiteral \u7B49\u8FD9\u4E00\u70B9\uFF0C\u6211\u4EEC\u5C31\u53EF\u4EE5\u81EA\u5DF1\u5B9E\u73B0\uFF1A</p><div class="language-javascript"><button class="copy"></button><span class="lang">javascript</span><pre><code><span class="line"><span style="color:#82AAFF;">parseLiteral</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">...</span><span style="color:#A6ACCD;">args) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">node</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">super</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">parseLiteral</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">...</span><span style="color:#A6ACCD;">args</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">switch</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">typeof</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">node</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">case</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">number</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">node</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">type</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">NumericLiteral</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">break</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">case</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">string</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">node</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">type</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">StringLiteral</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">break</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">node</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h2 id="\u603B\u7ED3" tabindex="-1">\u603B\u7ED3 <a class="header-anchor" href="#\u603B\u7ED3" aria-hidden="true">#</a></h2><p>\u8FD9\u4E00\u8282\u6211\u4EEC\u4E86\u89E3\u4E86 js parser \u7684\u5386\u53F2\uFF0C\u57FA\u4E8E\u706B\u72D0\u6D4F\u89C8\u5668\u7684 JS \u5F15\u64CE SpiderMonkey \u7684 AST \u6807\u51C6\uFF0C\u5236\u5B9A\u4E86 espree \u7684\u6807\u51C6\uFF0C\u6700\u65E9\u7684 estree \u6807\u51C6\u7684\u5B9E\u73B0\u662F esprima\uFF0C\u4F46\u662F\u968F\u7740 es2015 \u5F00\u59CB\u4E00\u5E74\u4E00\u4E2A\u7248\u672C\uFF0Cesprima \u7684\u8FED\u4EE3\u901F\u5EA6\u9010\u6E10\u8DDF\u4E0D\u4E0A\u4E86\uFF0C\u8FD9\u65F6\u5019 acorn \u6D41\u884C\u8D77\u6765\uFF0C\u56E0\u4E3A\u901F\u5EA6\u66F4\u5FEB\uFF0C\u800C\u4E14\u652F\u6301\u63D2\u4EF6\u6269\u5C55\uFF0C\u4E8E\u662F espree\u3001babel parser(babylon) \u7B49\u90FD\u57FA\u4E8E acorn \u6765\u5B9E\u73B0\u5404\u81EA\u7684 parser\u3002\u867D\u7136 estree \u7CFB\u5217\u7684 js parser \u633A\u591A\u7684\uFF0C\u4F46\u4E5F\u4E0D\u662F\u5168\u90E8\uFF0Cterser\u3001typescript \u7B49\u90FD\u662F\u7528\u81EA\u5DF1\u7684 AST\u3002</p><p>\u5B66\u5B8C\u8FD9\u4E00\u8282\uFF0C\u6211\u4EEC\u66F4\u5168\u9762\u7684\u4E86\u89E3\u4E86 js parser \u7684\u5386\u53F2\uFF0C\u5BF9\u5404\u79CD\u5DE5\u5177\u6240\u7528\u7684 parser \u4E4B\u95F4\u7684\u5173\u7CFB\u6709\u4E86\u4E00\u5B9A\u7684\u4E86\u89E3\uFF0C\u5E76\u4E14\u8FD8\u77E5\u9053\u4E86 acorn \u7684\u8BED\u6CD5\u63D2\u4EF6\u8BE5\u600E\u4E48\u5199\u3002</p><p>babel parser \u80FD\u4E0D\u65AD\u5730\u652F\u6301\u65B0\u7684\u8BED\u6CD5\uFF0C\u5C31\u662F\u901A\u8FC7\u4FEE\u6539\u8BCD\u6CD5\u5206\u6790\u3001\u8BED\u6CD5\u5206\u6790\u9636\u6BB5\u7684\u4EE3\u7801\u6765\u5B9E\u73B0\u7684\u3002</p><p>\u5176\u5B9E\u73B0\u5728 babel parser \u7684\u4EE3\u7801\u91CC\u5DF2\u7ECF\u770B\u4E0D\u5230 acorn \u7684\u4F9D\u8D56\u4E86\uFF0C\u56E0\u4E3A\u5728 babel4 \u4EE5\u540E\uFF0Cbabel \u76F4\u63A5 fork \u4E86 acorn \u7684\u4EE3\u7801\u6765\u4FEE\u6539\uFF0C\u800C\u4E0D\u662F\u5F15\u5165 acorn \u5305\u518D\u901A\u8FC7\u63D2\u4EF6\u6269\u5C55\u7684\u65B9\u5F0F\u3002\u4F46\u662F\uFF0C\u539F\u7406\u8FD8\u662F\u4E00\u6837\u7684\u3002</p><p>\uFF08\u4EE3\u7801\u5728<a href="https://github.com/QuarkGluonPlasma/babel-plugin-exercize" target="_blank" rel="noreferrer">\u8FD9\u91CC</a>\uFF0C\u5EFA\u8BAE git clone \u4E0B\u6765\u8DD1\u4E00\u4E0B\uFF09</p>`,66),e=[o];function r(t,c,F,y,D,A){return n(),a("div",null,e)}const u=s(l,[["render",r]]);export{C as __pageData,u as default};
